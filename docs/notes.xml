<?xml version="1.0" encoding="UTF-8"?>
<rss  xmlns:atom="http://www.w3.org/2005/Atom" 
      xmlns:media="http://search.yahoo.com/mrss/" 
      xmlns:content="http://purl.org/rss/1.0/modules/content/" 
      xmlns:dc="http://purl.org/dc/elements/1.1/" 
      version="2.0">
<channel>
<title>Homophony</title>
<link>https://homophony.quest/notes.html</link>
<atom:link href="https://homophony.quest/notes.xml" rel="self" type="application/rss+xml"/>
<description>Music blog for motivation to play more music</description>
<image>
<url>https://homophony.quest/images/cover.jpg</url>
<title>Homophony</title>
<link>https://homophony.quest/notes.html</link>
</image>
<generator>quarto-1.4.549</generator>
<lastBuildDate>Tue, 19 Mar 2024 04:00:00 GMT</lastBuildDate>
<item>
  <title>Weekly practice March 17-22</title>
  <dc:creator>Matt Crump</dc:creator>
  <link>https://homophony.quest/blog/58_3_19_24_weekly_piano/</link>
  <description><![CDATA[ 




<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> diffusers <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> DiffusionPipeline</span>
<span id="cb1-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> transformers <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> set_seed</span>
<span id="cb1-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> PIL <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> Image</span>
<span id="cb1-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> torch</span>
<span id="cb1-5"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> random</span>
<span id="cb1-6"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> ssl</span>
<span id="cb1-7"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> os</span>
<span id="cb1-8">ssl._create_default_https_context <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ssl._create_unverified_context</span>
<span id="cb1-9"></span>
<span id="cb1-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#locate library</span></span>
<span id="cb1-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#model_id = "./stable-diffusion-v1-5"</span></span>
<span id="cb1-12">model_id <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dreamshaper-xl-turbo"</span></span>
<span id="cb1-13"></span>
<span id="cb1-14">pipeline <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> DiffusionPipeline.from_pretrained(</span>
<span id="cb1-15">    pretrained_model_name_or_path <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../../../../bigFiles/huggingface/dreamshaper-xl-turbo/"</span></span>
<span id="cb1-16">)</span>
<span id="cb1-17"></span>
<span id="cb1-18">pipeline <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pipeline.to(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mps"</span>)</span>
<span id="cb1-19"></span>
<span id="cb1-20"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Recommended if your computer has &lt; 64 GB of RAM</span></span>
<span id="cb1-21">pipeline.enable_attention_slicing(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"max"</span>)</span>
<span id="cb1-22"></span>
<span id="cb1-23">prompt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"practicing synthesizer on a beach. the sunset is a synthesizer. The moon in the sky is a synthesizer. The trees are made of synthesizers. The ocean is music. colorful. 3d."</span></span>
<span id="cb1-24"></span>
<span id="cb1-25"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> s <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>):</span>
<span id="cb1-26">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> n <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>]:</span>
<span id="cb1-27">    seed <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> s<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span></span>
<span id="cb1-28">    num_steps <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> n<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb1-29">    set_seed(seed)</span>
<span id="cb1-30">    </span>
<span id="cb1-31">    image <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pipeline(prompt,height <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1080</span>,width <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1080</span>,num_images_per_prompt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,num_inference_steps<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>num_steps)</span>
<span id="cb1-32">    </span>
<span id="cb1-33">    image_name <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"images/synth_</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">_</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">.jpeg"</span></span>
<span id="cb1-34">    </span>
<span id="cb1-35">    image_save <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> image.images[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].save(image_name.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">format</span>(seed,num_steps))</span></code></pre></div>
</details>
</div>
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><a href="cover.jpg" class="lightbox" data-gallery="quarto-lightbox-gallery-1"><img src="https://homophony.quest/blog/58_3_19_24_weekly_piano/cover.jpg" class="img-fluid quarto-figure quarto-figure-left figure-img" style="width:50.0%"></a></p>
</figure>
</div>

<div class="no-row-height column-margin column-container"><div class="">
<p>practicing synthesizer on a beach. the sunset is a synthesizer. The moon in the sky is a synthesizer. The trees are made of synthesizers. The ocean is music. colorful. 3d.</p>
</div></div><p>It’s been a while since I posted. The semester has been spinning its wheels. My goal is to get back into the habit of daily musical somethings.</p>
<p>3/17 - Got to mess around on a Moog One!</p>
<p>3/18 - Noodled around on a couple Jazz Standards</p>
<ul>
<li>All of me</li>
<li>April in Paris…took a Thelonius Monk direction</li>
</ul>
<p>3/19 &amp; 3/20 - More standards</p>
<ul>
<li>The blue room</li>
<li>Great for memorable intervals</li>
</ul>



 ]]></description>
  <category>music practice</category>
  <guid>https://homophony.quest/blog/58_3_19_24_weekly_piano/</guid>
  <pubDate>Tue, 19 Mar 2024 04:00:00 GMT</pubDate>
  <media:content url="https://homophony.quest/blog/58_3_19_24_weekly_piano/cover.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>Adobe after effects scratchpad</title>
  <dc:creator>Matt Crump</dc:creator>
  <link>https://homophony.quest/blog/57_2_24_24_after_effects/</link>
  <description><![CDATA[ 




<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> diffusers <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> DiffusionPipeline</span>
<span id="cb1-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> transformers <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> set_seed</span>
<span id="cb1-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> PIL <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> Image</span>
<span id="cb1-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> torch</span>
<span id="cb1-5"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> random</span>
<span id="cb1-6"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> ssl</span>
<span id="cb1-7"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> os</span>
<span id="cb1-8">ssl._create_default_https_context <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ssl._create_unverified_context</span>
<span id="cb1-9"></span>
<span id="cb1-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#locate library</span></span>
<span id="cb1-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#model_id = "./stable-diffusion-v1-5"</span></span>
<span id="cb1-12">model_id <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dreamshaper-xl-turbo"</span></span>
<span id="cb1-13"></span>
<span id="cb1-14">pipeline <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> DiffusionPipeline.from_pretrained(</span>
<span id="cb1-15">    pretrained_model_name_or_path <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../../../../bigFiles/huggingface/dreamshaper-xl-turbo/"</span></span>
<span id="cb1-16">)</span>
<span id="cb1-17"></span>
<span id="cb1-18">pipeline <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pipeline.to(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mps"</span>)</span>
<span id="cb1-19"></span>
<span id="cb1-20"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Recommended if your computer has &lt; 64 GB of RAM</span></span>
<span id="cb1-21">pipeline.enable_attention_slicing(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"max"</span>)</span>
<span id="cb1-22"></span>
<span id="cb1-23">prompt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Space station universe situation. Synthesizer universe. Neon. 80s Cartoon. Thundercats. Command station."</span></span>
<span id="cb1-24"></span>
<span id="cb1-25"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> s <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>):</span>
<span id="cb1-26">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> n <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>]:</span>
<span id="cb1-27">    seed <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> s<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span></span>
<span id="cb1-28">    num_steps <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> n<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb1-29">    set_seed(seed)</span>
<span id="cb1-30">    </span>
<span id="cb1-31">    image <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pipeline(prompt,height <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1080</span>,width <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1080</span>,num_images_per_prompt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,num_inference_steps<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>num_steps)</span>
<span id="cb1-32">    </span>
<span id="cb1-33">    image_name <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"images/synth_</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">_</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">.jpeg"</span></span>
<span id="cb1-34">    </span>
<span id="cb1-35">    image_save <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> image.images[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].save(image_name.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">format</span>(seed,num_steps))</span></code></pre></div>
</details>
</div>
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><a href="cover.jpg" class="lightbox" data-gallery="quarto-lightbox-gallery-1"><img src="https://homophony.quest/blog/57_2_24_24_after_effects/cover.jpg" class="img-fluid quarto-figure quarto-figure-left figure-img" style="width:50.0%"></a></p>
</figure>
</div>

<div class="no-row-height column-margin column-container"><div class="">
<p>Adobe after effects logo</p>
</div></div><p>Making random notes about adobe after effects.</p>
<p>Perhaps a small collection of formula expressions may emerge here over time.</p>
<section id="sine-wave-formula" class="level2">
<h2 class="anchored" data-anchor-id="sine-wave-formula">Sine wave formula</h2>
<p>a = amplitude (multiplier of -1 to 1) f = frequency (1/30 would do one cycle in a 30 sec comp) y = value of sine wave over time</p>
<p>value of some effect to assign</p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb2-1">a = 617;</span>
<span id="cb2-2">f = 1/30;</span>
<span id="cb2-3">y = Math.sin(time*2*Math.PI*f)*a;</span>
<span id="cb2-4"></span>
<span id="cb2-5">effect("Transform")("Skew Axis").value = y;</span></code></pre></div>


</section>

 ]]></description>
  <category>after effects</category>
  <category>vfx</category>
  <guid>https://homophony.quest/blog/57_2_24_24_after_effects/</guid>
  <pubDate>Sat, 24 Feb 2024 05:00:00 GMT</pubDate>
  <media:content url="https://homophony.quest/blog/57_2_24_24_after_effects/cover.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>VO: Every Station Needs Command: Canvas Animation</title>
  <dc:creator>Matt Crump</dc:creator>
  <link>https://homophony.quest/blog/56_2_23_24_every_station/</link>
  <description><![CDATA[ 




<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> diffusers <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> DiffusionPipeline</span>
<span id="cb1-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> transformers <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> set_seed</span>
<span id="cb1-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> PIL <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> Image</span>
<span id="cb1-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> torch</span>
<span id="cb1-5"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> random</span>
<span id="cb1-6"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> ssl</span>
<span id="cb1-7"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> os</span>
<span id="cb1-8">ssl._create_default_https_context <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ssl._create_unverified_context</span>
<span id="cb1-9"></span>
<span id="cb1-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#locate library</span></span>
<span id="cb1-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#model_id = "./stable-diffusion-v1-5"</span></span>
<span id="cb1-12">model_id <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dreamshaper-xl-turbo"</span></span>
<span id="cb1-13"></span>
<span id="cb1-14">pipeline <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> DiffusionPipeline.from_pretrained(</span>
<span id="cb1-15">    pretrained_model_name_or_path <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../../../../bigFiles/huggingface/dreamshaper-xl-turbo/"</span></span>
<span id="cb1-16">)</span>
<span id="cb1-17"></span>
<span id="cb1-18">pipeline <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pipeline.to(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mps"</span>)</span>
<span id="cb1-19"></span>
<span id="cb1-20"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Recommended if your computer has &lt; 64 GB of RAM</span></span>
<span id="cb1-21">pipeline.enable_attention_slicing(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"max"</span>)</span>
<span id="cb1-22"></span>
<span id="cb1-23">prompt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Space station universe situation. Synthesizer universe. Neon. 80s Cartoon. Thundercats. Command station."</span></span>
<span id="cb1-24"></span>
<span id="cb1-25"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> s <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>):</span>
<span id="cb1-26">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> n <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>]:</span>
<span id="cb1-27">    seed <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> s<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span></span>
<span id="cb1-28">    num_steps <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> n<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb1-29">    set_seed(seed)</span>
<span id="cb1-30">    </span>
<span id="cb1-31">    image <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pipeline(prompt,height <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1080</span>,width <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1080</span>,num_images_per_prompt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,num_inference_steps<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>num_steps)</span>
<span id="cb1-32">    </span>
<span id="cb1-33">    image_name <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"images/synth_</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">_</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">.jpeg"</span></span>
<span id="cb1-34">    </span>
<span id="cb1-35">    image_save <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> image.images[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].save(image_name.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">format</span>(seed,num_steps))</span></code></pre></div>
</details>
</div>
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><a href="cover.jpg" class="lightbox" data-gallery="quarto-lightbox-gallery-1"><img src="https://homophony.quest/blog/56_2_23_24_every_station/cover.jpg" class="img-fluid quarto-figure quarto-figure-left figure-img" style="width:50.0%"></a></p>
</figure>
</div>

<div class="no-row-height column-margin column-container"><div class="">
<p>Record player. White background. Robot Transformer record player. 3d. Linocut. Neon. Lasers. Awesomeness - dreamshaper-xl-turbo</p>
</div></div><p>Yet another quick post on making an animation for an older track.</p>
<section id="vo-every-station-needs-command" class="level2">
<h2 class="anchored" data-anchor-id="vo-every-station-needs-command">VO: Every Station Needs Command</h2>
<p>This one is <a href="https://homophony.quest/music/VO.html">Every Station Needs Command from VO</a>. It’s a bit alternative indie rock synth downtempo thing?</p>
</section>
<section id="animation-details" class="level2">
<h2 class="anchored" data-anchor-id="animation-details">Animation details</h2>
<p>I put in this prompt, “Space station universe situation. Synthesizer universe. Neon. 80s Cartoon. Thundercats. Command station.” to dreamshaper-turbo-xl.</p>
<p>This time I have a plan for what I want to do in adobe after effects. Most likely I will pick one of these pictures. Then, I’ll load it into AE. The vision is a series of circles, rotating in alternating directions, potentially bouncing a little bit to the beat. I’ll fill the circles with the picture. It will start with the picture as normal, then the picture, which will be composed of a series of lined up concentric circles, will rotate away from itself as the circles spin around, and then back to it’s starting position. Or something like that.</p>
<div>

</div>
<div class="quarto-layout-panel" data-layout-ncol="4">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 25.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/synth_21_11.jpeg" class="lightbox" data-glightbox="description: .lightbox-desc-2" data-gallery="my-gallery" title="synth_21_11.jpeg"><img src="https://homophony.quest/blog/56_2_23_24_every_station/images/synth_21_11.jpeg" class="img-fluid figure-img" alt="synth_21_11.jpeg"></a></p>
<figcaption>synth_21_11.jpeg</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 25.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/synth_21_6.jpeg" class="lightbox" data-glightbox="description: .lightbox-desc-3" data-gallery="my-gallery" title="synth_21_6.jpeg"><img src="https://homophony.quest/blog/56_2_23_24_every_station/images/synth_21_6.jpeg" class="img-fluid figure-img" alt="synth_21_6.jpeg"></a></p>
<figcaption>synth_21_6.jpeg</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 25.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/synth_22_11.jpeg" class="lightbox" data-glightbox="description: .lightbox-desc-4" data-gallery="my-gallery" title="synth_22_11.jpeg"><img src="https://homophony.quest/blog/56_2_23_24_every_station/images/synth_22_11.jpeg" class="img-fluid figure-img" alt="synth_22_11.jpeg"></a></p>
<figcaption>synth_22_11.jpeg</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 25.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/synth_22_6.jpeg" class="lightbox" data-glightbox="description: .lightbox-desc-5" data-gallery="my-gallery" title="synth_22_6.jpeg"><img src="https://homophony.quest/blog/56_2_23_24_every_station/images/synth_22_6.jpeg" class="img-fluid figure-img" alt="synth_22_6.jpeg"></a></p>
<figcaption>synth_22_6.jpeg</figcaption>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 25.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/synth_23_11.jpeg" class="lightbox" data-glightbox="description: .lightbox-desc-6" data-gallery="my-gallery" title="synth_23_11.jpeg"><img src="https://homophony.quest/blog/56_2_23_24_every_station/images/synth_23_11.jpeg" class="img-fluid figure-img" alt="synth_23_11.jpeg"></a></p>
<figcaption>synth_23_11.jpeg</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 25.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/synth_23_6.jpeg" class="lightbox" data-glightbox="description: .lightbox-desc-7" data-gallery="my-gallery" title="synth_23_6.jpeg"><img src="https://homophony.quest/blog/56_2_23_24_every_station/images/synth_23_6.jpeg" class="img-fluid figure-img" alt="synth_23_6.jpeg"></a></p>
<figcaption>synth_23_6.jpeg</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 25.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/synth_24_11.jpeg" class="lightbox" data-glightbox="description: .lightbox-desc-8" data-gallery="my-gallery" title="synth_24_11.jpeg"><img src="https://homophony.quest/blog/56_2_23_24_every_station/images/synth_24_11.jpeg" class="img-fluid figure-img" alt="synth_24_11.jpeg"></a></p>
<figcaption>synth_24_11.jpeg</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 25.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/synth_24_6.jpeg" class="lightbox" data-glightbox="description: .lightbox-desc-9" data-gallery="my-gallery" title="synth_24_6.jpeg"><img src="https://homophony.quest/blog/56_2_23_24_every_station/images/synth_24_6.jpeg" class="img-fluid figure-img" alt="synth_24_6.jpeg"></a></p>
<figcaption>synth_24_6.jpeg</figcaption>
</figure>
</div>
</div>
</div>
</div>
</section>
<section id="youtube-short" class="level2">
<h2 class="anchored" data-anchor-id="youtube-short">Youtube Short</h2>
<p>A couple spinning circles inside a command station.</p>
<iframe width="315" height="560" src="https://www.youtube.com/embed/XF3RGcqwaF8" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen="">
</iframe>



</section>

 ]]></description>
  <category>VO</category>
  <category>video</category>
  <category>canvas animation</category>
  <category>youtube short</category>
  <guid>https://homophony.quest/blog/56_2_23_24_every_station/</guid>
  <pubDate>Fri, 23 Feb 2024 05:00:00 GMT</pubDate>
  <media:content url="https://homophony.quest/blog/56_2_23_24_every_station/cover.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>VO: Slow Down: Canvas Animation</title>
  <dc:creator>Matt Crump</dc:creator>
  <link>https://homophony.quest/blog/55_2_22_24_slow_down/</link>
  <description><![CDATA[ 




<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> diffusers <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> DiffusionPipeline</span>
<span id="cb1-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> transformers <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> set_seed</span>
<span id="cb1-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> PIL <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> Image</span>
<span id="cb1-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> torch</span>
<span id="cb1-5"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> random</span>
<span id="cb1-6"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> ssl</span>
<span id="cb1-7"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> os</span>
<span id="cb1-8">ssl._create_default_https_context <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ssl._create_unverified_context</span>
<span id="cb1-9"></span>
<span id="cb1-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#locate library</span></span>
<span id="cb1-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#model_id = "./stable-diffusion-v1-5"</span></span>
<span id="cb1-12">model_id <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dreamshaper-xl-turbo"</span></span>
<span id="cb1-13"></span>
<span id="cb1-14">pipeline <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> DiffusionPipeline.from_pretrained(</span>
<span id="cb1-15">    pretrained_model_name_or_path <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../../../../bigFiles/huggingface/dreamshaper-xl-turbo/"</span></span>
<span id="cb1-16">)</span>
<span id="cb1-17"></span>
<span id="cb1-18">pipeline <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pipeline.to(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mps"</span>)</span>
<span id="cb1-19"></span>
<span id="cb1-20"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Recommended if your computer has &lt; 64 GB of RAM</span></span>
<span id="cb1-21">pipeline.enable_attention_slicing(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"max"</span>)</span>
<span id="cb1-22"></span>
<span id="cb1-23">prompt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Record player. White background. Robot Transformer record player. 3d. Linocut. Neon. Lasers. Awesomeness"</span></span>
<span id="cb1-24"></span>
<span id="cb1-25"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> s <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>):</span>
<span id="cb1-26">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> n <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>]:</span>
<span id="cb1-27">    seed <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> s<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span></span>
<span id="cb1-28">    num_steps <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> n<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb1-29">    set_seed(seed)</span>
<span id="cb1-30">    </span>
<span id="cb1-31">    image <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pipeline(prompt,height <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1080</span>,width <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1080</span>,num_images_per_prompt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,num_inference_steps<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>num_steps)</span>
<span id="cb1-32">    </span>
<span id="cb1-33">    image_name <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"images/synth_</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">_</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">.jpeg"</span></span>
<span id="cb1-34">    </span>
<span id="cb1-35">    image_save <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> image.images[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].save(image_name.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">format</span>(seed,num_steps))</span></code></pre></div>
</details>
</div>
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><a href="cover.jpg" class="lightbox" data-gallery="quarto-lightbox-gallery-1"><img src="https://homophony.quest/blog/55_2_22_24_slow_down/cover.jpg" class="img-fluid quarto-figure quarto-figure-left figure-img" style="width:50.0%"></a></p>
</figure>
</div>

<div class="no-row-height column-margin column-container"><div class="">
<p>Record player. White background. Robot Transformer record player. 3d. Linocut. Neon. Lasers. Awesomeness - dreamshaper-xl-turbo</p>
</div></div><p>Following in the same footsteps as other posts where I mangle some visuals for a track off an older album</p>
<section id="vo-slow-down" class="level2">
<h2 class="anchored" data-anchor-id="vo-slow-down">VO: Slow down</h2>
<p>This one is <a href="https://homophony.quest/music/VO.html">slow down from VO</a>. It’s short and kind of breakbeat-ish.</p>
</section>
<section id="animation-details" class="level2">
<h2 class="anchored" data-anchor-id="animation-details">Animation details</h2>
<p>Feeding this prompt to dreamshaper-xl-turbo:</p>
<p>“Record player. White background. Robot Transformer record player. 3d. Linocut. Neon. Lasers. Awesomeness”</p>
<p>Then, do something with one or another of these.</p>
<div>

</div>
<div class="quarto-layout-panel" data-layout-ncol="4">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 25.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/synth_21_11.jpeg" class="lightbox" data-glightbox="description: .lightbox-desc-2" data-gallery="my-gallery" title="synth_21_11.jpeg"><img src="https://homophony.quest/blog/55_2_22_24_slow_down/images/synth_21_11.jpeg" class="img-fluid figure-img" alt="synth_21_11.jpeg"></a></p>
<figcaption>synth_21_11.jpeg</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 25.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/synth_21_6.jpeg" class="lightbox" data-glightbox="description: .lightbox-desc-3" data-gallery="my-gallery" title="synth_21_6.jpeg"><img src="https://homophony.quest/blog/55_2_22_24_slow_down/images/synth_21_6.jpeg" class="img-fluid figure-img" alt="synth_21_6.jpeg"></a></p>
<figcaption>synth_21_6.jpeg</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 25.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/synth_22_11.jpeg" class="lightbox" data-glightbox="description: .lightbox-desc-4" data-gallery="my-gallery" title="synth_22_11.jpeg"><img src="https://homophony.quest/blog/55_2_22_24_slow_down/images/synth_22_11.jpeg" class="img-fluid figure-img" alt="synth_22_11.jpeg"></a></p>
<figcaption>synth_22_11.jpeg</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 25.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/synth_22_6.jpeg" class="lightbox" data-glightbox="description: .lightbox-desc-5" data-gallery="my-gallery" title="synth_22_6.jpeg"><img src="https://homophony.quest/blog/55_2_22_24_slow_down/images/synth_22_6.jpeg" class="img-fluid figure-img" alt="synth_22_6.jpeg"></a></p>
<figcaption>synth_22_6.jpeg</figcaption>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 25.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/synth_23_11.jpeg" class="lightbox" data-glightbox="description: .lightbox-desc-6" data-gallery="my-gallery" title="synth_23_11.jpeg"><img src="https://homophony.quest/blog/55_2_22_24_slow_down/images/synth_23_11.jpeg" class="img-fluid figure-img" alt="synth_23_11.jpeg"></a></p>
<figcaption>synth_23_11.jpeg</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 25.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/synth_23_6.jpeg" class="lightbox" data-glightbox="description: .lightbox-desc-7" data-gallery="my-gallery" title="synth_23_6.jpeg"><img src="https://homophony.quest/blog/55_2_22_24_slow_down/images/synth_23_6.jpeg" class="img-fluid figure-img" alt="synth_23_6.jpeg"></a></p>
<figcaption>synth_23_6.jpeg</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 25.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/synth_24_11.jpeg" class="lightbox" data-glightbox="description: .lightbox-desc-8" data-gallery="my-gallery" title="synth_24_11.jpeg"><img src="https://homophony.quest/blog/55_2_22_24_slow_down/images/synth_24_11.jpeg" class="img-fluid figure-img" alt="synth_24_11.jpeg"></a></p>
<figcaption>synth_24_11.jpeg</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 25.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/synth_24_6.jpeg" class="lightbox" data-glightbox="description: .lightbox-desc-9" data-gallery="my-gallery" title="synth_24_6.jpeg"><img src="https://homophony.quest/blog/55_2_22_24_slow_down/images/synth_24_6.jpeg" class="img-fluid figure-img" alt="synth_24_6.jpeg"></a></p>
<figcaption>synth_24_6.jpeg</figcaption>
</figure>
</div>
</div>
</div>
</div>
</section>
<section id="youtube-short" class="level2">
<h2 class="anchored" data-anchor-id="youtube-short">Youtube Short</h2>
<p>Some digitally noised up transformer djs.</p>
<iframe width="315" height="560" src="https://www.youtube.com/embed/DYjPAHZ5sBc" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen="">
</iframe>



</section>

 ]]></description>
  <category>VO</category>
  <category>video</category>
  <category>canvas animation</category>
  <category>youtube short</category>
  <guid>https://homophony.quest/blog/55_2_22_24_slow_down/</guid>
  <pubDate>Thu, 22 Feb 2024 05:00:00 GMT</pubDate>
  <media:content url="https://homophony.quest/blog/55_2_22_24_slow_down/cover.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>VO: Country Fire: Canvas Animation</title>
  <dc:creator>Matt Crump</dc:creator>
  <link>https://homophony.quest/blog/54_2_22_24_country_fire/</link>
  <description><![CDATA[ 




<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> diffusers <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> DiffusionPipeline</span>
<span id="cb1-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> transformers <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> set_seed</span>
<span id="cb1-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> PIL <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> Image</span>
<span id="cb1-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> torch</span>
<span id="cb1-5"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> random</span>
<span id="cb1-6"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> ssl</span>
<span id="cb1-7"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> os</span>
<span id="cb1-8">ssl._create_default_https_context <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ssl._create_unverified_context</span>
<span id="cb1-9"></span>
<span id="cb1-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#locate library</span></span>
<span id="cb1-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#model_id = "./stable-diffusion-v1-5"</span></span>
<span id="cb1-12">model_id <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dreamshaper-xl-turbo"</span></span>
<span id="cb1-13"></span>
<span id="cb1-14">pipeline <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> DiffusionPipeline.from_pretrained(</span>
<span id="cb1-15">    pretrained_model_name_or_path <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../../../../bigFiles/huggingface/dreamshaper-xl-turbo/"</span></span>
<span id="cb1-16">)</span>
<span id="cb1-17"></span>
<span id="cb1-18">pipeline <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pipeline.to(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mps"</span>)</span>
<span id="cb1-19"></span>
<span id="cb1-20"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Recommended if your computer has &lt; 64 GB of RAM</span></span>
<span id="cb1-21">pipeline.enable_attention_slicing(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"max"</span>)</span>
<span id="cb1-22"></span>
<span id="cb1-23">prompt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"R2D2 robots setting a country on fire. R2D2 everwhere. City scape. cartoon. neon bright sunset. 80s. linocut."</span></span>
<span id="cb1-24"></span>
<span id="cb1-25"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> s <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>):</span>
<span id="cb1-26">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> n <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>]:</span>
<span id="cb1-27">    seed <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> s<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span></span>
<span id="cb1-28">    num_steps <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> n<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb1-29">    set_seed(seed)</span>
<span id="cb1-30">    </span>
<span id="cb1-31">    image <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pipeline(prompt,height <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1920</span>,width <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1080</span>,num_images_per_prompt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,num_inference_steps<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>num_steps)</span>
<span id="cb1-32">    </span>
<span id="cb1-33">    image_name <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"images/synth_</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">_</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">.jpeg"</span></span>
<span id="cb1-34">    </span>
<span id="cb1-35">    image_save <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> image.images[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].save(image_name.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">format</span>(seed,num_steps))</span></code></pre></div>
</details>
</div>
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><a href="cover.jpg" class="lightbox" data-gallery="quarto-lightbox-gallery-1"><img src="https://homophony.quest/blog/54_2_22_24_country_fire/cover.jpg" class="img-fluid quarto-figure quarto-figure-left figure-img" style="width:50.0%"></a></p>
</figure>
</div>

<div class="no-row-height column-margin column-container"><div class="">
<p>R2D2 robots setting a country on fire. R2D2 everwhere. City scape. cartoon. neon bright sunset. 80s. linocut. - dreamshaper-xl-turbo</p>
</div></div><p>I’ve been having some fun making short animations with Adobe After effects for the tracks on <a href="https://homophony.quest/music/Basement_Tapes.html">Basement Tapes 1</a>. I started with 7 second animations for the Spotify canvas format. These play in the background when a track is played on Spotify (on mobile I think?). Then more fun was had by lengthening them to 30 seconds for youtube shorts. See this playlist:</p>
<iframe width="560" height="315" src="https://www.youtube-nocookie.com/embed/videoseries?si=hujwZ5LEb0flabKB&amp;list=PLDI1NnDZMA8OmYG14hXchvwxpPBypxtxf" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen="">
</iframe>
<p>I figure I’ll keep making these for some of the tracks on the older albums.</p>
<section id="vo-country-fire" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="vo-country-fire">VO: Country Fire</h2>
<p>This morning I’m choosing <a href="https://homophony.quest/music/VO.html">Country Fire from VO</a>. It’s a synthified country/blues song with heavy vocoder. There are periods of rambunctious bleep boops, which sound like a bunch of R2D2s on the prowl.</p>
<p>As a quick aside, I jumped into “Apple music for artists”, and took a quick look at their “promote” features, which produce little graphics like the one in the margin.</p>

<div class="no-row-height column-margin column-container"><div class="">
<p><a href="https://homophony.quest/music/VO.html"><img src="https://homophony.quest/blog/54_2_22_24_country_fire/Country-Fire_coverImageSquareStatic_2024-02-22T08_28.png" class="img-fluid"></a></p>
</div></div></section>
<section id="animation-details" class="level2">
<h2 class="anchored" data-anchor-id="animation-details">Animation details</h2>
<p>Feeding this prompt to dreamshaper-xl-turbo:</p>
<p>“R2D2 robots setting a country on fire. R2D2 everwhere. City scape. cartoon. neon bright sunset. 80s. linocut.”</p>
<p>Then, the plan is to mangle these in Adobe after effects…let’s see what happens.</p>
<div>

</div>
<div class="quarto-layout-panel" data-layout-ncol="4">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 25.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/synth_21_11.jpeg" class="lightbox" data-glightbox="description: .lightbox-desc-2" data-gallery="my-gallery" title="synth_21_11.jpeg"><img src="https://homophony.quest/blog/54_2_22_24_country_fire/images/synth_21_11.jpeg" class="img-fluid figure-img" alt="synth_21_11.jpeg"></a></p>
<figcaption>synth_21_11.jpeg</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 25.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/synth_21_6.jpeg" class="lightbox" data-glightbox="description: .lightbox-desc-3" data-gallery="my-gallery" title="synth_21_6.jpeg"><img src="https://homophony.quest/blog/54_2_22_24_country_fire/images/synth_21_6.jpeg" class="img-fluid figure-img" alt="synth_21_6.jpeg"></a></p>
<figcaption>synth_21_6.jpeg</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 25.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/synth_22_11.jpeg" class="lightbox" data-glightbox="description: .lightbox-desc-4" data-gallery="my-gallery" title="synth_22_11.jpeg"><img src="https://homophony.quest/blog/54_2_22_24_country_fire/images/synth_22_11.jpeg" class="img-fluid figure-img" alt="synth_22_11.jpeg"></a></p>
<figcaption>synth_22_11.jpeg</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 25.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/synth_22_6.jpeg" class="lightbox" data-glightbox="description: .lightbox-desc-5" data-gallery="my-gallery" title="synth_22_6.jpeg"><img src="https://homophony.quest/blog/54_2_22_24_country_fire/images/synth_22_6.jpeg" class="img-fluid figure-img" alt="synth_22_6.jpeg"></a></p>
<figcaption>synth_22_6.jpeg</figcaption>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 25.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/synth_23_11.jpeg" class="lightbox" data-glightbox="description: .lightbox-desc-6" data-gallery="my-gallery" title="synth_23_11.jpeg"><img src="https://homophony.quest/blog/54_2_22_24_country_fire/images/synth_23_11.jpeg" class="img-fluid figure-img" alt="synth_23_11.jpeg"></a></p>
<figcaption>synth_23_11.jpeg</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 25.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/synth_23_6.jpeg" class="lightbox" data-glightbox="description: .lightbox-desc-7" data-gallery="my-gallery" title="synth_23_6.jpeg"><img src="https://homophony.quest/blog/54_2_22_24_country_fire/images/synth_23_6.jpeg" class="img-fluid figure-img" alt="synth_23_6.jpeg"></a></p>
<figcaption>synth_23_6.jpeg</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 25.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/synth_24_11.jpeg" class="lightbox" data-glightbox="description: .lightbox-desc-8" data-gallery="my-gallery" title="synth_24_11.jpeg"><img src="https://homophony.quest/blog/54_2_22_24_country_fire/images/synth_24_11.jpeg" class="img-fluid figure-img" alt="synth_24_11.jpeg"></a></p>
<figcaption>synth_24_11.jpeg</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 25.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/synth_24_6.jpeg" class="lightbox" data-glightbox="description: .lightbox-desc-9" data-gallery="my-gallery" title="synth_24_6.jpeg"><img src="https://homophony.quest/blog/54_2_22_24_country_fire/images/synth_24_6.jpeg" class="img-fluid figure-img" alt="synth_24_6.jpeg"></a></p>
<figcaption>synth_24_6.jpeg</figcaption>
</figure>
</div>
</div>
</div>
</div>
</section>
<section id="youtube-short" class="level2">
<h2 class="anchored" data-anchor-id="youtube-short">Youtube Short</h2>
<p>Very noisy and pixely! I blended through the above images and used the audio to bounce some of the vfx. R2D2s wreching havoc everywhere.</p>
<iframe width="315" height="560" src="https://www.youtube.com/embed/4BJtonQywoU" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen="">
</iframe>



</section>

 ]]></description>
  <category>VO</category>
  <category>video</category>
  <guid>https://homophony.quest/blog/54_2_22_24_country_fire/</guid>
  <pubDate>Thu, 22 Feb 2024 05:00:00 GMT</pubDate>
  <media:content url="https://homophony.quest/blog/54_2_22_24_country_fire/cover.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>Process thoughts on a new album: Basement Tapes 1</title>
  <dc:creator>Matt Crump</dc:creator>
  <link>https://homophony.quest/blog/52_2_19_24_bt_album/</link>
  <description><![CDATA[ 




<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> diffusers <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> DiffusionPipeline</span>
<span id="cb1-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> transformers <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> set_seed</span>
<span id="cb1-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> PIL <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> Image</span>
<span id="cb1-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> torch</span>
<span id="cb1-5"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> random</span>
<span id="cb1-6"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> ssl</span>
<span id="cb1-7"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> os</span>
<span id="cb1-8">ssl._create_default_https_context <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ssl._create_unverified_context</span>
<span id="cb1-9"></span>
<span id="cb1-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#locate library</span></span>
<span id="cb1-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#model_id = "./stable-diffusion-v1-5"</span></span>
<span id="cb1-12">model_id <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dreamshaper-xl-turbo"</span></span>
<span id="cb1-13"></span>
<span id="cb1-14">pipeline <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> DiffusionPipeline.from_pretrained(</span>
<span id="cb1-15">    pretrained_model_name_or_path <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../../../../bigFiles/huggingface/dreamshaper-xl-turbo/"</span></span>
<span id="cb1-16">)</span>
<span id="cb1-17"></span>
<span id="cb1-18">pipeline <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pipeline.to(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mps"</span>)</span>
<span id="cb1-19"></span>
<span id="cb1-20"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Recommended if your computer has &lt; 64 GB of RAM</span></span>
<span id="cb1-21">pipeline.enable_attention_slicing(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"max"</span>)</span>
<span id="cb1-22"></span>
<span id="cb1-23">prompt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"synthesizer city. sunset. synthesizers everywhere. mountains. retro. 80s cartoon. linocut. synthwave. neon."</span></span>
<span id="cb1-24"></span>
<span id="cb1-25"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> s <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>):</span>
<span id="cb1-26">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> n <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>]:</span>
<span id="cb1-27">    seed <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> s<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span></span>
<span id="cb1-28">    num_steps <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> n<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb1-29">    set_seed(seed)</span>
<span id="cb1-30">    </span>
<span id="cb1-31">    image <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pipeline(prompt,height <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">576</span>,width <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1336</span>,num_images_per_prompt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,num_inference_steps<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>num_steps)</span>
<span id="cb1-32">    </span>
<span id="cb1-33">    image_name <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"images/synth_</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">_</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">.jpeg"</span></span>
<span id="cb1-34">    </span>
<span id="cb1-35">    image_save <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> image.images[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].save(image_name.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">format</span>(seed,num_steps))</span></code></pre></div>
</details>
</div>
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><a href="cover.jpg" class="lightbox" data-gallery="quarto-lightbox-gallery-1"><img src="https://homophony.quest/blog/52_2_19_24_bt_album/cover.jpg" class="img-fluid quarto-figure quarto-figure-left figure-img" style="width:50.0%"></a></p>
</figure>
</div>

<div class="no-row-height column-margin column-container"><div class="">
<p>Basement Tapes 1: Album cover</p>
</div></div><p>I wasn’t expecting to <a href="https://homophony.quest/music/Basement_Tapes.html">release an album this weekend</a>. It just turned out that way.</p>
<p>This post is an “album-liner-notes” to self about some of the process steps. In general, I hope that writing about these things will both the make the process easier next time, and potentially suggest new things to try or old things to avoid.</p>
<p>As a solo-artist (i.e., part-time basement synth hermit dabbler) I’ve “released” three whole albums: <a href="https://homophony.quest/music/VO.html">VO</a>, <a href="https://homophony.quest/music/RS.html">RS</a>, and now <a href="https://homophony.quest/music/Basement_Tapes.html">Basement Tapes 1</a>. I say “released” because besides making the music, all I did was pay <a href="https://distrokid.com/">distrokid</a> to distribute the tracks to most major streaming platforms.</p>
<p>I’ve been playing and recording music since I was a kid, gigged with a few bands here and there– all for fun and the joy of playing. Up until a few years ago, the prospect of releasing a whole album in some kind of standard media format seemed very challenging, and I didn’t have any time for it. I had a lot of extra time during the pandemic, was playing and recording a bunch of music, and at some point I started wondering how artists got their music up on streaming platforms. I was surprised to learn about services like distrokid that will get your music onto major streaming platforms…for pretty cheap too. So, in 2020 I put <a href="https://homophony.quest/music/VO.html">VO</a> together and did the distrokid thing to get it out there.</p>
<p>Some topics to cover for this post: general music production approach, Basement Tapes 1 notes, sharing music online, using distrokid, all the extra stuff</p>
<section id="general-music-production-approach" class="level2">
<h2 class="anchored" data-anchor-id="general-music-production-approach">General music production approach</h2>
<p>I’ll make this section short, as my general approach is to try things and listen to what happens.</p>
<p>I have a synth room full of fun gear. I really like to play live more than fidget with things. Everything feeds into a multi-track mixer that records to an SD card, or to a tape deck, or to a computer. Sometimes I have a musical idea and sometimes I don’t and it develops over a session. I’ll typically lay down all of the parts of some song, play lots of variations of everything (e.g., using take lanes in Ableton), and then sit down and edit things. When I get bored of editing, I’ll aim for a process where everything is recorded live, and whatever happens is what I get.</p>
<p>If I’m a hobby musician, I’m an absolute hack sound engineer. It’s 100% that my final mixes are completely boneheaded in a gajillion ways from Sunday. Still, it’s been a lot of fun learning about mixing and mastering. So much there to learn.</p>
<p>My basic mixing/mastering process is:</p>
<ol type="1">
<li>Get rid of line noise, make sure input gain is decent for recording</li>
<li>Set levels while playing to things that sound good to me</li>
<li>If I’m in Ableton, totally mess around with every track adding bits of effects here and there, lots of parameter automation. Keep it subtle for the most part.</li>
<li>Slap a “mixing and mastering” ableton effect rack onto the master channel, followed by a limiter to get the loudness under control.</li>
<li>Leave it, come back, listen to it again in horror of what was I thinking the first time I did this.</li>
<li>Maybe remove noise in Adobe Audition, especially if the tape deck was involved.</li>
</ol>
</section>
<section id="basement-tapes-1-notes" class="level2">
<h2 class="anchored" data-anchor-id="basement-tapes-1-notes">Basement Tapes 1 notes</h2>
<p>The first two albums, <a href="https://homophony.quest/music/VO.html">VO</a> and <a href="https://homophony.quest/music/RS.html">RS</a>, are more in the experimental “synth pop” direction. I had bought a vocoder and couldn’t resist singing into it…resulting in VO. RS has much less “singing”, which is better for everybody. But, both of those albums involved heavy use of Ableton to get the final tracks into shape.</p>
<p><a href="https://homophony.quest/music/Basement_Tapes.html">Basement Tapes 1</a> are a collection of mostly impromptu live recordings from about 2020 onward…the recording dates for each track are a bit hazy.</p>
<p>My neighbor had bought a PYLE cassette tape deck to transfer a whole bunch of tapes to digital. However, he couldn’t get the USB drivers to work for his computer and gifted me the tape deck instead. It had been ages since I had a tape deck, and I love the squishy compression of recording to tape. So, I spent a bunch of time recording whole live tracks onto tape, as a kind of musical journal.</p>
<p>I was making heavy use of the Rhodes, OB-6, Matriarch, and modular stuff. Most of the tracks have a slower downtempo feel. Occasionally they devolve into the sounds of modems connecting to the internet. My overall take on these tracks are they are things I made and decided to share for fun, and to help me document my process a little bit.</p>
</section>
<section id="sharing-music-online" class="level2">
<h2 class="anchored" data-anchor-id="sharing-music-online">Sharing music online</h2>
<p>I’ve maintained websites for sharing some of the <a href="https://www.crumplab.com/things/">visual things I make</a> for years, but it’s only relatively recently that I’ve tried to share music.</p>
<p>I joined soundcloud way back and occasionally posted tracks <a href="https://soundcloud.com/matt-crump-913298049">here</a>. I think the Basement Tape tracks are still there. But, ugh, soundcloud, it’s seems to have gotten worse and worse, and I am not feeling it.</p>
<p><a href="https://homophony.quest/music/Basement_Tapes.html">Basement Tapes 1</a> mostly emerged out of my desire to try different methods of sharing music, and to use the sharing process as a side adventure in curating my own work. For example, in 2022 I discovered mastodon and got interested in sharing music using fediverse tools like funkwhale (<a href="https://www.crumplab.com/blog/778_funkwhale/">blogged about my set up attempts here</a>). Ultimately, I didn’t stick with funkwhale, but the experience helped me get closer to a sharing process that made sense for me.</p>
<p>In terms of sharing music, I was interested in being able to bundle assets together and share them all in one place. For example, I’d want to have the track somewhere, along with possible cover art, production notes, gear notes, musical concept notes, or any other tidbits I might want to attach. Funkwhale offered some of these things. At the same time, so did Mastodon in general. For a while, I was posting about each of the tracks on <a href="https://homophony.quest/music/Basement_Tapes.html">Basement Tapes 1</a> on my old mastodon instance. Each of the posts had the track and usually some “tasting notes” about what the track sounded like.</p>
<p>After I shut down those things, I moved all of the tracks to a notion database, and that worked pretty well for general track organization. And, in principle I could have shared the music from notion.</p>
<p>At some point I had purchased the domain for this site, <a href="https://homophony.quest">https://homophony.quest</a>, and eventually decided to build a <a href="https://quarto.org">quarto</a> website here to “officially” share music. It keeps me busy, and gives me some motivation to keep playing more music.</p>
<p>This weekend I gave the album pages for <a href="https://homophony.quest/music/VO.html">VO</a>, <a href="https://homophony.quest/music/RS.html">RS</a>, and <a href="https://homophony.quest/music/Basement_Tapes.html">Basement Tapes 1</a> a facelift and added embedded players for apple music and spotify. For <a href="https://homophony.quest/music/Basement_Tapes.html">Basement Tapes 1</a>, I also added a bunch of production notes I had been keeping in the notion database.</p>
<p>I could share the music for these albums directly on <a href="https://homophony.quest">https://homophony.quest</a>, but I haven’t done that yet. VO and RS were already distributed by distrokid, and Basement Tapes 1 was up on soundcloud. Plus, I hadn’t yet figured out how to share a playable audio file on a quarto page, but I have since. Still, if I put too many tracks on a single page they are very slow to load, so I haven’t figured everything out. Also, although I have some ambivalence about using major streaming platforms, at least it makes it easy for me to listen to my own music on my own devices in a flexible way. For example, if my tracks are on apple music, it’s easy for me to stream them to myself, or put them in a playlist etc.</p>
<p>A couple months ago I added this blog onto <a href="https://homophony.quest">https://homophony.quest</a> and have shared a <a href="https://homophony.quest/music/New.html">few new tracks</a>, and bits and pieces of things across <a href="https://homophony.quest/notes.html">blog posts</a>. I’ve really enjoyed this set up. It’s easy to publish whenever I want. It’s easy to add a track, or write about some musical process, or both. I’m sticking with this rough pattern more or less for now.</p>
<p>At the same time, I found this <a href="https://www.nytimes.com/2024/01/13/business/music-streaming-fraud-spotify.html">NYT article</a> on phantom artists stealing music very upsetting. I’m not looking to make cash from music, but the idea of someone else stealing it (say, off of soundcloud, or wherever your music is posted to the internet) to make cash for themselves gives me major frowny face.</p>
<p>Whereas, it would be fun to develop a track and post about it and share it on this blog, be it resolved that it would suck to have someone steal it and distribute it without your knowledge.</p>
<p>I suspect that I’m not a major target for this type of music theft, but nevertheless, it left a sad trombone sound in my ear. And, this whole nonsense was the major reason why I released <a href="https://homophony.quest/music/Basement_Tapes.html">Basement Tapes 1</a> over the weekend. I had a spare hour (and that’s almost all it takes to upload tracks to distrokid), and decided to put the tracks out there. They had been up on soundcloud for over a year. I was curious if someone had pirated them and tried to distribute them already without my knowledge. I assumed I might learn about that by attempting to distribute them with distrokid. For example, perhaps these music stores do some quick plagiarism checks or something, and would deny my tracks if they were already somehow on the service. Fortunately that didn’t happen.</p>
<p>I’m not sure what my plans are for sharing finished tracks in the future. Some mix of bits and pieces on the blog, and then distributing full tracks through distrokid or a similar service.</p>
</section>
<section id="using-distrokid" class="level2">
<h2 class="anchored" data-anchor-id="using-distrokid">Using Distrokid</h2>
<p>I don’t have too much to say about this right now. I’ve found the service to be fairly smooth. I’m not paying for all the bells and whistles, which quickly add cost to releasing an album. It’s nice that they distribute widely to various platforms, which makes it easy for me to access the tracks depending on the situation.</p>
<p>I did click through the option to manage my artist profile on spotify, apple music, and youtube, which adds even more stuff to do, should one care to do extra stuff</p>
</section>
<section id="extra-stuff" class="level2">
<h2 class="anchored" data-anchor-id="extra-stuff">Extra stuff</h2>
<p>It’s almost time to start work.</p>
<p>This time the extra stuff was to make short mp4 videos for the Spotify canvas feature. I had previously created cover art for each track using a combination of midjourney, and the “tasting notes” that I wrote for each track as a prompt to midjourney. I put these images into Adobe After effects and made short 7 sec clips for each of them. I stopped using Spotify in general, so I’m not sure why I went overboard on this extra stuff, but it was fun to make the video clips.</p>
</section>
<section id="midjourney-cover-pictures" class="level2">
<h2 class="anchored" data-anchor-id="midjourney-cover-pictures">Midjourney cover pictures</h2>
<p>I still don’t know what to think about using generative models to make pictures. Nowadays it’s mostly misgivings, with some idle curiosity about what happens if I try x?</p>
<p>I have had some interest in programmatically generating images for a long time, and have done all sorts of weird computer image stuff. The cover art for VO and RS was generated by a very early latent image space model. I like the in-between weird images.</p>
<p>When I was bouncing tracks for this album midjourney had started to become available. I think this was my first and only time trying to do anything on discord. Anyway, I generated these images using prompts for describing what I heard in the music.</p>
<p>I still have the prompts, but I doubt any of this is reproducible, so I have no idea how to attribute any of this.</p>
<div>

</div>
<div class="quarto-layout-panel" data-layout-ncol="4">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 25.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="album_imgs/Tape_1_midjourney.jpg" class="lightbox" data-glightbox="description: .lightbox-desc-2" data-gallery="my-gallery" title="Tape 1"><img src="https://homophony.quest/blog/52_2_19_24_bt_album/album_imgs/Tape_1_midjourney.jpg" class="img-fluid figure-img" alt="Tape 1"></a></p>
<figcaption>Tape 1</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 25.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="album_imgs/Tape_2_midjourney.jpg" class="lightbox" data-glightbox="description: .lightbox-desc-3" data-gallery="my-gallery" title="Tape 2"><img src="https://homophony.quest/blog/52_2_19_24_bt_album/album_imgs/Tape_2_midjourney.jpg" class="img-fluid figure-img" alt="Tape 2"></a></p>
<figcaption>Tape 2</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 25.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="album_imgs/Tape_3_midjourney.jpg" class="lightbox" data-glightbox="description: .lightbox-desc-4" data-gallery="my-gallery" title="Tape 3"><img src="https://homophony.quest/blog/52_2_19_24_bt_album/album_imgs/Tape_3_midjourney.jpg" class="img-fluid figure-img" alt="Tape 3"></a></p>
<figcaption>Tape 3</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 25.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="album_imgs/Tape_4_midjourney.jpg" class="lightbox" data-glightbox="description: .lightbox-desc-5" data-gallery="my-gallery" title="Tape 4"><img src="https://homophony.quest/blog/52_2_19_24_bt_album/album_imgs/Tape_4_midjourney.jpg" class="img-fluid figure-img" alt="Tape 4"></a></p>
<figcaption>Tape 4</figcaption>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 25.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="album_imgs/Tape_5_midjourney.jpg" class="lightbox" data-glightbox="description: .lightbox-desc-6" data-gallery="my-gallery" title="Tape 5"><img src="https://homophony.quest/blog/52_2_19_24_bt_album/album_imgs/Tape_5_midjourney.jpg" class="img-fluid figure-img" alt="Tape 5"></a></p>
<figcaption>Tape 5</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 25.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="album_imgs/Tape_6_midjourney.jpg" class="lightbox" data-glightbox="description: .lightbox-desc-7" data-gallery="my-gallery" title="Tape 6"><img src="https://homophony.quest/blog/52_2_19_24_bt_album/album_imgs/Tape_6_midjourney.jpg" class="img-fluid figure-img" alt="Tape 6"></a></p>
<figcaption>Tape 6</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 25.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="album_imgs/Tape_7_midjourney.jpg" class="lightbox" data-glightbox="description: .lightbox-desc-8" data-gallery="my-gallery" title="Tape 7"><img src="https://homophony.quest/blog/52_2_19_24_bt_album/album_imgs/Tape_7_midjourney.jpg" class="img-fluid figure-img" alt="Tape 7"></a></p>
<figcaption>Tape 7</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 25.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="album_imgs/Tape_8_midjourney.jpg" class="lightbox" data-glightbox="description: .lightbox-desc-9" data-gallery="my-gallery" title="Tape 8"><img src="https://homophony.quest/blog/52_2_19_24_bt_album/album_imgs/Tape_8_midjourney.jpg" class="img-fluid figure-img" alt="Tape 8"></a></p>
<figcaption>Tape 8</figcaption>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 25.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="album_imgs/Tape_10_midjourney.jpg" class="lightbox" data-glightbox="description: .lightbox-desc-10" data-gallery="my-gallery" title="Tape 10"><img src="https://homophony.quest/blog/52_2_19_24_bt_album/album_imgs/Tape_10_midjourney.jpg" class="img-fluid figure-img" alt="Tape 10"></a></p>
<figcaption>Tape 10</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 25.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="album_imgs/Tape_11_midjourney.jpg" class="lightbox" data-glightbox="description: .lightbox-desc-11" data-gallery="my-gallery" title="Tape 11"><img src="https://homophony.quest/blog/52_2_19_24_bt_album/album_imgs/Tape_11_midjourney.jpg" class="img-fluid figure-img" alt="Tape 11"></a></p>
<figcaption>Tape 11</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 25.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="album_imgs/Tape_13_midjourney.jpg" class="lightbox" data-glightbox="description: .lightbox-desc-12" data-gallery="my-gallery" title="Tape 13"><img src="https://homophony.quest/blog/52_2_19_24_bt_album/album_imgs/Tape_13_midjourney.jpg" class="img-fluid figure-img" alt="Tape 13"></a></p>
<figcaption>Tape 13</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 25.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="album_imgs/Track_14_midjourney.jpg" class="lightbox" data-glightbox="description: .lightbox-desc-13" data-gallery="my-gallery" title="Tape 14"><img src="https://homophony.quest/blog/52_2_19_24_bt_album/album_imgs/Track_14_midjourney.jpg" class="img-fluid figure-img" alt="Tape 14"></a></p>
<figcaption>Tape 14</figcaption>
</figure>
</div>
</div>
</div>
</div>
</section>
<section id="spotify-banner-pictures" class="level2">
<h2 class="anchored" data-anchor-id="spotify-banner-pictures">Spotify banner pictures</h2>
<p>I recently updated my spotify artist banner with this image. Although, I mostly do not use generative models when <a href="https://www.crumplab.com/things/">I make visual things</a>, I have been generating images a fair amount on this music blog.</p>
<p>For example, the spotify banner was made with <a href="https://huggingface.co/Lykon/dreamshaper-xl-turbo">Dreamshaper-xl-turbo</a>, and the source code for this one is in the python code chunk at the top of this post. This image and the others made with this process should be reproducible by using the source code and the same random seeds that I used.</p>
<p>Ideally there would be a way to at least attribute the construction of these images to their sources, as well as pay for it, perhaps like a streaming service.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/synth_27_11.jpeg" class="lightbox" data-glightbox="description: .lightbox-desc-14" data-gallery="my-gallery-2" title="synth_27_11"><img src="https://homophony.quest/blog/52_2_19_24_bt_album/images/synth_27_11.jpeg" class="img-fluid figure-img" alt="synth_27_11"></a></p>
<figcaption>synth_27_11</figcaption>
</figure>
</div>
<p>For example, this image is in some sense composed from a weighted combination from source images in the generative model, or at least it might have an interpretation as a weighted combination. If the source images and their originators were known, then this image could be attributed with a vector assigning weights to the original sources.</p>
<p>Anyway, I like cheesy stuff, and these generated images are super cheese, even smelly cheese. I will probably keep fooling around with them until I eat too much of this cheese, and go find some other cheese.</p>
</section>
<section id="instagram-reels" class="level2">
<h2 class="anchored" data-anchor-id="instagram-reels">Instagram reels</h2>
<p>Not going to get started on my feelz for reels…</p>
<p>I feel like it is a waste to make short 7 second clips just for spotify, so I’m looking to recoup my costs. I have an instagram account where I post visual stuff and am trying out the following:</p>
<ol type="1">
<li>Upload the mp4 for the spotify canvas as a reel to Instagram.</li>
<li>Distrokid has made my album available on instagram, so I choose a short loop from a track as the audio for the reel.</li>
<li>Add some notes to the reel…share it.</li>
</ol>
<p>Then, will it embed here? I guess so.</p>
<div style="width:50%;">
<blockquote class="instagram-media blockquote" data-instgrm-captioned="" data-instgrm-permalink="https://www.instagram.com/reel/C3kzqZqu529/?utm_source=ig_embed&amp;utm_campaign=loading" data-instgrm-version="14" style=" background:#FFF; border:0; border-radius:3px; box-shadow:0 0 1px 0 rgba(0,0,0,0.5),0 1px 10px 0 rgba(0,0,0,0.15); margin: 1px; max-width:540px; min-width:326px; padding:0; width:50%; width:-webkit-calc(100% - 2px); width:calc(100% - 2px);">
<div style="padding:16px;">
<a href="https://www.instagram.com/reel/C3kzqZqu529/?utm_source=ig_embed&amp;utm_campaign=loading" style=" background:#FFFFFF; line-height:0; padding:0 0; text-align:center; text-decoration:none; width:100%;" target="_blank">
<div style=" display: flex; flex-direction: row; align-items: center;">
<div style="background-color: #F4F4F4; border-radius: 50%; flex-grow: 0; height: 40px; margin-right: 14px; width: 40px;">

</div>
<div style="display: flex; flex-direction: column; flex-grow: 1; justify-content: center;">
<div style=" background-color: #F4F4F4; border-radius: 4px; flex-grow: 0; height: 14px; margin-bottom: 6px; width: 100px;">

</div>
<div style=" background-color: #F4F4F4; border-radius: 4px; flex-grow: 0; height: 14px; width: 60px;">

</div>
</div>
</div>
<div style="padding: 19% 0;">

</div>
<div style="display:block; height:50px; margin:0 auto 12px; width:50px;">
<svg width="50px" height="50px" viewbox="0 0 60 60" version="1.1" xmlns="https://www.w3.org/2000/svg" xlink="https://www.w3.org/1999/xlink">
<g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g transform="translate(-511.000000, -20.000000)" fill="#000000"><g><path d="M556.869,30.41 C554.814,30.41 553.148,32.076 553.148,34.131 C553.148,36.186 554.814,37.852 556.869,37.852 C558.924,37.852 560.59,36.186 560.59,34.131 C560.59,32.076 558.924,30.41 556.869,30.41 M541,60.657 C535.114,60.657 530.342,55.887 530.342,50 C530.342,44.114 535.114,39.342 541,39.342 C546.887,39.342 551.658,44.114 551.658,50 C551.658,55.887 546.887,60.657 541,60.657 M541,33.886 C532.1,33.886 524.886,41.1 524.886,50 C524.886,58.899 532.1,66.113 541,66.113 C549.9,66.113 557.115,58.899 557.115,50 C557.115,41.1 549.9,33.886 541,33.886 M565.378,62.101 C565.244,65.022 564.756,66.606 564.346,67.663 C563.803,69.06 563.154,70.057 562.106,71.106 C561.058,72.155 560.06,72.803 558.662,73.347 C557.607,73.757 556.021,74.244 553.102,74.378 C549.944,74.521 548.997,74.552 541,74.552 C533.003,74.552 532.056,74.521 528.898,74.378 C525.979,74.244 524.393,73.757 523.338,73.347 C521.94,72.803 520.942,72.155 519.894,71.106 C518.846,70.057 518.197,69.06 517.654,67.663 C517.244,66.606 516.755,65.022 516.623,62.101 C516.479,58.943 516.448,57.996 516.448,50 C516.448,42.003 516.479,41.056 516.623,37.899 C516.755,34.978 517.244,33.391 517.654,32.338 C518.197,30.938 518.846,29.942 519.894,28.894 C520.942,27.846 521.94,27.196 523.338,26.654 C524.393,26.244 525.979,25.756 528.898,25.623 C532.057,25.479 533.004,25.448 541,25.448 C548.997,25.448 549.943,25.479 553.102,25.623 C556.021,25.756 557.607,26.244 558.662,26.654 C560.06,27.196 561.058,27.846 562.106,28.894 C563.154,29.942 563.803,30.938 564.346,32.338 C564.756,33.391 565.244,34.978 565.378,37.899 C565.522,41.056 565.552,42.003 565.552,50 C565.552,57.996 565.522,58.943 565.378,62.101 M570.82,37.631 C570.674,34.438 570.167,32.258 569.425,30.349 C568.659,28.377 567.633,26.702 565.965,25.035 C564.297,23.368 562.623,22.342 560.652,21.575 C558.743,20.834 556.562,20.326 553.369,20.18 C550.169,20.033 549.148,20 541,20 C532.853,20 531.831,20.033 528.631,20.18 C525.438,20.326 523.257,20.834 521.349,21.575 C519.376,22.342 517.703,23.368 516.035,25.035 C514.368,26.702 513.342,28.377 512.574,30.349 C511.834,32.258 511.326,34.438 511.181,37.631 C511.035,40.831 511,41.851 511,50 C511,58.147 511.035,59.17 511.181,62.369 C511.326,65.562 511.834,67.743 512.574,69.651 C513.342,71.625 514.368,73.296 516.035,74.965 C517.703,76.634 519.376,77.658 521.349,78.425 C523.257,79.167 525.438,79.673 528.631,79.82 C531.831,79.965 532.853,80.001 541,80.001 C549.148,80.001 550.169,79.965 553.369,79.82 C556.562,79.673 558.743,79.167 560.652,78.425 C562.623,77.658 564.297,76.634 565.965,74.965 C567.633,73.296 568.659,71.625 569.425,69.651 C570.167,67.743 570.674,65.562 570.82,62.369 C570.966,59.17 571,58.147 571,50 C571,41.851 570.966,40.831 570.82,37.631"></path></g></g></g>
</svg>
</div>
<div style="padding-top: 8px;">
<div style=" color:#3897f0; font-family:Arial,sans-serif; font-size:14px; font-style:normal; font-weight:550; line-height:18px;">
View this post on Instagram
</div>
</div>
<div style="padding: 12.5% 0;">

</div>
<div style="display: flex; flex-direction: row; margin-bottom: 14px; align-items: center;">
<div>
<div style="background-color: #F4F4F4; border-radius: 50%; height: 12.5px; width: 12.5px; transform: translateX(0px) translateY(7px);">

</div>
<div style="background-color: #F4F4F4; height: 12.5px; transform: rotate(-45deg) translateX(3px) translateY(1px); width: 12.5px; flex-grow: 0; margin-right: 14px; margin-left: 2px;">

</div>
<div style="background-color: #F4F4F4; border-radius: 50%; height: 12.5px; width: 12.5px; transform: translateX(9px) translateY(-18px);">

</div>
</div>
<div style="margin-left: 8px;">
<div style=" background-color: #F4F4F4; border-radius: 50%; flex-grow: 0; height: 20px; width: 20px;">

</div>
<div style=" width: 0; height: 0; border-top: 2px solid transparent; border-left: 6px solid #f4f4f4; border-bottom: 2px solid transparent; transform: translateX(16px) translateY(-4px) rotate(30deg)">

</div>
</div>
<div style="margin-left: auto;">
<div style=" width: 0px; border-top: 8px solid #F4F4F4; border-right: 8px solid transparent; transform: translateY(16px);">

</div>
<div style=" background-color: #F4F4F4; flex-grow: 0; height: 12px; width: 16px; transform: translateY(-4px);">

</div>
<div style=" width: 0; height: 0; border-top: 8px solid #F4F4F4; border-left: 8px solid transparent; transform: translateY(-4px) translateX(8px);">

</div>
</div>
</div>
<div style="display: flex; flex-direction: column; flex-grow: 1; justify-content: center; margin-bottom: 24px;">
<div style=" background-color: #F4F4F4; border-radius: 4px; flex-grow: 0; height: 14px; margin-bottom: 6px; width: 224px;">

</div>
<div style=" background-color: #F4F4F4; border-radius: 4px; flex-grow: 0; height: 14px; width: 144px;">

</div>
</div>
</a>
<p style=" color:#c9c8cd; font-family:Arial,sans-serif; font-size:14px; line-height:17px; margin-bottom:0; margin-top:8px; overflow:hidden; padding:8px 0 7px; text-align:center; text-overflow:ellipsis; white-space:nowrap;">
<a href="https://www.instagram.com/reel/C3kzqZqu529/?utm_source=ig_embed&amp;utm_campaign=loading" style=" color:#c9c8cd; font-family:Arial,sans-serif; font-size:14px; font-style:normal; font-weight:normal; line-height:17px; text-decoration:none;" target="_blank">A post shared by Matt Crump (<span class="citation" data-cites="mattcrumplab">@mattcrumplab</span>)</a>
</p>
</div>
</blockquote>
<script async="" src="//www.instagram.com/embed.js"></script>
</div>
<p>Nuisance factor: Not easy to make an audio loop with instagram reels on the phone. I cut the video length to loop an exact length of audio, but instagram seems to have cropped the video a bit, and they don’t appear to give fine grained control over the loop start and stop time…or, perhaps it is possible, but also annoying to spend any time on.</p>
</section>
<section id="youtube-shorts" class="level2">
<h2 class="anchored" data-anchor-id="youtube-shorts">Youtube shorts</h2>
<p>I took the spotify canvas shorts, which were only 7 seconds long, and extended them to 30 seconds…with some more better after effects vfx too ;)</p>
<p>This is a playlist of all them. It was pretty fun to make these. I’ll probably make more for other tracks at some point.</p>
<iframe width="560" height="315" src="https://www.youtube-nocookie.com/embed/videoseries?si=hujwZ5LEb0flabKB&amp;list=PLDI1NnDZMA8OmYG14hXchvwxpPBypxtxf" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen="">
</iframe>
<p>Nuisance factor: although distrokid did make a youtube channel for me, and I do have control over it, the music does not show up as an option to pair with youtube shorts. Not sure why.</p>



</section>

 ]]></description>
  <category>New Release</category>
  <category>Basement Tapes 1</category>
  <category>distrokid</category>
  <guid>https://homophony.quest/blog/52_2_19_24_bt_album/</guid>
  <pubDate>Tue, 20 Feb 2024 05:00:00 GMT</pubDate>
  <media:content url="https://homophony.quest/blog/52_2_19_24_bt_album/cover.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>VO: We will go for a ride to the beach</title>
  <dc:creator>Matt Crump</dc:creator>
  <link>https://homophony.quest/blog/53_2_20_24_beach/</link>
  <description><![CDATA[ 




<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> diffusers <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> DiffusionPipeline</span>
<span id="cb1-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> transformers <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> set_seed</span>
<span id="cb1-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> PIL <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> Image</span>
<span id="cb1-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> torch</span>
<span id="cb1-5"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> random</span>
<span id="cb1-6"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> ssl</span>
<span id="cb1-7"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> os</span>
<span id="cb1-8">ssl._create_default_https_context <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ssl._create_unverified_context</span>
<span id="cb1-9"></span>
<span id="cb1-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#locate library</span></span>
<span id="cb1-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#model_id = "./stable-diffusion-v1-5"</span></span>
<span id="cb1-12">model_id <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dreamshaper-xl-turbo"</span></span>
<span id="cb1-13"></span>
<span id="cb1-14">pipeline <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> DiffusionPipeline.from_pretrained(</span>
<span id="cb1-15">    pretrained_model_name_or_path <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../../../../bigFiles/huggingface/dreamshaper-xl-turbo/"</span></span>
<span id="cb1-16">)</span>
<span id="cb1-17"></span>
<span id="cb1-18">pipeline <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pipeline.to(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mps"</span>)</span>
<span id="cb1-19"></span>
<span id="cb1-20"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Recommended if your computer has &lt; 64 GB of RAM</span></span>
<span id="cb1-21">pipeline.enable_attention_slicing(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"max"</span>)</span>
<span id="cb1-22"></span>
<span id="cb1-23">prompt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"synthesizer beach. beach view. Sunset. looking out onto the beach. 80s cartoon. linocut. synthesizer music."</span></span>
<span id="cb1-24"></span>
<span id="cb1-25"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> s <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>):</span>
<span id="cb1-26">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> n <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>]:</span>
<span id="cb1-27">    seed <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> s<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span></span>
<span id="cb1-28">    num_steps <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> n<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb1-29">    set_seed(seed)</span>
<span id="cb1-30">    </span>
<span id="cb1-31">    image <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pipeline(prompt,height <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1920</span>,width <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1080</span>,num_images_per_prompt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,num_inference_steps<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>num_steps)</span>
<span id="cb1-32">    </span>
<span id="cb1-33">    image_name <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"images/synth_</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">_</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">.jpeg"</span></span>
<span id="cb1-34">    </span>
<span id="cb1-35">    image_save <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> image.images[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].save(image_name.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">format</span>(seed,num_steps))</span></code></pre></div>
</details>
</div>
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><a href="cover.jpg" class="lightbox" data-gallery="quarto-lightbox-gallery-1"><img src="https://homophony.quest/blog/53_2_20_24_beach/cover.jpg" class="img-fluid quarto-figure quarto-figure-left figure-img" style="width:50.0%"></a></p>
</figure>
</div>

<div class="no-row-height column-margin column-container"><div class="">
<p>synthesizer beach. beach view. Sunset. looking out onto the beach. 80s cartoon. linocut. synthesizer music. - dreamshaper-xl-turbo</p>
</div></div><p>I didn’t realize that all of the tracks from my albums are selectable on instagram as music background for instagram reels.</p>
<p>I’ve occasionally posted some reels, mostly with strange video fx stuff that I was messing about with. I mostly never post reels.</p>
<p>But, I do like making strange little video clips. And, I now I could do that for each of the tracks on the older albums. That could be fun. Will it though? I need to find out.</p>
<p>I chose the song “we will go for a ride to the beach” from <a href="https://homophony.quest/music/VO.html">VO</a>. This was made in when I was deeply cloistered in my basement, dreaming of going outside once again someday in the future, to the beach.</p>
<p>Here’s the song if you’re curious. Let’s try a youtube embed this time</p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/lZNZV-wzJlM?si=SLo9afvTtSOiE9vq" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen="">
</iframe>
<p>I’m not sure how to change the video for these youtube tracks that are generated by distrokid. I do have control over this youtube channel, but these tracks are all auto-populated and I can’t seem to change them. Anyhow.</p>
<section id="basic-animation-idea" class="level2">
<h2 class="anchored" data-anchor-id="basic-animation-idea">Basic animation idea</h2>
<p>I used the python code at the top of this post to generate some images from <a href="https://huggingface.co/Lykon/dreamshaper-xl-turbo">Dreamshaper-xl-turbo</a>. I have a local copy of dreamshaper and I sometimes use it to make pictures with synthesizers in it.</p>
<p>The prompt for these was: “synthesizer beach. beach view. Sunset. looking out onto the beach. 80s cartoon. linocut. synthesizer music”. The file name for each has info about the random seed used. I only made 8 of them, but it would go on forever making variations of things that look like this.</p>
<div>

</div>
<div class="quarto-layout-panel" data-layout-ncol="4">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 25.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/synth_21_11.jpeg" class="lightbox" data-glightbox="description: .lightbox-desc-2" data-gallery="my-gallery" title="synth_21_11.jpeg"><img src="https://homophony.quest/blog/53_2_20_24_beach/images/synth_21_11.jpeg" class="img-fluid figure-img" alt="synth_21_11.jpeg"></a></p>
<figcaption>synth_21_11.jpeg</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 25.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/synth_21_6.jpeg" class="lightbox" data-glightbox="description: .lightbox-desc-3" data-gallery="my-gallery" title="synth_21_6.jpeg"><img src="https://homophony.quest/blog/53_2_20_24_beach/images/synth_21_6.jpeg" class="img-fluid figure-img" alt="synth_21_6.jpeg"></a></p>
<figcaption>synth_21_6.jpeg</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 25.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/synth_22_11.jpeg" class="lightbox" data-glightbox="description: .lightbox-desc-4" data-gallery="my-gallery" title="synth_22_11.jpeg"><img src="https://homophony.quest/blog/53_2_20_24_beach/images/synth_22_11.jpeg" class="img-fluid figure-img" alt="synth_22_11.jpeg"></a></p>
<figcaption>synth_22_11.jpeg</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 25.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/synth_22_6.jpeg" class="lightbox" data-glightbox="description: .lightbox-desc-5" data-gallery="my-gallery" title="synth_22_6.jpeg"><img src="https://homophony.quest/blog/53_2_20_24_beach/images/synth_22_6.jpeg" class="img-fluid figure-img" alt="synth_22_6.jpeg"></a></p>
<figcaption>synth_22_6.jpeg</figcaption>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 25.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/synth_23_11.jpeg" class="lightbox" data-glightbox="description: .lightbox-desc-6" data-gallery="my-gallery" title="synth_23_11.jpeg"><img src="https://homophony.quest/blog/53_2_20_24_beach/images/synth_23_11.jpeg" class="img-fluid figure-img" alt="synth_23_11.jpeg"></a></p>
<figcaption>synth_23_11.jpeg</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 25.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/synth_23_6.jpeg" class="lightbox" data-glightbox="description: .lightbox-desc-7" data-gallery="my-gallery" title="synth_23_6.jpeg"><img src="https://homophony.quest/blog/53_2_20_24_beach/images/synth_23_6.jpeg" class="img-fluid figure-img" alt="synth_23_6.jpeg"></a></p>
<figcaption>synth_23_6.jpeg</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 25.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/synth_24_11.jpeg" class="lightbox" data-glightbox="description: .lightbox-desc-8" data-gallery="my-gallery" title="synth_24_11.jpeg"><img src="https://homophony.quest/blog/53_2_20_24_beach/images/synth_24_11.jpeg" class="img-fluid figure-img" alt="synth_24_11.jpeg"></a></p>
<figcaption>synth_24_11.jpeg</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 25.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/synth_24_6.jpeg" class="lightbox" data-glightbox="description: .lightbox-desc-9" data-gallery="my-gallery" title="synth_24_6.jpeg"><img src="https://homophony.quest/blog/53_2_20_24_beach/images/synth_24_6.jpeg" class="img-fluid figure-img" alt="synth_24_6.jpeg"></a></p>
<figcaption>synth_24_6.jpeg</figcaption>
</figure>
</div>
</div>
</div>
</div>
<p>These are just OK, good enough for a quick animation project. Not sure what I’m going to do one/all of them yet, but it will involve something, probably in Adobe Fresco where I can cut them up, and do a quick animation.</p>
<p>Some very light animation was had to get the waves moving a bit. Then some colorization with after effects.</p>
<p>Tried to get the length to correspond to a musical snippet from this song, but that wasn’t super easy. I nailed it in after effects, but I’m not totally sure how instagram reels works for getting the size of a loop, so it got a bit clunky at the end.</p>
<div style="width:50%;">
<blockquote class="instagram-media blockquote" data-instgrm-captioned="" data-instgrm-permalink="https://www.instagram.com/reel/C3lEF6gOW-M/?utm_source=ig_embed&amp;utm_campaign=loading" data-instgrm-version="14" style=" background:#FFF; border:0; border-radius:3px; box-shadow:0 0 1px 0 rgba(0,0,0,0.5),0 1px 10px 0 rgba(0,0,0,0.15); margin: 1px; max-width:540px; min-width:326px; padding:0; width:99.375%; width:-webkit-calc(100% - 2px); width:calc(100% - 2px);">
<div style="padding:16px;">
<a href="https://www.instagram.com/reel/C3lEF6gOW-M/?utm_source=ig_embed&amp;utm_campaign=loading" style=" background:#FFFFFF; line-height:0; padding:0 0; text-align:center; text-decoration:none; width:100%;" target="_blank">
<div style=" display: flex; flex-direction: row; align-items: center;">
<div style="background-color: #F4F4F4; border-radius: 50%; flex-grow: 0; height: 40px; margin-right: 14px; width: 40px;">

</div>
<div style="display: flex; flex-direction: column; flex-grow: 1; justify-content: center;">
<div style=" background-color: #F4F4F4; border-radius: 4px; flex-grow: 0; height: 14px; margin-bottom: 6px; width: 100px;">

</div>
<div style=" background-color: #F4F4F4; border-radius: 4px; flex-grow: 0; height: 14px; width: 60px;">

</div>
</div>
</div>
<div style="padding: 19% 0;">

</div>
<div style="display:block; height:50px; margin:0 auto 12px; width:50px;">
<svg width="50px" height="50px" viewbox="0 0 60 60" version="1.1" xmlns="https://www.w3.org/2000/svg" xlink="https://www.w3.org/1999/xlink">
<g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g transform="translate(-511.000000, -20.000000)" fill="#000000"><g><path d="M556.869,30.41 C554.814,30.41 553.148,32.076 553.148,34.131 C553.148,36.186 554.814,37.852 556.869,37.852 C558.924,37.852 560.59,36.186 560.59,34.131 C560.59,32.076 558.924,30.41 556.869,30.41 M541,60.657 C535.114,60.657 530.342,55.887 530.342,50 C530.342,44.114 535.114,39.342 541,39.342 C546.887,39.342 551.658,44.114 551.658,50 C551.658,55.887 546.887,60.657 541,60.657 M541,33.886 C532.1,33.886 524.886,41.1 524.886,50 C524.886,58.899 532.1,66.113 541,66.113 C549.9,66.113 557.115,58.899 557.115,50 C557.115,41.1 549.9,33.886 541,33.886 M565.378,62.101 C565.244,65.022 564.756,66.606 564.346,67.663 C563.803,69.06 563.154,70.057 562.106,71.106 C561.058,72.155 560.06,72.803 558.662,73.347 C557.607,73.757 556.021,74.244 553.102,74.378 C549.944,74.521 548.997,74.552 541,74.552 C533.003,74.552 532.056,74.521 528.898,74.378 C525.979,74.244 524.393,73.757 523.338,73.347 C521.94,72.803 520.942,72.155 519.894,71.106 C518.846,70.057 518.197,69.06 517.654,67.663 C517.244,66.606 516.755,65.022 516.623,62.101 C516.479,58.943 516.448,57.996 516.448,50 C516.448,42.003 516.479,41.056 516.623,37.899 C516.755,34.978 517.244,33.391 517.654,32.338 C518.197,30.938 518.846,29.942 519.894,28.894 C520.942,27.846 521.94,27.196 523.338,26.654 C524.393,26.244 525.979,25.756 528.898,25.623 C532.057,25.479 533.004,25.448 541,25.448 C548.997,25.448 549.943,25.479 553.102,25.623 C556.021,25.756 557.607,26.244 558.662,26.654 C560.06,27.196 561.058,27.846 562.106,28.894 C563.154,29.942 563.803,30.938 564.346,32.338 C564.756,33.391 565.244,34.978 565.378,37.899 C565.522,41.056 565.552,42.003 565.552,50 C565.552,57.996 565.522,58.943 565.378,62.101 M570.82,37.631 C570.674,34.438 570.167,32.258 569.425,30.349 C568.659,28.377 567.633,26.702 565.965,25.035 C564.297,23.368 562.623,22.342 560.652,21.575 C558.743,20.834 556.562,20.326 553.369,20.18 C550.169,20.033 549.148,20 541,20 C532.853,20 531.831,20.033 528.631,20.18 C525.438,20.326 523.257,20.834 521.349,21.575 C519.376,22.342 517.703,23.368 516.035,25.035 C514.368,26.702 513.342,28.377 512.574,30.349 C511.834,32.258 511.326,34.438 511.181,37.631 C511.035,40.831 511,41.851 511,50 C511,58.147 511.035,59.17 511.181,62.369 C511.326,65.562 511.834,67.743 512.574,69.651 C513.342,71.625 514.368,73.296 516.035,74.965 C517.703,76.634 519.376,77.658 521.349,78.425 C523.257,79.167 525.438,79.673 528.631,79.82 C531.831,79.965 532.853,80.001 541,80.001 C549.148,80.001 550.169,79.965 553.369,79.82 C556.562,79.673 558.743,79.167 560.652,78.425 C562.623,77.658 564.297,76.634 565.965,74.965 C567.633,73.296 568.659,71.625 569.425,69.651 C570.167,67.743 570.674,65.562 570.82,62.369 C570.966,59.17 571,58.147 571,50 C571,41.851 570.966,40.831 570.82,37.631"></path></g></g></g>
</svg>
</div>
<div style="padding-top: 8px;">
<div style=" color:#3897f0; font-family:Arial,sans-serif; font-size:14px; font-style:normal; font-weight:550; line-height:18px;">
View this post on Instagram
</div>
</div>
<div style="padding: 12.5% 0;">

</div>
<div style="display: flex; flex-direction: row; margin-bottom: 14px; align-items: center;">
<div>
<div style="background-color: #F4F4F4; border-radius: 50%; height: 12.5px; width: 12.5px; transform: translateX(0px) translateY(7px);">

</div>
<div style="background-color: #F4F4F4; height: 12.5px; transform: rotate(-45deg) translateX(3px) translateY(1px); width: 12.5px; flex-grow: 0; margin-right: 14px; margin-left: 2px;">

</div>
<div style="background-color: #F4F4F4; border-radius: 50%; height: 12.5px; width: 12.5px; transform: translateX(9px) translateY(-18px);">

</div>
</div>
<div style="margin-left: 8px;">
<div style=" background-color: #F4F4F4; border-radius: 50%; flex-grow: 0; height: 20px; width: 20px;">

</div>
<div style=" width: 0; height: 0; border-top: 2px solid transparent; border-left: 6px solid #f4f4f4; border-bottom: 2px solid transparent; transform: translateX(16px) translateY(-4px) rotate(30deg)">

</div>
</div>
<div style="margin-left: auto;">
<div style=" width: 0px; border-top: 8px solid #F4F4F4; border-right: 8px solid transparent; transform: translateY(16px);">

</div>
<div style=" background-color: #F4F4F4; flex-grow: 0; height: 12px; width: 16px; transform: translateY(-4px);">

</div>
<div style=" width: 0; height: 0; border-top: 8px solid #F4F4F4; border-left: 8px solid transparent; transform: translateY(-4px) translateX(8px);">

</div>
</div>
</div>
<div style="display: flex; flex-direction: column; flex-grow: 1; justify-content: center; margin-bottom: 24px;">
<div style=" background-color: #F4F4F4; border-radius: 4px; flex-grow: 0; height: 14px; margin-bottom: 6px; width: 224px;">

</div>
<div style=" background-color: #F4F4F4; border-radius: 4px; flex-grow: 0; height: 14px; width: 144px;">

</div>
</div>
</a>
<p style=" color:#c9c8cd; font-family:Arial,sans-serif; font-size:14px; line-height:17px; margin-bottom:0; margin-top:8px; overflow:hidden; padding:8px 0 7px; text-align:center; text-overflow:ellipsis; white-space:nowrap;">
<a href="https://www.instagram.com/reel/C3lEF6gOW-M/?utm_source=ig_embed&amp;utm_campaign=loading" style=" color:#c9c8cd; font-family:Arial,sans-serif; font-size:14px; font-style:normal; font-weight:normal; line-height:17px; text-decoration:none;" target="_blank">A post shared by Matt Crump (<span class="citation" data-cites="mattcrumplab">@mattcrumplab</span>)</a>
</p>
</div>
</blockquote>
<script async="" src="//www.instagram.com/embed.js"></script>
<div>















</div></div></section>

 ]]></description>
  <category>VO</category>
  <category>video</category>
  <guid>https://homophony.quest/blog/53_2_20_24_beach/</guid>
  <pubDate>Tue, 20 Feb 2024 05:00:00 GMT</pubDate>
  <media:content url="https://homophony.quest/blog/53_2_20_24_beach/cover.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>Airwolf trap remix</title>
  <dc:creator>Matt Crump</dc:creator>
  <link>https://homophony.quest/blog/51_2_18_24_airwolf/</link>
  <description><![CDATA[ 




<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> diffusers <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> DiffusionPipeline</span>
<span id="cb1-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> transformers <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> set_seed</span>
<span id="cb1-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> PIL <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> Image</span>
<span id="cb1-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> torch</span>
<span id="cb1-5"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> random</span>
<span id="cb1-6"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> ssl</span>
<span id="cb1-7"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> os</span>
<span id="cb1-8">ssl._create_default_https_context <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ssl._create_unverified_context</span>
<span id="cb1-9"></span>
<span id="cb1-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#locate library</span></span>
<span id="cb1-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#model_id = "./stable-diffusion-v1-5"</span></span>
<span id="cb1-12">model_id <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dreamshaper-xl-turbo"</span></span>
<span id="cb1-13"></span>
<span id="cb1-14">pipeline <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> DiffusionPipeline.from_pretrained(</span>
<span id="cb1-15">    pretrained_model_name_or_path <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../../../../bigFiles/huggingface/dreamshaper-xl-turbo/"</span></span>
<span id="cb1-16">)</span>
<span id="cb1-17"></span>
<span id="cb1-18">pipeline <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pipeline.to(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mps"</span>)</span>
<span id="cb1-19"></span>
<span id="cb1-20"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Recommended if your computer has &lt; 64 GB of RAM</span></span>
<span id="cb1-21">pipeline.enable_attention_slicing(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"max"</span>)</span>
<span id="cb1-22"></span>
<span id="cb1-23">prompt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Chunky square wave. house beats. convolution reverb. A little dark analog delay. lots of stereo. busy. synthesizers. megazord. linocut"</span></span>
<span id="cb1-24"></span>
<span id="cb1-25"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> s <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>):</span>
<span id="cb1-26">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> n <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>]:</span>
<span id="cb1-27">    seed <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> s<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span></span>
<span id="cb1-28">    num_steps <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> n<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb1-29">    set_seed(seed)</span>
<span id="cb1-30">    </span>
<span id="cb1-31">    image <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pipeline(prompt,height <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1024</span>,width <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1024</span>,num_images_per_prompt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,num_inference_steps<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>num_steps)</span>
<span id="cb1-32">    </span>
<span id="cb1-33">    image_name <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"images/synth_</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">_</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">.jpeg"</span></span>
<span id="cb1-34">    </span>
<span id="cb1-35">    image_save <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> image.images[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].save(image_name.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">format</span>(seed,num_steps))</span></code></pre></div>
</details>
</div>
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><img src="https://homophony.quest/blog/51_2_18_24_airwolf/cover.jpg" class="img-fluid quarto-figure quarto-figure-left figure-img" style="width:50.0%"></p>
</figure>
</div>

<div class="no-row-height column-margin column-container"><div class="">
<p>Screenshot from Airwolf for NES</p>
</div></div><p>Continuing in the glorious tradition of screwing around with NES midi files.</p>
<section id="airwolf-trap-remix" class="level2">
<h2 class="anchored" data-anchor-id="airwolf-trap-remix">Airwolf trap remix</h2>
<p><audio controls=""> <source src="Airwolf.mp3" type="audio/wav"> </audio></p>


</section>

 ]]></description>
  <category>airwolf</category>
  <category>nes</category>
  <category>midi remix</category>
  <guid>https://homophony.quest/blog/51_2_18_24_airwolf/</guid>
  <pubDate>Sun, 18 Feb 2024 05:00:00 GMT</pubDate>
  <media:content url="https://homophony.quest/blog/51_2_18_24_airwolf/cover.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>Composition tests</title>
  <dc:creator>Matt Crump</dc:creator>
  <link>https://homophony.quest/blog/50_2_16_24_comps/</link>
  <description><![CDATA[ 




<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> diffusers <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> DiffusionPipeline</span>
<span id="cb1-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> transformers <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> set_seed</span>
<span id="cb1-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> PIL <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> Image</span>
<span id="cb1-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> torch</span>
<span id="cb1-5"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> random</span>
<span id="cb1-6"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> ssl</span>
<span id="cb1-7"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> os</span>
<span id="cb1-8">ssl._create_default_https_context <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ssl._create_unverified_context</span>
<span id="cb1-9"></span>
<span id="cb1-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#locate library</span></span>
<span id="cb1-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#model_id = "./stable-diffusion-v1-5"</span></span>
<span id="cb1-12">model_id <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dreamshaper-xl-turbo"</span></span>
<span id="cb1-13"></span>
<span id="cb1-14">pipeline <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> DiffusionPipeline.from_pretrained(</span>
<span id="cb1-15">    pretrained_model_name_or_path <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../../../../bigFiles/huggingface/dreamshaper-xl-turbo/"</span></span>
<span id="cb1-16">)</span>
<span id="cb1-17"></span>
<span id="cb1-18">pipeline <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pipeline.to(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mps"</span>)</span>
<span id="cb1-19"></span>
<span id="cb1-20"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Recommended if your computer has &lt; 64 GB of RAM</span></span>
<span id="cb1-21">pipeline.enable_attention_slicing(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"max"</span>)</span>
<span id="cb1-22"></span>
<span id="cb1-23">prompt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Chunky square wave. house beats. convolution reverb. A little dark analog delay. lots of stereo. busy. synthesizers. megazord. linocut"</span></span>
<span id="cb1-24"></span>
<span id="cb1-25"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> s <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>):</span>
<span id="cb1-26">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> n <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>]:</span>
<span id="cb1-27">    seed <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> s<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span></span>
<span id="cb1-28">    num_steps <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> n<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb1-29">    set_seed(seed)</span>
<span id="cb1-30">    </span>
<span id="cb1-31">    image <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pipeline(prompt,height <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1024</span>,width <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1024</span>,num_images_per_prompt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,num_inference_steps<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>num_steps)</span>
<span id="cb1-32">    </span>
<span id="cb1-33">    image_name <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"images/synth_</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">_</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">.jpeg"</span></span>
<span id="cb1-34">    </span>
<span id="cb1-35">    image_save <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> image.images[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].save(image_name.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">format</span>(seed,num_steps))</span></code></pre></div>
</details>
</div>
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><img src="https://homophony.quest/blog/50_2_16_24_comps/cover.jpg" class="img-fluid quarto-figure quarto-figure-left figure-img" style="width:50.0%"></p>
</figure>
</div>

<div class="no-row-height column-margin column-container"><div class="">
<p>“Chunky square wave. house beats. convolution reverb. A little dark analog delay. lots of stereo. busy. synthesizers. megazord. linocut”</p>
<hr>
<p>This image was produced by dreamshaper-xl-turbo using the above prompt, and should be reproducible with the source code.</p>
</div></div><section id="comp-1" class="level2">
<h2 class="anchored" data-anchor-id="comp-1">Comp 1</h2>
<p>Some tests.</p>
<p>-add drums and synth voices</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(midiblender)</span>
<span id="cb2-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(dplyr)</span>
<span id="cb2-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(pyramidi)</span>
<span id="cb2-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(fluidsynth)</span>
<span id="cb2-5"></span>
<span id="cb2-6">all_tracks <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>()</span>
<span id="cb2-7"></span>
<span id="cb2-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># note parameters</span></span>
<span id="cb2-9">  bars <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span> </span>
<span id="cb2-10">  repeat_bars <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span></span>
<span id="cb2-11">  possible_time_steps <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span></span>
<span id="cb2-12">  note_interval <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">24</span></span>
<span id="cb2-13">  note_duration <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">48</span></span>
<span id="cb2-14">  </span>
<span id="cb2-15">  track_params <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">track_1_kick =</span></span>
<span id="cb2-16">                         <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">possible_notes =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)), </span>
<span id="cb2-17">                              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">key_vector =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>), </span>
<span id="cb2-18">                                                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">each =</span> possible_time_steps), </span>
<span id="cb2-19">                                             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times =</span> repeat_bars),</span>
<span id="cb2-20">                              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">possible_beats =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">13</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)),</span>
<span id="cb2-21">                              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">program =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb2-22">                              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">channel =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,</span>
<span id="cb2-23">                              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note_interval =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">24</span>,</span>
<span id="cb2-24">                              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note_duration =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">48</span></span>
<span id="cb2-25">                           ),</span>
<span id="cb2-26">                       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">track_2_snare =</span></span>
<span id="cb2-27">                         <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">possible_notes =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)),  </span>
<span id="cb2-28">                            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">key_vector =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>), </span>
<span id="cb2-29">                                                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">each =</span> possible_time_steps), </span>
<span id="cb2-30">                                             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times =</span> repeat_bars),</span>
<span id="cb2-31">                            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">possible_beats =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)),</span>
<span id="cb2-32">                            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">program =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,</span>
<span id="cb2-33">                            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">channel =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,</span>
<span id="cb2-34">                            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note_interval =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">24</span>,</span>
<span id="cb2-35">                            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note_duration =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">48</span></span>
<span id="cb2-36">                          ),</span>
<span id="cb2-37">                       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">track_3_cymb =</span></span>
<span id="cb2-38">                         <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">possible_notes =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)),  </span>
<span id="cb2-39">                            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">key_vector =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>), </span>
<span id="cb2-40">                                                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">each =</span> possible_time_steps), </span>
<span id="cb2-41">                                             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times =</span> repeat_bars),</span>
<span id="cb2-42">                            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">possible_beats =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)),</span>
<span id="cb2-43">                            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">program =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,</span>
<span id="cb2-44">                            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">channel =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,</span>
<span id="cb2-45">                            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note_interval =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">24</span>,</span>
<span id="cb2-46">                            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note_duration =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">48</span></span>
<span id="cb2-47">                          ),</span>
<span id="cb2-48">                       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">track_4_synth =</span></span>
<span id="cb2-49">                         <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">possible_notes =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(((<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">60</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">72</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">24</span>),   <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#1     2     3  4     5     6     7  8 </span></span>
<span id="cb2-50">                                                   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)), </span>
<span id="cb2-51">                            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">key_vector =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>), </span>
<span id="cb2-52">                                                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">each =</span> possible_time_steps), </span>
<span id="cb2-53">                                             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times =</span> repeat_bars),</span>
<span id="cb2-54">                            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">possible_beats =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">13</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">13</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)),</span>
<span id="cb2-55">                            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">program =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>,</span>
<span id="cb2-56">                            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">channel =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>,</span>
<span id="cb2-57">                            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note_interval =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">24</span>,</span>
<span id="cb2-58">                            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note_duration =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">24</span>), possible_time_steps<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>bars<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>repeat_bars, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">replace =</span> T)</span>
<span id="cb2-59">                          ),</span>
<span id="cb2-60">                       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">track_5_synth =</span></span>
<span id="cb2-61">                         <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">possible_notes =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(((<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">60</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">72</span>)),   <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#1     2     3  4     5     6     7  8 </span></span>
<span id="cb2-62">                                                   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)), </span>
<span id="cb2-63">                            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">key_vector =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>), </span>
<span id="cb2-64">                                                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">each =</span> possible_time_steps), </span>
<span id="cb2-65">                                             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times =</span> repeat_bars),</span>
<span id="cb2-66">                            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">possible_beats =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">13</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)),</span>
<span id="cb2-67">                            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">program =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>,</span>
<span id="cb2-68">                            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">channel =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,</span>
<span id="cb2-69">                            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note_interval =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">24</span>,</span>
<span id="cb2-70">                            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note_duration =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">24</span>), possible_time_steps<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>bars<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>repeat_bars, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">replace =</span> T)</span>
<span id="cb2-71">                          )</span>
<span id="cb2-72">  )</span>
<span id="cb2-73">                       </span>
<span id="cb2-74">                           </span>
<span id="cb2-75"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># loop for each track</span></span>
<span id="cb2-76"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span>(t <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>) {</span>
<span id="cb2-77">  </span>
<span id="cb2-78">  compose_notes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> tibble<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>(</span>
<span id="cb2-79">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note_id =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">integer</span>(),</span>
<span id="cb2-80">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">integer</span>(),</span>
<span id="cb2-81">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">beat_on =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">integer</span>(),</span>
<span id="cb2-82">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note_on =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">integer</span>(),</span>
<span id="cb2-83">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note_off =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">integer</span>()</span>
<span id="cb2-84">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb2-85">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># use euclidean rhythm</span></span>
<span id="cb2-86">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rowwise</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb2-87">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_row</span>(</span>
<span id="cb2-88">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">beat_on =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">replicate</span>(</span>
<span id="cb2-89">        bars<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>repeat_bars,</span>
<span id="cb2-90">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bresenham_euclidean</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(track_params[[t]]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>possible_beats, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), </span>
<span id="cb2-91">                            possible_time_steps,</span>
<span id="cb2-92">                            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">start =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb2-93">      )),</span>
<span id="cb2-94">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(track_params[[t]]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>possible_notes,</span>
<span id="cb2-95">                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> possible_time_steps <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (bars<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>repeat_bars),</span>
<span id="cb2-96">                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">replace =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> track_params[[t]]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>key_vector</span>
<span id="cb2-97">    ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb2-98">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ungroup</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb2-99">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># handle note times</span></span>
<span id="cb2-100">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb2-101">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note_id =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">n</span>(),</span>
<span id="cb2-102">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note_on =</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">n</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> track_params[[t]]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>note_interval,</span>
<span id="cb2-103">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note_off =</span> note_on <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> track_params[[t]]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>note_duration</span>
<span id="cb2-104">    ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb2-105">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(beat_on <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb2-106">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#pivot to long</span></span>
<span id="cb2-107">    tidyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_longer</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"note_on"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"note_off"</span>),</span>
<span id="cb2-108">                        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"type"</span>,</span>
<span id="cb2-109">                        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"time"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb2-110">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrange</span>(time) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb2-111">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">time =</span> time <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lag</span>(time, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">default =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>),</span>
<span id="cb2-112">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">channel =</span> track_params[[t]]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>channel)</span>
<span id="cb2-113">  <span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">######################</span></span>
<span id="cb2-114">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># End composition </span></span>
<span id="cb2-115">  </span>
<span id="cb2-116">  <span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">#######################</span></span>
<span id="cb2-117">  <span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## add composition to a new midi df</span></span>
<span id="cb2-118">  new_midi_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">create_empty_midi_df</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># initialize</span></span>
<span id="cb2-119">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_meta_track_name</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"My track"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb2-120">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_meta_tempo</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">tempo =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">500000</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb2-121">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_meta_time_sig</span>(</span>
<span id="cb2-122">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">numerator =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>,</span>
<span id="cb2-123">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">denominator =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>,</span>
<span id="cb2-124">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">clocks_per_click =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">36</span>,</span>
<span id="cb2-125">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">notated_32nd_notes_per_beat =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span></span>
<span id="cb2-126">    ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb2-127">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_program_change</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">program =</span> track_params[[t]]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>program,</span>
<span id="cb2-128">                       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">channel =</span> track_params[[t]]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>channel) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb2-129">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_control_change</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">control =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">value =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb2-130">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Composition added here</span></span>
<span id="cb2-131">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_row</span>(</span>
<span id="cb2-132">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">i_track =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dim</span>(compose_notes)[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]),</span>
<span id="cb2-133">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">meta =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dim</span>(compose_notes)[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]),</span>
<span id="cb2-134">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note =</span> compose_notes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>note,</span>
<span id="cb2-135">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> compose_notes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>type,</span>
<span id="cb2-136">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">time =</span> compose_notes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>time,</span>
<span id="cb2-137">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">channel =</span> compose_notes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>channel,</span>
<span id="cb2-138">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">velocity =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>L<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">112</span>L,<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dim</span>(compose_notes)[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>],<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">replace=</span>T)</span>
<span id="cb2-139">      <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#velocity = 64</span></span>
<span id="cb2-140">    ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb2-141">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_meta_end_of_track</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb2-142">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">i_track =</span> t) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb2-143">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">velocity =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">case_when</span>(type <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"note_on"</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> velocity,</span>
<span id="cb2-144">                                type <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"note_off"</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>))<span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># set current track number</span></span>
<span id="cb2-145">  </span>
<span id="cb2-146">  all_tracks <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbind</span>(all_tracks,new_midi_df)</span>
<span id="cb2-147">  </span>
<span id="cb2-148">}</span>
<span id="cb2-149"></span>
<span id="cb2-150"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#write midi</span></span>
<span id="cb2-151"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#Initialize new pyramidi object</span></span>
<span id="cb2-152">new_pyramidi_object <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> pyramidi<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span>MidiFramer<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">new</span>()</span>
<span id="cb2-153"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># update ticks per beat</span></span>
<span id="cb2-154">new_pyramidi_object<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>ticks_per_beat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">96</span>L</span>
<span id="cb2-155"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># update object with new midi df</span></span>
<span id="cb2-156">new_pyramidi_object<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>mf<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>midi_frame_unnested<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">update_unnested_mf</span>(all_tracks)</span>
<span id="cb2-157"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># write to midi file</span></span>
<span id="cb2-158">new_pyramidi_object<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>mf<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">write_file</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"TE-EP-133-C.mid"</span>)</span>
<span id="cb2-159"></span>
<span id="cb2-160"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># play</span></span>
<span id="cb2-161">fluidsynth<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">midi_play</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">midi =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"TE-EP-133-C.mid"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">soundfont =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"~/Library/Audio/Sounds/Banks/TE-EP-133-A.sf2"</span>)</span>
<span id="cb2-162"></span>
<span id="cb2-163"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#bounce</span></span>
<span id="cb2-164">fluidsynth<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">midi_convert</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">midi =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"TE-EP-133-C.mid"</span>,</span>
<span id="cb2-165">                         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">soundfont =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"~/Library/Audio/Sounds/Banks/TE-EP-133-A.sf2"</span>,</span>
<span id="cb2-166">                         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">output =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"TE-EP-133-D.mp3"</span>)</span></code></pre></div>
</details>
</div>
<p><audio controls=""> <source src="TE-EP-133-D.mp3" type="audio/wav"> </audio></p>
</section>
<section id="comp-2" class="level2">
<h2 class="anchored" data-anchor-id="comp-2">Comp 2</h2>
<ul>
<li>get super basic, increase repetition, 4 on floor</li>
<li>increase gain</li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(midiblender)</span>
<span id="cb3-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(dplyr)</span>
<span id="cb3-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(pyramidi)</span>
<span id="cb3-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(fluidsynth)</span></code></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1">all_tracks <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>()</span>
<span id="cb4-2"></span>
<span id="cb4-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># note parameters</span></span>
<span id="cb4-4">  bars <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span> </span>
<span id="cb4-5">  repeat_bars <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span></span>
<span id="cb4-6">  possible_time_steps <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span></span>
<span id="cb4-7">  note_interval <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">24</span></span>
<span id="cb4-8">  note_duration <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">48</span></span>
<span id="cb4-9">  </span>
<span id="cb4-10">  track_params <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">track_1_kick =</span></span>
<span id="cb4-11">                         <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">possible_notes =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)), </span>
<span id="cb4-12">                              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">key_vector =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>), </span>
<span id="cb4-13">                                                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">each =</span> possible_time_steps), </span>
<span id="cb4-14">                                             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times =</span> repeat_bars),</span>
<span id="cb4-15">                              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">possible_beats =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)),</span>
<span id="cb4-16">                              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">program =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb4-17">                              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">channel =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,</span>
<span id="cb4-18">                              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note_interval =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">24</span>,</span>
<span id="cb4-19">                              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note_duration =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">48</span>,</span>
<span id="cb4-20">                              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">velocity =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">80</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">127</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> (possible_time_steps<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>bars<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>repeat_bars), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">replace =</span> T)</span>
<span id="cb4-21">                           ),</span>
<span id="cb4-22">                       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">track_2_snare =</span></span>
<span id="cb4-23">                         <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">possible_notes =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)),  </span>
<span id="cb4-24">                            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">key_vector =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>), </span>
<span id="cb4-25">                                                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">each =</span> possible_time_steps), </span>
<span id="cb4-26">                                             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times =</span> repeat_bars),</span>
<span id="cb4-27">                            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">possible_beats =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)),</span>
<span id="cb4-28">                            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">program =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,</span>
<span id="cb4-29">                            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">channel =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,</span>
<span id="cb4-30">                            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note_interval =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">24</span>,</span>
<span id="cb4-31">                            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note_duration =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">48</span>,</span>
<span id="cb4-32">                            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">velocity =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">80</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">127</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> (possible_time_steps<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>bars<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>repeat_bars), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">replace =</span> T)</span>
<span id="cb4-33">                          ),</span>
<span id="cb4-34">                       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">track_3_cymb =</span></span>
<span id="cb4-35">                         <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">possible_notes =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">35</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">33</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">64</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)),  </span>
<span id="cb4-36">                            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">key_vector =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>), </span>
<span id="cb4-37">                                                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">each =</span> possible_time_steps), </span>
<span id="cb4-38">                                             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times =</span> repeat_bars),</span>
<span id="cb4-39">                            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">possible_beats =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">13</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)),</span>
<span id="cb4-40">                            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">program =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,</span>
<span id="cb4-41">                            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">channel =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,</span>
<span id="cb4-42">                            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note_interval =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">24</span>,</span>
<span id="cb4-43">                            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note_duration =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">48</span>,</span>
<span id="cb4-44">                            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">velocity =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">127</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> (possible_time_steps<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>bars<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>repeat_bars), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">replace =</span> T)</span>
<span id="cb4-45">                          ),</span>
<span id="cb4-46">                       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">track_4_synth =</span></span>
<span id="cb4-47">                         <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">possible_notes =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(((<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">60</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">72</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">24</span>),   <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#1     2     3  4     5     6     7  8 </span></span>
<span id="cb4-48">                                                   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)), </span>
<span id="cb4-49">                            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">key_vector =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>), </span>
<span id="cb4-50">                                                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">each =</span> possible_time_steps), </span>
<span id="cb4-51">                                             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times =</span> repeat_bars),</span>
<span id="cb4-52">                            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">possible_beats =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">13</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">13</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)),</span>
<span id="cb4-53">                            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">program =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>,</span>
<span id="cb4-54">                            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">channel =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>,</span>
<span id="cb4-55">                            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note_interval =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">24</span>,</span>
<span id="cb4-56">                            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note_duration =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">24</span>), possible_time_steps<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>bars<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>repeat_bars, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">replace =</span> T),</span>
<span id="cb4-57">                            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">velocity =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">127</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times =</span> (possible_time_steps<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>bars<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>repeat_bars))</span>
<span id="cb4-58">                          ),</span>
<span id="cb4-59">                       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">track_5_synth =</span></span>
<span id="cb4-60">                         <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">possible_notes =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(((<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">60</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">72</span>)),   <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#1     2     3  4     5     6     7  8 </span></span>
<span id="cb4-61">                                                   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)), </span>
<span id="cb4-62">                            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">key_vector =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>), </span>
<span id="cb4-63">                                                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">each =</span> possible_time_steps), </span>
<span id="cb4-64">                                             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times =</span> repeat_bars),</span>
<span id="cb4-65">                            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">possible_beats =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">13</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)),</span>
<span id="cb4-66">                            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">program =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>,</span>
<span id="cb4-67">                            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">channel =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,</span>
<span id="cb4-68">                            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note_interval =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">24</span>,</span>
<span id="cb4-69">                            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note_duration =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">24</span>), possible_time_steps<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>bars<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>repeat_bars, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">replace =</span> T),</span>
<span id="cb4-70">                            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">velocity =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">127</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times =</span> (possible_time_steps<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>bars<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>repeat_bars))</span>
<span id="cb4-71">                          )</span>
<span id="cb4-72">  )</span>
<span id="cb4-73">                       </span>
<span id="cb4-74">                           </span>
<span id="cb4-75"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># loop for each track</span></span>
<span id="cb4-76"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span>(t <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>) {</span>
<span id="cb4-77">  </span>
<span id="cb4-78">  compose_notes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> tibble<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>(</span>
<span id="cb4-79">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note_id =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">integer</span>(),</span>
<span id="cb4-80">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">integer</span>(),</span>
<span id="cb4-81">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">beat_on =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">integer</span>(),</span>
<span id="cb4-82">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note_on =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">integer</span>(),</span>
<span id="cb4-83">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note_off =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">integer</span>(),</span>
<span id="cb4-84">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">velocity =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">integer</span>()</span>
<span id="cb4-85">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb4-86">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># use euclidean rhythm</span></span>
<span id="cb4-87">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rowwise</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb4-88">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_row</span>(</span>
<span id="cb4-89">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">beat_on =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">replicate</span>(</span>
<span id="cb4-90">        bars<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>repeat_bars,</span>
<span id="cb4-91">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bresenham_euclidean</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(track_params[[t]]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>possible_beats, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), </span>
<span id="cb4-92">                            possible_time_steps,</span>
<span id="cb4-93">                            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">start =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb4-94">      )),</span>
<span id="cb4-95">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(track_params[[t]]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>possible_notes,</span>
<span id="cb4-96">                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> possible_time_steps <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (bars<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>repeat_bars),</span>
<span id="cb4-97">                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">replace =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> track_params[[t]]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>key_vector,</span>
<span id="cb4-98">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">velocity =</span> track_params[[t]]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>velocity </span>
<span id="cb4-99">    ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb4-100">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ungroup</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb4-101">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># handle note times</span></span>
<span id="cb4-102">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb4-103">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note_id =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">n</span>(),</span>
<span id="cb4-104">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note_on =</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">n</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> track_params[[t]]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>note_interval,</span>
<span id="cb4-105">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note_off =</span> note_on <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> track_params[[t]]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>note_duration</span>
<span id="cb4-106">    ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb4-107">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(beat_on <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb4-108">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#pivot to long</span></span>
<span id="cb4-109">    tidyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_longer</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"note_on"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"note_off"</span>),</span>
<span id="cb4-110">                        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"type"</span>,</span>
<span id="cb4-111">                        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"time"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb4-112">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrange</span>(time) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb4-113">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">time =</span> time <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lag</span>(time, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">default =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>),</span>
<span id="cb4-114">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">channel =</span> track_params[[t]]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>channel)</span>
<span id="cb4-115">  <span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">######################</span></span>
<span id="cb4-116">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># End composition </span></span>
<span id="cb4-117">  </span>
<span id="cb4-118">  <span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">#######################</span></span>
<span id="cb4-119">  <span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## add composition to a new midi df</span></span>
<span id="cb4-120">  new_midi_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">create_empty_midi_df</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># initialize</span></span>
<span id="cb4-121">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_meta_track_name</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"My track"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb4-122">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_meta_tempo</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">tempo =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">600000</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb4-123">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_meta_time_sig</span>(</span>
<span id="cb4-124">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">numerator =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>,</span>
<span id="cb4-125">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">denominator =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>,</span>
<span id="cb4-126">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">clocks_per_click =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">36</span>,</span>
<span id="cb4-127">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">notated_32nd_notes_per_beat =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span></span>
<span id="cb4-128">    ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb4-129">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_program_change</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">program =</span> track_params[[t]]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>program,</span>
<span id="cb4-130">                       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">channel =</span> track_params[[t]]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>channel) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb4-131">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_control_change</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">control =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">value =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb4-132">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Composition added here</span></span>
<span id="cb4-133">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_row</span>(</span>
<span id="cb4-134">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">i_track =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dim</span>(compose_notes)[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]),</span>
<span id="cb4-135">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">meta =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dim</span>(compose_notes)[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]),</span>
<span id="cb4-136">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note =</span> compose_notes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>note,</span>
<span id="cb4-137">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> compose_notes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>type,</span>
<span id="cb4-138">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">time =</span> compose_notes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>time,</span>
<span id="cb4-139">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">channel =</span> compose_notes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>channel,</span>
<span id="cb4-140">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">velocity =</span> compose_notes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>velocity</span>
<span id="cb4-141">      <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#velocity = 64</span></span>
<span id="cb4-142">    ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb4-143">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_meta_end_of_track</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb4-144">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">velocity =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">case_when</span>(type <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"note_on"</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> velocity,</span>
<span id="cb4-145">                                type <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"note_off"</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>))</span>
<span id="cb4-146">  </span>
<span id="cb4-147">  all_tracks <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbind</span>(all_tracks,new_midi_df)</span>
<span id="cb4-148">  </span>
<span id="cb4-149">}</span>
<span id="cb4-150"></span>
<span id="cb4-151"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#write midi</span></span>
<span id="cb4-152"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#Initialize new pyramidi object</span></span>
<span id="cb4-153">new_pyramidi_object <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> pyramidi<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span>MidiFramer<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">new</span>()</span>
<span id="cb4-154"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># update ticks per beat</span></span>
<span id="cb4-155">new_pyramidi_object<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>ticks_per_beat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">96</span>L</span>
<span id="cb4-156"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># update object with new midi df</span></span>
<span id="cb4-157">new_pyramidi_object<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>mf<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>midi_frame_unnested<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">update_unnested_mf</span>(all_tracks)</span>
<span id="cb4-158"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># write to midi file</span></span>
<span id="cb4-159">new_pyramidi_object<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>mf<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">write_file</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"TE-EP-133-E.mid"</span>)</span>
<span id="cb4-160"></span>
<span id="cb4-161"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># play</span></span>
<span id="cb4-162">fluidsynth<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">midi_play</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">midi =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"TE-EP-133-E.mid"</span>,</span>
<span id="cb4-163">                      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">soundfont =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"~/Library/Audio/Sounds/Banks/TE-EP-133-A.sf2"</span>,</span>
<span id="cb4-164">                      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">settings =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'synth.gain'</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>))</span></code></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#bounce</span></span>
<span id="cb5-2">fluidsynth<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">midi_convert</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">midi =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"TE-EP-133-E.mid"</span>,</span>
<span id="cb5-3">                         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">soundfont =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"~/Library/Audio/Sounds/Banks/TE-EP-133-A.sf2"</span>,</span>
<span id="cb5-4">                         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">output =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"TE-EP-133-E_synth_Eb.mp3"</span>,</span>
<span id="cb5-5">                         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">settings =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'synth.gain'</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>))</span></code></pre></div>
</details>
</div>
<p>This ended up being fun. I bounced a couple 24 bar drum tracks to ableton generated from this script. And, a simple synth track. Then used that source material to get this going.</p>
<p><audio controls=""> <source src="EP-133_E_song.mp3" type="audio/wav"> </audio></p>
</section>
<section id="comp-3" class="level2">
<h2 class="anchored" data-anchor-id="comp-3">Comp 3</h2>
<ul>
<li>Not sure yet</li>
<li>try something similar to Comp 2</li>
<li>increase gain</li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(midiblender)</span>
<span id="cb6-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(dplyr)</span>
<span id="cb6-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(pyramidi)</span>
<span id="cb6-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(fluidsynth)</span></code></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1">all_tracks <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>()</span>
<span id="cb7-2"></span>
<span id="cb7-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># note parameters</span></span>
<span id="cb7-4">bars <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span> </span>
<span id="cb7-5">repeat_bars <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span></span>
<span id="cb7-6">possible_time_steps <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span></span>
<span id="cb7-7">note_interval <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">24</span></span>
<span id="cb7-8">note_duration <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">48</span></span>
<span id="cb7-9"></span>
<span id="cb7-10">track_params <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(</span>
<span id="cb7-11">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">track_1_kick =</span></span>
<span id="cb7-12">   <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">possible_notes =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)), </span>
<span id="cb7-13">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">key_vector =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>), </span>
<span id="cb7-14">                           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">each =</span> possible_time_steps), </span>
<span id="cb7-15">                       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times =</span> repeat_bars),</span>
<span id="cb7-16">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">possible_beats =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),</span>
<span id="cb7-17">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">program =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb7-18">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">channel =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,</span>
<span id="cb7-19">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note_interval =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">24</span>,</span>
<span id="cb7-20">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note_duration =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>,</span>
<span id="cb7-21">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">velocity =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">80</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">127</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> (possible_time_steps<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>bars<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>repeat_bars), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">replace =</span> T)</span>
<span id="cb7-22">     ),</span>
<span id="cb7-23"> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">track_2_snare =</span></span>
<span id="cb7-24">   <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">possible_notes =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)),  </span>
<span id="cb7-25">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">key_vector =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>), </span>
<span id="cb7-26">                           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">each =</span> possible_time_steps), </span>
<span id="cb7-27">                       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times =</span> repeat_bars),</span>
<span id="cb7-28">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">possible_beats =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),</span>
<span id="cb7-29">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">program =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,</span>
<span id="cb7-30">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">channel =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,</span>
<span id="cb7-31">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note_interval =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">24</span>,</span>
<span id="cb7-32">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note_duration =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">48</span>,</span>
<span id="cb7-33">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">velocity =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">80</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">127</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> (possible_time_steps<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>bars<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>repeat_bars), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">replace =</span> T)</span>
<span id="cb7-34">    ),</span>
<span id="cb7-35"> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">track_3_cymb =</span></span>
<span id="cb7-36">   <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">possible_notes =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">35</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">33</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">64</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)),  </span>
<span id="cb7-37">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">key_vector =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>), </span>
<span id="cb7-38">                           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">each =</span> possible_time_steps), </span>
<span id="cb7-39">                       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times =</span> repeat_bars),</span>
<span id="cb7-40">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">possible_beats =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>),<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),</span>
<span id="cb7-41">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">program =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,</span>
<span id="cb7-42">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">channel =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,</span>
<span id="cb7-43">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note_interval =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">24</span>,</span>
<span id="cb7-44">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note_duration =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">48</span>,</span>
<span id="cb7-45">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">velocity =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">127</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> (possible_time_steps<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>bars<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>repeat_bars), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">replace =</span> T)</span>
<span id="cb7-46">    ),</span>
<span id="cb7-47"> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">track_4_synth =</span></span>
<span id="cb7-48">   <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">possible_notes =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(((<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">60</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">72</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">24</span>),   <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#1     2     3  4     5     6     7  8 </span></span>
<span id="cb7-49">                             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)), </span>
<span id="cb7-50">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">key_vector =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>), </span>
<span id="cb7-51">                           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">each =</span> possible_time_steps), </span>
<span id="cb7-52">                       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times =</span> repeat_bars),</span>
<span id="cb7-53">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">possible_beats =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">13</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">13</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)),</span>
<span id="cb7-54">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">program =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,</span>
<span id="cb7-55">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">channel =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>,</span>
<span id="cb7-56">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note_interval =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">24</span>,</span>
<span id="cb7-57">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note_duration =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">24</span>), possible_time_steps<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>bars<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>repeat_bars, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">replace =</span> T),</span>
<span id="cb7-58">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">velocity =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">127</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times =</span> (possible_time_steps<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>bars<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>repeat_bars))</span>
<span id="cb7-59">    ),</span>
<span id="cb7-60"> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">track_5_synth =</span></span>
<span id="cb7-61">   <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">possible_notes =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(((<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">60</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">72</span>)),   <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#1     2     3  4     5     6     7  8 </span></span>
<span id="cb7-62">                             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)), </span>
<span id="cb7-63">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">key_vector =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>), </span>
<span id="cb7-64">                           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">each =</span> possible_time_steps), </span>
<span id="cb7-65">                       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times =</span> repeat_bars),</span>
<span id="cb7-66">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">possible_beats =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">13</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)),</span>
<span id="cb7-67">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">program =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>,</span>
<span id="cb7-68">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">channel =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,</span>
<span id="cb7-69">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note_interval =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">24</span>,</span>
<span id="cb7-70">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note_duration =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">24</span>), possible_time_steps<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>bars<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>repeat_bars, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">replace =</span> T),</span>
<span id="cb7-71">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">velocity =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">127</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times =</span> (possible_time_steps<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>bars<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>repeat_bars))</span>
<span id="cb7-72">    )</span>
<span id="cb7-73">)</span>
<span id="cb7-74">             </span>
<span id="cb7-75">                           </span>
<span id="cb7-76"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># loop for each track</span></span>
<span id="cb7-77"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span>(t <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>) {</span>
<span id="cb7-78">  </span>
<span id="cb7-79">  compose_notes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> tibble<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>(</span>
<span id="cb7-80">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note_id =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">integer</span>(),</span>
<span id="cb7-81">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">integer</span>(),</span>
<span id="cb7-82">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">beat_on =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">integer</span>(),</span>
<span id="cb7-83">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note_on =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">integer</span>(),</span>
<span id="cb7-84">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note_off =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">integer</span>(),</span>
<span id="cb7-85">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">velocity =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">integer</span>()</span>
<span id="cb7-86">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb7-87">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># use euclidean rhythm</span></span>
<span id="cb7-88">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rowwise</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb7-89">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_row</span>(</span>
<span id="cb7-90">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">beat_on =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">replicate</span>(</span>
<span id="cb7-91">        bars<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>repeat_bars,</span>
<span id="cb7-92">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bresenham_euclidean</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(track_params[[t]]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>possible_beats, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), </span>
<span id="cb7-93">                            possible_time_steps,</span>
<span id="cb7-94">                            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">start =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb7-95">      )),</span>
<span id="cb7-96">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(track_params[[t]]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>possible_notes,</span>
<span id="cb7-97">                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> possible_time_steps <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (bars<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>repeat_bars),</span>
<span id="cb7-98">                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">replace =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> track_params[[t]]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>key_vector,</span>
<span id="cb7-99">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">velocity =</span> track_params[[t]]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>velocity </span>
<span id="cb7-100">    ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb7-101">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ungroup</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb7-102">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># handle note times</span></span>
<span id="cb7-103">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb7-104">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note_id =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">n</span>(),</span>
<span id="cb7-105">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note_on =</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">n</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> track_params[[t]]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>note_interval,</span>
<span id="cb7-106">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note_off =</span> note_on <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> track_params[[t]]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>note_duration</span>
<span id="cb7-107">    ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb7-108">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(beat_on <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb7-109">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#pivot to long</span></span>
<span id="cb7-110">    tidyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_longer</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"note_on"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"note_off"</span>),</span>
<span id="cb7-111">                        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"type"</span>,</span>
<span id="cb7-112">                        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"time"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb7-113">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrange</span>(time) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb7-114">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">time =</span> time <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lag</span>(time, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">default =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>),</span>
<span id="cb7-115">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">channel =</span> track_params[[t]]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>channel)</span>
<span id="cb7-116">  <span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">######################</span></span>
<span id="cb7-117">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># End composition </span></span>
<span id="cb7-118">  </span>
<span id="cb7-119">  <span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">#######################</span></span>
<span id="cb7-120">  <span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## add composition to a new midi df</span></span>
<span id="cb7-121">  new_midi_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">create_empty_midi_df</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># initialize</span></span>
<span id="cb7-122">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_meta_track_name</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"My track"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb7-123">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_meta_tempo</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">tempo =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">600000</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb7-124">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_meta_time_sig</span>(</span>
<span id="cb7-125">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">numerator =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>,</span>
<span id="cb7-126">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">denominator =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>,</span>
<span id="cb7-127">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">clocks_per_click =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">36</span>,</span>
<span id="cb7-128">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">notated_32nd_notes_per_beat =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span></span>
<span id="cb7-129">    ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb7-130">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_program_change</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">program =</span> track_params[[t]]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>program,</span>
<span id="cb7-131">                       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">channel =</span> track_params[[t]]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>channel) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb7-132">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_control_change</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">control =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">value =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb7-133">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Composition added here</span></span>
<span id="cb7-134">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_row</span>(</span>
<span id="cb7-135">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">i_track =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dim</span>(compose_notes)[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]),</span>
<span id="cb7-136">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">meta =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dim</span>(compose_notes)[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]),</span>
<span id="cb7-137">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note =</span> compose_notes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>note,</span>
<span id="cb7-138">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> compose_notes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>type,</span>
<span id="cb7-139">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">time =</span> compose_notes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>time,</span>
<span id="cb7-140">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">channel =</span> compose_notes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>channel,</span>
<span id="cb7-141">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">velocity =</span> compose_notes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>velocity</span>
<span id="cb7-142">      <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#velocity = 64</span></span>
<span id="cb7-143">    ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb7-144">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_meta_end_of_track</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb7-145">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">velocity =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">case_when</span>(type <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"note_on"</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> velocity,</span>
<span id="cb7-146">                                type <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"note_off"</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>))</span>
<span id="cb7-147">  </span>
<span id="cb7-148">  all_tracks <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbind</span>(all_tracks,new_midi_df)</span>
<span id="cb7-149">  </span>
<span id="cb7-150">}</span>
<span id="cb7-151"></span>
<span id="cb7-152"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#write midi</span></span>
<span id="cb7-153"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#Initialize new pyramidi object</span></span>
<span id="cb7-154">new_pyramidi_object <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> pyramidi<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span>MidiFramer<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">new</span>()</span>
<span id="cb7-155"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># update ticks per beat</span></span>
<span id="cb7-156">new_pyramidi_object<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>ticks_per_beat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">96</span>L</span>
<span id="cb7-157"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># update object with new midi df</span></span>
<span id="cb7-158">new_pyramidi_object<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>mf<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>midi_frame_unnested<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">update_unnested_mf</span>(all_tracks)</span>
<span id="cb7-159"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># write to midi file</span></span>
<span id="cb7-160">new_pyramidi_object<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>mf<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">write_file</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"F_samples/TE-EP-133-FsynthA.mid"</span>)</span>
<span id="cb7-161"></span>
<span id="cb7-162"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># play</span></span>
<span id="cb7-163">fluidsynth<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">midi_play</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">midi =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"F_samples/TE-EP-133-FsynthA.mid"</span>,</span>
<span id="cb7-164">                      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">soundfont =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"~/Library/Audio/Sounds/Banks/TE-EP-133-A.sf2"</span>,</span>
<span id="cb7-165">                      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">settings =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'synth.gain'</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>))</span></code></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#bounce</span></span>
<span id="cb8-2">fluidsynth<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">midi_convert</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">midi =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"F_samples/TE-EP-133-FsynthA.mid"</span>,</span>
<span id="cb8-3">                         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">soundfont =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"~/Library/Audio/Sounds/Banks/TE-EP-133-A.sf2"</span>,</span>
<span id="cb8-4">                         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">output =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"F_samples/TE-EP-133-FsynthA.mp3"</span>,</span>
<span id="cb8-5">                         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">settings =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'synth.gain'</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>))</span></code></pre></div>
</details>
</div>
<p>Fun was had.</p>
</section>
<section id="comp-4" class="level2">
<h2 class="anchored" data-anchor-id="comp-4">Comp 4</h2>
<ul>
<li>Going back to super basic</li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(midiblender)</span>
<span id="cb9-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(dplyr)</span>
<span id="cb9-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(pyramidi)</span>
<span id="cb9-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(fluidsynth)</span></code></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1">all_tracks <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>()</span>
<span id="cb10-2"></span>
<span id="cb10-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># note parameters</span></span>
<span id="cb10-4">bars <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span> </span>
<span id="cb10-5">repeat_bars <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span></span>
<span id="cb10-6">possible_time_steps <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span></span>
<span id="cb10-7">note_interval <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">24</span></span>
<span id="cb10-8">note_duration <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">48</span></span>
<span id="cb10-9"></span>
<span id="cb10-10">track_params <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(</span>
<span id="cb10-11">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">track_1_kick =</span></span>
<span id="cb10-12">   <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">possible_notes =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)), </span>
<span id="cb10-13">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">key_vector =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>), </span>
<span id="cb10-14">                           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">each =</span> possible_time_steps), </span>
<span id="cb10-15">                       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times =</span> repeat_bars),</span>
<span id="cb10-16">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">possible_beats =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),</span>
<span id="cb10-17">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">program =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb10-18">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">channel =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,</span>
<span id="cb10-19">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note_interval =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">24</span>,</span>
<span id="cb10-20">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note_duration =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>,</span>
<span id="cb10-21">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">velocity =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">80</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">127</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> (possible_time_steps<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>bars<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>repeat_bars), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">replace =</span> T)</span>
<span id="cb10-22">     ),</span>
<span id="cb10-23"> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">track_2_snare =</span></span>
<span id="cb10-24">   <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">possible_notes =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)),  </span>
<span id="cb10-25">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">key_vector =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>), </span>
<span id="cb10-26">                           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">each =</span> possible_time_steps), </span>
<span id="cb10-27">                       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times =</span> repeat_bars),</span>
<span id="cb10-28">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">possible_beats =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),</span>
<span id="cb10-29">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">program =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,</span>
<span id="cb10-30">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">channel =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,</span>
<span id="cb10-31">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note_interval =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">24</span>,</span>
<span id="cb10-32">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note_duration =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">48</span>,</span>
<span id="cb10-33">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">velocity =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">80</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">127</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> (possible_time_steps<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>bars<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>repeat_bars), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">replace =</span> T)</span>
<span id="cb10-34">    ),</span>
<span id="cb10-35"> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">track_3_cymb =</span></span>
<span id="cb10-36">   <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">possible_notes =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">35</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">33</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">64</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)),  </span>
<span id="cb10-37">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">key_vector =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>), </span>
<span id="cb10-38">                           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">each =</span> possible_time_steps), </span>
<span id="cb10-39">                       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times =</span> repeat_bars),</span>
<span id="cb10-40">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">possible_beats =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>),<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),</span>
<span id="cb10-41">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">program =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,</span>
<span id="cb10-42">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">channel =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,</span>
<span id="cb10-43">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note_interval =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">24</span>,</span>
<span id="cb10-44">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note_duration =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">48</span>,</span>
<span id="cb10-45">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">velocity =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">127</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> (possible_time_steps<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>bars<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>repeat_bars), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">replace =</span> T)</span>
<span id="cb10-46">    ),</span>
<span id="cb10-47"> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">track_4_synth =</span></span>
<span id="cb10-48">   <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">possible_notes =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(((<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">60</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">72</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">24</span>),   <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#1     2     3  4     5     6     7  8 </span></span>
<span id="cb10-49">                             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)), </span>
<span id="cb10-50">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">key_vector =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>), </span>
<span id="cb10-51">                           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">each =</span> possible_time_steps), </span>
<span id="cb10-52">                       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times =</span> repeat_bars),</span>
<span id="cb10-53">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">possible_beats =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)),</span>
<span id="cb10-54">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">program =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,</span>
<span id="cb10-55">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">channel =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>,</span>
<span id="cb10-56">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note_interval =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">24</span>,</span>
<span id="cb10-57">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note_duration =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">24</span>), possible_time_steps<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>bars<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>repeat_bars, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">replace =</span> T),</span>
<span id="cb10-58">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">velocity =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">127</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times =</span> (possible_time_steps<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>bars<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>repeat_bars))</span>
<span id="cb10-59">    ),</span>
<span id="cb10-60"> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">track_5_synth =</span></span>
<span id="cb10-61">   <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">possible_notes =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(((<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">60</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">72</span>)),   <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#1     2     3  4     5     6     7  8 </span></span>
<span id="cb10-62">                             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)), </span>
<span id="cb10-63">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">key_vector =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>), </span>
<span id="cb10-64">                           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">each =</span> possible_time_steps), </span>
<span id="cb10-65">                       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times =</span> repeat_bars),</span>
<span id="cb10-66">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">possible_beats =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)),</span>
<span id="cb10-67">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">program =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>,</span>
<span id="cb10-68">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">channel =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,</span>
<span id="cb10-69">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note_interval =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">24</span>,</span>
<span id="cb10-70">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note_duration =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">24</span>), possible_time_steps<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>bars<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>repeat_bars, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">replace =</span> T),</span>
<span id="cb10-71">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">velocity =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">127</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times =</span> (possible_time_steps<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>bars<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>repeat_bars))</span>
<span id="cb10-72">    )</span>
<span id="cb10-73">)</span>
<span id="cb10-74">             </span>
<span id="cb10-75">                           </span>
<span id="cb10-76"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># loop for each track</span></span>
<span id="cb10-77"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span>(t <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>) {</span>
<span id="cb10-78">  </span>
<span id="cb10-79">  compose_notes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> tibble<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>(</span>
<span id="cb10-80">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note_id =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">integer</span>(),</span>
<span id="cb10-81">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">integer</span>(),</span>
<span id="cb10-82">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">beat_on =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">integer</span>(),</span>
<span id="cb10-83">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note_on =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">integer</span>(),</span>
<span id="cb10-84">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note_off =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">integer</span>(),</span>
<span id="cb10-85">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">velocity =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">integer</span>()</span>
<span id="cb10-86">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb10-87">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># use euclidean rhythm</span></span>
<span id="cb10-88">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rowwise</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb10-89">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_row</span>(</span>
<span id="cb10-90">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">beat_on =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">replicate</span>(</span>
<span id="cb10-91">        bars<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>repeat_bars,</span>
<span id="cb10-92">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bresenham_euclidean</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(track_params[[t]]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>possible_beats, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), </span>
<span id="cb10-93">                            possible_time_steps,</span>
<span id="cb10-94">                            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">start =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb10-95">      )),</span>
<span id="cb10-96">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(track_params[[t]]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>possible_notes,</span>
<span id="cb10-97">                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> possible_time_steps <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (bars<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>repeat_bars),</span>
<span id="cb10-98">                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">replace =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> track_params[[t]]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>key_vector,</span>
<span id="cb10-99">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">velocity =</span> track_params[[t]]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>velocity </span>
<span id="cb10-100">    ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb10-101">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ungroup</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb10-102">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># handle note times</span></span>
<span id="cb10-103">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb10-104">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note_id =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">n</span>(),</span>
<span id="cb10-105">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note_on =</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">n</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> track_params[[t]]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>note_interval,</span>
<span id="cb10-106">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note_off =</span> note_on <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> track_params[[t]]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>note_duration</span>
<span id="cb10-107">    ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb10-108">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(beat_on <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb10-109">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#pivot to long</span></span>
<span id="cb10-110">    tidyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_longer</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"note_on"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"note_off"</span>),</span>
<span id="cb10-111">                        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"type"</span>,</span>
<span id="cb10-112">                        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"time"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb10-113">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrange</span>(time) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb10-114">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">time =</span> time <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lag</span>(time, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">default =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>),</span>
<span id="cb10-115">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">channel =</span> track_params[[t]]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>channel)</span>
<span id="cb10-116">  <span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">######################</span></span>
<span id="cb10-117">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># End composition </span></span>
<span id="cb10-118">  </span>
<span id="cb10-119">  <span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">#######################</span></span>
<span id="cb10-120">  <span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## add composition to a new midi df</span></span>
<span id="cb10-121">  new_midi_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">create_empty_midi_df</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># initialize</span></span>
<span id="cb10-122">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_meta_track_name</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"My track"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb10-123">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_meta_tempo</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">tempo =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">600000</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb10-124">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_meta_time_sig</span>(</span>
<span id="cb10-125">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">numerator =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>,</span>
<span id="cb10-126">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">denominator =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>,</span>
<span id="cb10-127">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">clocks_per_click =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">36</span>,</span>
<span id="cb10-128">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">notated_32nd_notes_per_beat =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span></span>
<span id="cb10-129">    ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb10-130">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_program_change</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">program =</span> track_params[[t]]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>program,</span>
<span id="cb10-131">                       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">channel =</span> track_params[[t]]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>channel) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb10-132">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_control_change</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">control =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">value =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb10-133">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Composition added here</span></span>
<span id="cb10-134">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_row</span>(</span>
<span id="cb10-135">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">i_track =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dim</span>(compose_notes)[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]),</span>
<span id="cb10-136">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">meta =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dim</span>(compose_notes)[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]),</span>
<span id="cb10-137">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note =</span> compose_notes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>note,</span>
<span id="cb10-138">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> compose_notes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>type,</span>
<span id="cb10-139">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">time =</span> compose_notes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>time,</span>
<span id="cb10-140">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">channel =</span> compose_notes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>channel,</span>
<span id="cb10-141">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">velocity =</span> compose_notes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>velocity</span>
<span id="cb10-142">      <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#velocity = 64</span></span>
<span id="cb10-143">    ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb10-144">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_meta_end_of_track</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb10-145">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">velocity =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">case_when</span>(type <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"note_on"</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> velocity,</span>
<span id="cb10-146">                                type <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"note_off"</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>))</span>
<span id="cb10-147">  </span>
<span id="cb10-148">  all_tracks <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbind</span>(all_tracks,new_midi_df)</span>
<span id="cb10-149">  </span>
<span id="cb10-150">}</span>
<span id="cb10-151"></span>
<span id="cb10-152"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#write midi</span></span>
<span id="cb10-153"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#Initialize new pyramidi object</span></span>
<span id="cb10-154">new_pyramidi_object <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> pyramidi<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span>MidiFramer<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">new</span>()</span>
<span id="cb10-155"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># update ticks per beat</span></span>
<span id="cb10-156">new_pyramidi_object<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>ticks_per_beat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">96</span>L</span>
<span id="cb10-157"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># update object with new midi df</span></span>
<span id="cb10-158">new_pyramidi_object<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>mf<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>midi_frame_unnested<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">update_unnested_mf</span>(all_tracks)</span>
<span id="cb10-159"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># write to midi file</span></span>
<span id="cb10-160">new_pyramidi_object<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>mf<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">write_file</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"G_samples/TE-EP-133-Gsynth.mid"</span>)</span>
<span id="cb10-161"></span>
<span id="cb10-162"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># play</span></span>
<span id="cb10-163">fluidsynth<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">midi_play</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">midi =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"G_samples/TE-EP-133-Gsynth.mid"</span>,</span>
<span id="cb10-164">                      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">soundfont =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"~/Library/Audio/Sounds/Banks/TE-EP-133-A.sf2"</span>,</span>
<span id="cb10-165">                      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">settings =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'synth.gain'</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>))</span></code></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#bounce</span></span>
<span id="cb11-2">fluidsynth<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">midi_convert</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">midi =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"G_samples/TE-EP-133-Gsynth.mid"</span>,</span>
<span id="cb11-3">                         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">soundfont =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"~/Library/Audio/Sounds/Banks/TE-EP-133-A.sf2"</span>,</span>
<span id="cb11-4">                         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">output =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"G_samples/TE-EP-133-Gsynth.mp3"</span>,</span>
<span id="cb11-5">                         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">settings =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'synth.gain'</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>))</span></code></pre></div>
</details>
</div>
<p>Fun was had.</p>


</section>

 ]]></description>
  <category>midiblender</category>
  <category>soundfont</category>
  <category>fluidsynth</category>
  <guid>https://homophony.quest/blog/50_2_16_24_comps/</guid>
  <pubDate>Sat, 17 Feb 2024 05:00:00 GMT</pubDate>
  <media:content url="https://homophony.quest/blog/50_2_16_24_comps/cover.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>Soundfonts and {rsoundfont}!</title>
  <dc:creator>Matt Crump</dc:creator>
  <link>https://homophony.quest/blog/49_2_15_24_r_soundfonts/</link>
  <description><![CDATA[ 




<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> diffusers <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> DiffusionPipeline</span>
<span id="cb1-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> transformers <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> set_seed</span>
<span id="cb1-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> PIL <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> Image</span>
<span id="cb1-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> torch</span>
<span id="cb1-5"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> random</span>
<span id="cb1-6"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> ssl</span>
<span id="cb1-7"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> os</span>
<span id="cb1-8">ssl._create_default_https_context <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ssl._create_unverified_context</span>
<span id="cb1-9"></span>
<span id="cb1-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#locate library</span></span>
<span id="cb1-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#model_id = "./stable-diffusion-v1-5"</span></span>
<span id="cb1-12">model_id <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dreamshaper-xl-turbo"</span></span>
<span id="cb1-13"></span>
<span id="cb1-14">pipeline <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> DiffusionPipeline.from_pretrained(</span>
<span id="cb1-15">    pretrained_model_name_or_path <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../../../../bigFiles/huggingface/dreamshaper-xl-turbo/"</span></span>
<span id="cb1-16">)</span>
<span id="cb1-17"></span>
<span id="cb1-18">pipeline <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pipeline.to(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mps"</span>)</span>
<span id="cb1-19"></span>
<span id="cb1-20"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Recommended if your computer has &lt; 64 GB of RAM</span></span>
<span id="cb1-21">pipeline.enable_attention_slicing(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"max"</span>)</span>
<span id="cb1-22"></span>
<span id="cb1-23">prompt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"a synthesizer made out of water. 3d. white background. super cool."</span></span>
<span id="cb1-24"></span>
<span id="cb1-25"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> s <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>):</span>
<span id="cb1-26">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> n <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>]:</span>
<span id="cb1-27">    seed <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> s<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span></span>
<span id="cb1-28">    num_steps <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> n<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb1-29">    set_seed(seed)</span>
<span id="cb1-30">    </span>
<span id="cb1-31">    image <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pipeline(prompt,height <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1024</span>,width <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1024</span>,num_images_per_prompt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,num_inference_steps<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>num_steps)</span>
<span id="cb1-32">    </span>
<span id="cb1-33">    image_name <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"images/synth_</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">_</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">.jpeg"</span></span>
<span id="cb1-34">    </span>
<span id="cb1-35">    image_save <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> image.images[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].save(image_name.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">format</span>(seed,num_steps))</span></code></pre></div>
</details>
</div>
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><img src="https://homophony.quest/blog/49_2_15_24_r_soundfonts/cover.jpg" class="img-fluid quarto-figure quarto-figure-left figure-img" style="width:50.0%"></p>
</figure>
</div>

<div class="no-row-height column-margin column-container"><div class="">
<p>Sound Blaster AWE 64</p>
</div></div><p>Soundfonts…wow. In some sense this format is totally new to me. I had to download some to get fluidsynth to play sounds, and that’s about all I knew about them.</p>
<p>After perusing <a href="https://en.wikipedia.org/wiki/SoundFont">soundfonts on wikipedia</a> I learned that the awesome sounds of my childhood, from the Sound Blaster AWE32 soundcard that blew my freaking mind as a kid, was soundfonts.</p>
<p>Last night I downloaded a whole bunch of soundfont collections, because why not. And, then I realized that I didn’t know anything about the <code>.sf2</code> format, soundfont file structure, how to quickly audition different soundfonts, etc.</p>
<p>So, I am on a soundfont journey.</p>
<p>I was very excited to learn that <a href="https://coolbutuseless.github.io">coolbutuseless</a> made a package to inspect <code>.sf2</code> files, called <a href="https://github.com/coolbutuseless/rsoundfont">rsoundfont</a>. I’m testing it out a bit here.</p>
<section id="soundfont-specs" class="level2">
<h2 class="anchored" data-anchor-id="soundfont-specs">soundfont specs</h2>
<p><a href="https://www.synthfont.com/sfspec24.pdf" class="uri">https://www.synthfont.com/sfspec24.pdf</a></p>
</section>
<section id="rsoundfont-tests" class="level2">
<h2 class="anchored" data-anchor-id="rsoundfont-tests">rsoundfont tests</h2>
<p>{rsoundfont} works great. The <code>.sf2</code> file loads as a list. All of the .wav info is in R, and the <code>create_sample()</code> function makes it possible to quickly listen to a soundfont in R.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(rsoundfont)</span>
<span id="cb2-2"></span>
<span id="cb2-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># storing all my .sf2 files here</span></span>
<span id="cb2-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># get a list of them</span></span>
<span id="cb2-5">sound_font_list <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list.files</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"~/Library/Audio/Sounds/Banks"</span>)</span>
<span id="cb2-6"></span>
<span id="cb2-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># pick one to load</span></span>
<span id="cb2-8">sf2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_sf2</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"~/Library/Audio/Sounds/Banks/"</span>,sound_font_list[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">37</span>]))</span>
<span id="cb2-9"></span>
<span id="cb2-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># look at stuff</span></span>
<span id="cb2-11"></span>
<span id="cb2-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#View(sf2$pdta$phdr)</span></span>
<span id="cb2-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#sf2$pdta$shdr$name</span></span>
<span id="cb2-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#sf2$pdta$shdr</span></span>
<span id="cb2-15"></span>
<span id="cb2-16"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># quickly loop through different soundfonts and play them</span></span>
<span id="cb2-17"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span>(i <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(sf2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>pdta<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>shdr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>name)){</span>
<span id="cb2-18">  samp <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">create_sample</span>(sf2, sf2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>pdta<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>shdr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>name[i], <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>)</span>
<span id="cb2-19">  audio<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">play</span>(samp)</span>
<span id="cb2-20">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Sys.sleep</span>(.<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)</span>
<span id="cb2-21">}</span></code></pre></div>
</details>
</div>
</section>
<section id="polyphone" class="level2">
<h2 class="anchored" data-anchor-id="polyphone">polyphone</h2>
<p>Next I discovered <a href="https://github.com/davy7125/polyphone">polyphone</a>, which is an excellent open-source soundfont editor.</p>
<p>Polyphone makes it incredibly easy to organize samples and turn them into .sf2 files.</p>
</section>
<section id="te-ep-133-k.o.-ii" class="level2">
<h2 class="anchored" data-anchor-id="te-ep-133-k.o.-ii">TE EP-133 K.O. II</h2>
<p>I recently picked up a TE EP-133 K.O. II and I love the sample on there. Using polyphone it didn’t take that much work to get the samples into <code>.sf2</code>. Which means I should be able to make some fun beat. There are a bunch of different options for organizing samples as instruments and patches, and I’m looking forward to exploring this a little bit more.</p>
</section>
<section id="killr-beatz" class="level2">
<h2 class="anchored" data-anchor-id="killr-beatz">KillR BEATZ</h2>
<p>If it is true that I possess some super inspiring samples for drums, then I should be able to make some fun beats. Let’s see:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(midiblender)</span>
<span id="cb3-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(dplyr)</span>
<span id="cb3-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(pyramidi)</span>
<span id="cb3-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(fluidsynth)</span>
<span id="cb3-5"></span>
<span id="cb3-6">all_tracks <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>()</span>
<span id="cb3-7"></span>
<span id="cb3-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># note parameters</span></span>
<span id="cb3-9">  bars <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span> </span>
<span id="cb3-10">  repeat_bars <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span></span>
<span id="cb3-11">  possible_time_steps <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span></span>
<span id="cb3-12">  note_interval <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">24</span></span>
<span id="cb3-13">  note_duration <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">48</span></span>
<span id="cb3-14">  </span>
<span id="cb3-15">  track_params <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">track_1_kick =</span></span>
<span id="cb3-16">                         <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">possible_notes =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)), </span>
<span id="cb3-17">                              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">key_vector =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>), </span>
<span id="cb3-18">                                                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">each =</span> possible_time_steps), </span>
<span id="cb3-19">                                             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times =</span> repeat_bars),</span>
<span id="cb3-20">                              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">possible_beats =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)),</span>
<span id="cb3-21">                              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">program =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb3-22">                              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">channel =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb3-23">                           ),</span>
<span id="cb3-24">                       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">track_2_snare =</span></span>
<span id="cb3-25">                         <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">possible_notes =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)),  </span>
<span id="cb3-26">                            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">key_vector =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>), </span>
<span id="cb3-27">                                                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">each =</span> possible_time_steps), </span>
<span id="cb3-28">                                             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times =</span> repeat_bars),</span>
<span id="cb3-29">                            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">possible_beats =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)),</span>
<span id="cb3-30">                            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">program =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,</span>
<span id="cb3-31">                            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">channel =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span></span>
<span id="cb3-32">                          ),</span>
<span id="cb3-33">                       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">track_3_cymb =</span></span>
<span id="cb3-34">                         <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">possible_notes =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)),  </span>
<span id="cb3-35">                            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">key_vector =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>), </span>
<span id="cb3-36">                                                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">each =</span> possible_time_steps), </span>
<span id="cb3-37">                                             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times =</span> repeat_bars),</span>
<span id="cb3-38">                            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">possible_beats =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)),</span>
<span id="cb3-39">                            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">program =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,</span>
<span id="cb3-40">                            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">channel =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span></span>
<span id="cb3-41">                          )</span>
<span id="cb3-42">  )</span>
<span id="cb3-43">                       </span>
<span id="cb3-44">                           </span>
<span id="cb3-45"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># loop for each track</span></span>
<span id="cb3-46"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span>(t <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>) {</span>
<span id="cb3-47">  </span>
<span id="cb3-48">  compose_notes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> tibble<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>(</span>
<span id="cb3-49">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note_id =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">integer</span>(),</span>
<span id="cb3-50">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">integer</span>(),</span>
<span id="cb3-51">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">beat_on =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">integer</span>(),</span>
<span id="cb3-52">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note_on =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">integer</span>(),</span>
<span id="cb3-53">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note_off =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">integer</span>()</span>
<span id="cb3-54">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-55">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># use euclidean rhythm</span></span>
<span id="cb3-56">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rowwise</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-57">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_row</span>(</span>
<span id="cb3-58">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">beat_on =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">replicate</span>(</span>
<span id="cb3-59">        bars<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>repeat_bars,</span>
<span id="cb3-60">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bresenham_euclidean</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(track_params[[t]]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>possible_beats, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), </span>
<span id="cb3-61">                            possible_time_steps,</span>
<span id="cb3-62">                            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">start =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb3-63">      )),</span>
<span id="cb3-64">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(track_params[[t]]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>possible_notes,</span>
<span id="cb3-65">                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> possible_time_steps <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (bars<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>repeat_bars),</span>
<span id="cb3-66">                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">replace =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> track_params[[t]]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>key_vector</span>
<span id="cb3-67">    ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-68">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ungroup</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-69">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># handle note times</span></span>
<span id="cb3-70">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb3-71">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note_id =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">n</span>(),</span>
<span id="cb3-72">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note_on =</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">n</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> note_interval,</span>
<span id="cb3-73">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note_off =</span> note_on <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> note_duration</span>
<span id="cb3-74">    ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-75">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(beat_on <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-76">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#pivot to long</span></span>
<span id="cb3-77">    tidyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_longer</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"note_on"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"note_off"</span>),</span>
<span id="cb3-78">                        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"type"</span>,</span>
<span id="cb3-79">                        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"time"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-80">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrange</span>(time) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-81">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">time =</span> time <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lag</span>(time, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">default =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>),</span>
<span id="cb3-82">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">channel =</span> track_params[[t]]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>channel)</span>
<span id="cb3-83">  <span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">######################</span></span>
<span id="cb3-84">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># End composition </span></span>
<span id="cb3-85">  </span>
<span id="cb3-86">  <span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">#######################</span></span>
<span id="cb3-87">  <span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## add composition to a new midi df</span></span>
<span id="cb3-88">  new_midi_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">create_empty_midi_df</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># initialize</span></span>
<span id="cb3-89">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_meta_track_name</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"My track"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-90">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_meta_tempo</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">tempo =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">500000</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-91">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_meta_time_sig</span>(</span>
<span id="cb3-92">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">numerator =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>,</span>
<span id="cb3-93">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">denominator =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>,</span>
<span id="cb3-94">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">clocks_per_click =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">36</span>,</span>
<span id="cb3-95">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">notated_32nd_notes_per_beat =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span></span>
<span id="cb3-96">    ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-97">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_program_change</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">program =</span> track_params[[t]]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>program,</span>
<span id="cb3-98">                       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">channel =</span> track_params[[t]]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>channel) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-99">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_control_change</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">control =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">value =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-100">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Composition added here</span></span>
<span id="cb3-101">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_row</span>(</span>
<span id="cb3-102">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">i_track =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dim</span>(compose_notes)[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]),</span>
<span id="cb3-103">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">meta =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dim</span>(compose_notes)[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]),</span>
<span id="cb3-104">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note =</span> compose_notes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>note,</span>
<span id="cb3-105">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> compose_notes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>type,</span>
<span id="cb3-106">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">time =</span> compose_notes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>time,</span>
<span id="cb3-107">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">channel =</span> compose_notes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>channel,</span>
<span id="cb3-108">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">velocity =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>L<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">112</span>L,<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dim</span>(compose_notes)[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>],<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">replace=</span>T)</span>
<span id="cb3-109">      <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#velocity = 64</span></span>
<span id="cb3-110">    ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-111">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_meta_end_of_track</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-112">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">i_track =</span> t) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-113">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">velocity =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">case_when</span>(type <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"note_on"</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> velocity,</span>
<span id="cb3-114">                                type <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"note_off"</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>))<span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># set current track number</span></span>
<span id="cb3-115">  </span>
<span id="cb3-116">  all_tracks <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbind</span>(all_tracks,new_midi_df)</span>
<span id="cb3-117">  </span>
<span id="cb3-118">}</span>
<span id="cb3-119"></span>
<span id="cb3-120"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#write midi</span></span>
<span id="cb3-121"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#Initialize new pyramidi object</span></span>
<span id="cb3-122">new_pyramidi_object <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> pyramidi<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span>MidiFramer<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">new</span>()</span>
<span id="cb3-123"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># update ticks per beat</span></span>
<span id="cb3-124">new_pyramidi_object<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>ticks_per_beat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">96</span>L</span>
<span id="cb3-125"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># update object with new midi df</span></span>
<span id="cb3-126">new_pyramidi_object<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>mf<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>midi_frame_unnested<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">update_unnested_mf</span>(all_tracks)</span>
<span id="cb3-127"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># write to midi file</span></span>
<span id="cb3-128">new_pyramidi_object<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>mf<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">write_file</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"TE-EP-133-B.mid"</span>)</span>
<span id="cb3-129"></span>
<span id="cb3-130"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># play</span></span>
<span id="cb3-131">fluidsynth<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">midi_play</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">midi =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"TE-EP-133-B.mid"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">soundfont =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"~/Library/Audio/Sounds/Banks/TE-EP-133-A.sf2"</span>)</span>
<span id="cb3-132"></span>
<span id="cb3-133"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#bounce</span></span>
<span id="cb3-134">fluidsynth<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">midi_convert</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">midi =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"TE-EP-133-B.mid"</span>,</span>
<span id="cb3-135">                         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">soundfont =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"~/Library/Audio/Sounds/Banks/TE-EP-133-A.sf2"</span>,</span>
<span id="cb3-136">                         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">output =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"TE-EP-133-B.mp3"</span>)</span></code></pre></div>
</details>
</div>
<p><audio controls=""> <source src="TE-EP-133-B_01.mp3" type="audio/wav"> </audio></p>
<p>Look out aphex twin.</p>
<hr>
<p>Here’s a blend of those beats with mario for some more midi mangling fun.</p>
<p><audio controls=""> <source src="mario_TE.mp3" type="audio/wav"> </audio></p>


</section>

 ]]></description>
  <category>midiblender</category>
  <category>soundfont</category>
  <category>fluidsynth</category>
  <guid>https://homophony.quest/blog/49_2_15_24_r_soundfonts/</guid>
  <pubDate>Fri, 16 Feb 2024 05:00:00 GMT</pubDate>
  <media:content url="https://homophony.quest/blog/49_2_15_24_r_soundfonts/cover.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>Testing out {fluidsynth} for R!</title>
  <dc:creator>Matt Crump</dc:creator>
  <link>https://homophony.quest/blog/48_2_15_24_r_fluid_synth/</link>
  <description><![CDATA[ 




<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> diffusers <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> DiffusionPipeline</span>
<span id="cb1-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> transformers <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> set_seed</span>
<span id="cb1-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> PIL <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> Image</span>
<span id="cb1-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> torch</span>
<span id="cb1-5"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> random</span>
<span id="cb1-6"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> ssl</span>
<span id="cb1-7"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> os</span>
<span id="cb1-8">ssl._create_default_https_context <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ssl._create_unverified_context</span>
<span id="cb1-9"></span>
<span id="cb1-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#locate library</span></span>
<span id="cb1-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#model_id = "./stable-diffusion-v1-5"</span></span>
<span id="cb1-12">model_id <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dreamshaper-xl-turbo"</span></span>
<span id="cb1-13"></span>
<span id="cb1-14">pipeline <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> DiffusionPipeline.from_pretrained(</span>
<span id="cb1-15">    pretrained_model_name_or_path <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../../../../bigFiles/huggingface/dreamshaper-xl-turbo/"</span></span>
<span id="cb1-16">)</span>
<span id="cb1-17"></span>
<span id="cb1-18">pipeline <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pipeline.to(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mps"</span>)</span>
<span id="cb1-19"></span>
<span id="cb1-20"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Recommended if your computer has &lt; 64 GB of RAM</span></span>
<span id="cb1-21">pipeline.enable_attention_slicing(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"max"</span>)</span>
<span id="cb1-22"></span>
<span id="cb1-23">prompt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"a synthesizer made out of water. 3d. white background. super cool."</span></span>
<span id="cb1-24"></span>
<span id="cb1-25"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> s <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>):</span>
<span id="cb1-26">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> n <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>]:</span>
<span id="cb1-27">    seed <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> s<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span></span>
<span id="cb1-28">    num_steps <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> n<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb1-29">    set_seed(seed)</span>
<span id="cb1-30">    </span>
<span id="cb1-31">    image <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pipeline(prompt,height <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1024</span>,width <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1024</span>,num_images_per_prompt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,num_inference_steps<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>num_steps)</span>
<span id="cb1-32">    </span>
<span id="cb1-33">    image_name <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"images/synth_</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">_</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">.jpeg"</span></span>
<span id="cb1-34">    </span>
<span id="cb1-35">    image_save <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> image.images[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].save(image_name.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">format</span>(seed,num_steps))</span></code></pre></div>
</details>
</div>
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><img src="https://homophony.quest/blog/48_2_15_24_r_fluid_synth/cover.jpg" class="img-fluid quarto-figure quarto-figure-left figure-img" style="width:50.0%"></p>
</figure>
</div>

<div class="no-row-height column-margin column-container"><div class="">
<p>a synthesizer made out of water. 3d. white background. super cool. - Dreamshaper</p>
</div></div><p>Thanks to <a href="https://github.com/jeroen">Jeroen Ooms</a> and <a href="https://ropensci.org">rOpenSci</a>, there is a new {fluidsynth} package with bindings for R!</p>
<p>Here’s the github repo: <a href="https://github.com/ropensci/fluidsynth/" class="uri">https://github.com/ropensci/fluidsynth/</a></p>
<p>The package is only four days old and could change, but it is working for me!</p>
<section id="playback-midi-locally" class="level2">
<h2 class="anchored" data-anchor-id="playback-midi-locally">playback midi locally</h2>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(fluidsynth)</span>
<span id="cb2-2"></span>
<span id="cb2-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># this works for local playback!</span></span>
<span id="cb2-4"></span>
<span id="cb2-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">midi_play</span>(</span>
<span id="cb2-6">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">midi =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"the-moon.mid"</span>,</span>
<span id="cb2-7">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">soundfont =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"~/Library/Audio/Sounds/Banks/FluidR3_GM.sf2"</span>,</span>
<span id="cb2-8">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">audio.driver =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>,</span>
<span id="cb2-9">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">settings =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(),</span>
<span id="cb2-10">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">progress =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">interactive</span>()</span>
<span id="cb2-11">)</span></code></pre></div>
</details>
</div>
</section>
<section id="write-midi-to-wav" class="level2">
<h2 class="anchored" data-anchor-id="write-midi-to-wav">write midi to wav</h2>
<p>I’m on a mac m2. The midi_convert function produces a wav file that will not play. However, the {av} package does successfully convert the wav file to a listenable mp3. Glad it works out in the end.</p>
<p>I’m not sure why the wav file isn’t rendering as playable. I wonder if it isn’t finding my installation of libsndfile, and the wav file is being rendered as raw?</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">midi_convert</span>(</span>
<span id="cb3-2">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">midi =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"the-moon.mid"</span>,</span>
<span id="cb3-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">soundfont =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"~/Library/Audio/Sounds/Banks/FluidR3_GM.sf2"</span>,</span>
<span id="cb3-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">output =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"output.wav"</span>,</span>
<span id="cb3-5">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">settings =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(</span>
<span id="cb3-6">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">audio.driver =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"coreaudio"</span>,</span>
<span id="cb3-7">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">audio.file.format =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"double"</span>,</span>
<span id="cb3-8">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">audio.file.type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"wav"</span>),</span>
<span id="cb3-9">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">progress =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">interactive</span>()</span>
<span id="cb3-10">)</span>
<span id="cb3-11"></span>
<span id="cb3-12"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">midi_convert</span>(</span>
<span id="cb3-13">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">midi =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"the-moon.mid"</span>,</span>
<span id="cb3-14">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">soundfont =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"~/Library/Audio/Sounds/Banks/FluidR3_GM.sf2"</span>,</span>
<span id="cb3-15">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">output =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"output.wav"</span>,</span>
<span id="cb3-16">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">settings =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'synth.sample-rate'</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">22050</span>),</span>
<span id="cb3-17">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">progress =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">interactive</span>()</span>
<span id="cb3-18">)</span>
<span id="cb3-19"></span>
<span id="cb3-20"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">midi_convert</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">settings =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'synth.sample-rate'</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">22050</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">output =</span>  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'lowquality.wav'</span>)</span>
<span id="cb3-21"></span>
<span id="cb3-22">av<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">av_audio_convert</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"output.wav"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"output.mp3"</span>)</span></code></pre></div>
</details>
</div>
</section>
<section id="midi-to-mp3-all-night-long" class="level2">
<h2 class="anchored" data-anchor-id="midi-to-mp3-all-night-long">midi to mp3 All night long</h2>
<p>And now it is really this easy!</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1">midi <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">system.file</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"generaluser-gs/midi/All_Night_Long.mid"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">package =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fluidsynth"</span>)</span>
<span id="cb4-2">fluidsynth<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">midi_convert</span>(midi, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">output =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'all_night_long.mp3'</span>)</span></code></pre></div>
</details>
</div>
</section>
<section id="testing-faster-renders" class="level2">
<h2 class="anchored" data-anchor-id="testing-faster-renders">testing faster renders</h2>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1">midi <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">system.file</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"generaluser-gs/midi/All_Night_Long.mid"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">package =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fluidsynth"</span>)</span>
<span id="cb5-2">fluidsynth<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">midi_convert</span>(midi, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">output =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'all_night_long.mp3'</span>,</span>
<span id="cb5-3">                         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">settings =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'player.timing-source'</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'sample'</span>,</span>
<span id="cb5-4">                                         <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'synth.lock-memory'</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb5-5">                                         <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'synth.cpu-cores'</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>),</span>
<span id="cb5-6">                         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">verbose =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span></span>
<span id="cb5-7">                        </span>
<span id="cb5-8">                         )</span>
<span id="cb5-9"></span>
<span id="cb5-10"></span>
<span id="cb5-11"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">#########</span></span>
<span id="cb5-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># compare render speed</span></span>
<span id="cb5-13"></span>
<span id="cb5-14">track_name <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"All_Night_Long"</span></span>
<span id="cb5-15"></span>
<span id="cb5-16">wav_name <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(track_name,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">".wav"</span>)</span>
<span id="cb5-17">midi_name <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> midi</span>
<span id="cb5-18">mp3_name <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(track_name,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">".mp3"</span>)</span>
<span id="cb5-19"></span>
<span id="cb5-20">system_command <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> glue<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">glue</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'fluidsynth -F {wav_name} ~/Library/Audio/Sounds/Banks/FluidR3_GM.sf2 {midi_name}'</span>)</span>
<span id="cb5-21"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">system</span>(system_command)</span></code></pre></div>
</details>
</div>
</section>
<section id="fluid-synth-settings" class="level2">
<h2 class="anchored" data-anchor-id="fluid-synth-settings">fluid synth settings</h2>
<p>All of these fluid synth parameters can now be easily modified from R!</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1">knitr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">kable</span>(fluidsynth<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fluidsynth_setting_list</span>())</span></code></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">name</th>
<th style="text-align: left;">type</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">audio.coreaudio.channel-map</td>
<td style="text-align: left;">string</td>
</tr>
<tr class="even">
<td style="text-align: left;">audio.coreaudio.device</td>
<td style="text-align: left;">string</td>
</tr>
<tr class="odd">
<td style="text-align: left;">audio.driver</td>
<td style="text-align: left;">string</td>
</tr>
<tr class="even">
<td style="text-align: left;">audio.file.endian</td>
<td style="text-align: left;">string</td>
</tr>
<tr class="odd">
<td style="text-align: left;">audio.file.format</td>
<td style="text-align: left;">string</td>
</tr>
<tr class="even">
<td style="text-align: left;">audio.file.name</td>
<td style="text-align: left;">string</td>
</tr>
<tr class="odd">
<td style="text-align: left;">audio.file.type</td>
<td style="text-align: left;">string</td>
</tr>
<tr class="even">
<td style="text-align: left;">audio.period-size</td>
<td style="text-align: left;">integer</td>
</tr>
<tr class="odd">
<td style="text-align: left;">audio.periods</td>
<td style="text-align: left;">integer</td>
</tr>
<tr class="even">
<td style="text-align: left;">audio.portaudio.device</td>
<td style="text-align: left;">string</td>
</tr>
<tr class="odd">
<td style="text-align: left;">audio.realtime-prio</td>
<td style="text-align: left;">integer</td>
</tr>
<tr class="even">
<td style="text-align: left;">audio.sample-format</td>
<td style="text-align: left;">string</td>
</tr>
<tr class="odd">
<td style="text-align: left;">midi.autoconnect</td>
<td style="text-align: left;">integer</td>
</tr>
<tr class="even">
<td style="text-align: left;">midi.coremidi.id</td>
<td style="text-align: left;">string</td>
</tr>
<tr class="odd">
<td style="text-align: left;">midi.driver</td>
<td style="text-align: left;">string</td>
</tr>
<tr class="even">
<td style="text-align: left;">midi.portname</td>
<td style="text-align: left;">string</td>
</tr>
<tr class="odd">
<td style="text-align: left;">midi.realtime-prio</td>
<td style="text-align: left;">integer</td>
</tr>
<tr class="even">
<td style="text-align: left;">player.reset-synth</td>
<td style="text-align: left;">integer</td>
</tr>
<tr class="odd">
<td style="text-align: left;">player.timing-source</td>
<td style="text-align: left;">string</td>
</tr>
<tr class="even">
<td style="text-align: left;">shell.port</td>
<td style="text-align: left;">integer</td>
</tr>
<tr class="odd">
<td style="text-align: left;">shell.prompt</td>
<td style="text-align: left;">string</td>
</tr>
<tr class="even">
<td style="text-align: left;">synth.audio-channels</td>
<td style="text-align: left;">integer</td>
</tr>
<tr class="odd">
<td style="text-align: left;">synth.audio-groups</td>
<td style="text-align: left;">integer</td>
</tr>
<tr class="even">
<td style="text-align: left;">synth.chorus.active</td>
<td style="text-align: left;">integer</td>
</tr>
<tr class="odd">
<td style="text-align: left;">synth.chorus.depth</td>
<td style="text-align: left;">double</td>
</tr>
<tr class="even">
<td style="text-align: left;">synth.chorus.level</td>
<td style="text-align: left;">double</td>
</tr>
<tr class="odd">
<td style="text-align: left;">synth.chorus.nr</td>
<td style="text-align: left;">integer</td>
</tr>
<tr class="even">
<td style="text-align: left;">synth.chorus.speed</td>
<td style="text-align: left;">double</td>
</tr>
<tr class="odd">
<td style="text-align: left;">synth.cpu-cores</td>
<td style="text-align: left;">integer</td>
</tr>
<tr class="even">
<td style="text-align: left;">synth.default-soundfont</td>
<td style="text-align: left;">string</td>
</tr>
<tr class="odd">
<td style="text-align: left;">synth.device-id</td>
<td style="text-align: left;">integer</td>
</tr>
<tr class="even">
<td style="text-align: left;">synth.dynamic-sample-loading</td>
<td style="text-align: left;">integer</td>
</tr>
<tr class="odd">
<td style="text-align: left;">synth.effects-channels</td>
<td style="text-align: left;">integer</td>
</tr>
<tr class="even">
<td style="text-align: left;">synth.effects-groups</td>
<td style="text-align: left;">integer</td>
</tr>
<tr class="odd">
<td style="text-align: left;">synth.gain</td>
<td style="text-align: left;">double</td>
</tr>
<tr class="even">
<td style="text-align: left;">synth.ladspa.active</td>
<td style="text-align: left;">integer</td>
</tr>
<tr class="odd">
<td style="text-align: left;">synth.lock-memory</td>
<td style="text-align: left;">integer</td>
</tr>
<tr class="even">
<td style="text-align: left;">synth.midi-bank-select</td>
<td style="text-align: left;">string</td>
</tr>
<tr class="odd">
<td style="text-align: left;">synth.midi-channels</td>
<td style="text-align: left;">integer</td>
</tr>
<tr class="even">
<td style="text-align: left;">synth.min-note-length</td>
<td style="text-align: left;">integer</td>
</tr>
<tr class="odd">
<td style="text-align: left;">synth.overflow.age</td>
<td style="text-align: left;">double</td>
</tr>
<tr class="even">
<td style="text-align: left;">synth.overflow.important</td>
<td style="text-align: left;">double</td>
</tr>
<tr class="odd">
<td style="text-align: left;">synth.overflow.important-channels</td>
<td style="text-align: left;">string</td>
</tr>
<tr class="even">
<td style="text-align: left;">synth.overflow.percussion</td>
<td style="text-align: left;">double</td>
</tr>
<tr class="odd">
<td style="text-align: left;">synth.overflow.released</td>
<td style="text-align: left;">double</td>
</tr>
<tr class="even">
<td style="text-align: left;">synth.overflow.sustained</td>
<td style="text-align: left;">double</td>
</tr>
<tr class="odd">
<td style="text-align: left;">synth.overflow.volume</td>
<td style="text-align: left;">double</td>
</tr>
<tr class="even">
<td style="text-align: left;">synth.polyphony</td>
<td style="text-align: left;">integer</td>
</tr>
<tr class="odd">
<td style="text-align: left;">synth.reverb.active</td>
<td style="text-align: left;">integer</td>
</tr>
<tr class="even">
<td style="text-align: left;">synth.reverb.damp</td>
<td style="text-align: left;">double</td>
</tr>
<tr class="odd">
<td style="text-align: left;">synth.reverb.level</td>
<td style="text-align: left;">double</td>
</tr>
<tr class="even">
<td style="text-align: left;">synth.reverb.room-size</td>
<td style="text-align: left;">double</td>
</tr>
<tr class="odd">
<td style="text-align: left;">synth.reverb.width</td>
<td style="text-align: left;">double</td>
</tr>
<tr class="even">
<td style="text-align: left;">synth.sample-rate</td>
<td style="text-align: left;">double</td>
</tr>
<tr class="odd">
<td style="text-align: left;">synth.threadsafe-api</td>
<td style="text-align: left;">integer</td>
</tr>
<tr class="even">
<td style="text-align: left;">synth.verbose</td>
<td style="text-align: left;">integer</td>
</tr>
</tbody>
</table>
</div>
</div>


</section>

 ]]></description>
  <category>midiblender</category>
  <category>midi</category>
  <category>fluidsynth</category>
  <guid>https://homophony.quest/blog/48_2_15_24_r_fluid_synth/</guid>
  <pubDate>Thu, 15 Feb 2024 05:00:00 GMT</pubDate>
  <media:content url="https://homophony.quest/blog/48_2_15_24_r_fluid_synth/cover.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>Playing a MIDI file on a Quarto blog</title>
  <dc:creator>Matt Crump</dc:creator>
  <link>https://homophony.quest/blog/47_2_13_24_midi_player/</link>
  <description><![CDATA[ 
<script src="https://cdn.jsdelivr.net/combine/npm/tone@14.7.58,npm/@magenta/music@1.23.1/es6/core.js,npm/focus-visible@5,npm/html-midi-player@1.4.0"></script>




<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> diffusers <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> DiffusionPipeline</span>
<span id="cb1-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> transformers <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> set_seed</span>
<span id="cb1-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> PIL <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> Image</span>
<span id="cb1-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> torch</span>
<span id="cb1-5"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> random</span>
<span id="cb1-6"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> ssl</span>
<span id="cb1-7"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> os</span>
<span id="cb1-8">ssl._create_default_https_context <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ssl._create_unverified_context</span>
<span id="cb1-9"></span>
<span id="cb1-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#locate library</span></span>
<span id="cb1-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#model_id = "./stable-diffusion-v1-5"</span></span>
<span id="cb1-12">model_id <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dreamshaper-xl-turbo"</span></span>
<span id="cb1-13"></span>
<span id="cb1-14">pipeline <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> DiffusionPipeline.from_pretrained(</span>
<span id="cb1-15">    pretrained_model_name_or_path <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../../../../bigFiles/huggingface/dreamshaper-xl-turbo/"</span></span>
<span id="cb1-16">)</span>
<span id="cb1-17"></span>
<span id="cb1-18">pipeline <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pipeline.to(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mps"</span>)</span>
<span id="cb1-19"></span>
<span id="cb1-20"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Recommended if your computer has &lt; 64 GB of RAM</span></span>
<span id="cb1-21">pipeline.enable_attention_slicing(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"max"</span>)</span>
<span id="cb1-22"></span>
<span id="cb1-23">prompt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Player piano. piano roll. Automatic self playing piano. white background. transformers cartoon. 3d."</span></span>
<span id="cb1-24"></span>
<span id="cb1-25"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> s <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>):</span>
<span id="cb1-26">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> n <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>]:</span>
<span id="cb1-27">    seed <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> s<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span></span>
<span id="cb1-28">    num_steps <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> n<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb1-29">    set_seed(seed)</span>
<span id="cb1-30">    </span>
<span id="cb1-31">    image <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pipeline(prompt,height <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1024</span>,width <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1024</span>,num_images_per_prompt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,num_inference_steps<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>num_steps)</span>
<span id="cb1-32">    </span>
<span id="cb1-33">    image_name <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"images/synth_</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">_</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">.jpeg"</span></span>
<span id="cb1-34">    </span>
<span id="cb1-35">    image_save <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> image.images[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].save(image_name.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">format</span>(seed,num_steps))</span></code></pre></div>
</details>
</div>
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><img src="https://homophony.quest/blog/47_2_13_24_midi_player/cover.jpg" class="img-fluid quarto-figure quarto-figure-left figure-img" style="width:50.0%"></p>
</figure>
</div>

<div class="no-row-height column-margin column-container"><div class="">
<p>This is just a picture. Scroll down to try the MIDI player for real.</p>
</div></div><p>I happened upon this midi player for webpages. Will it work here too? <a href="https://cifkao.github.io/html-midi-player/" class="uri">https://cifkao.github.io/html-midi-player/</a></p>
<p>Following the instructions from that website, I am adding this script in the yml for this .qmd file, along with a resources line to make sure the midi file is copied to the docs folder.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb2-1">resources: </span>
<span id="cb2-2">  - bluesy_C.mid</span>
<span id="cb2-3">include-before-body:</span>
<span id="cb2-4">  text: |</span>
<span id="cb2-5">    &lt;script src="https://cdn.jsdelivr.net/combine/npm/tone@14.7.58,npm/@magenta/music@1.23.1/es6/core.js,npm/focus-visible@5,npm/html-midi-player@1.4.0"&gt;&lt;/script&gt;</span></code></pre></div>
</details>
</div>
<p>Added an html block that has this code:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb3-1">&lt;midi-player</span>
<span id="cb3-2">  src="bluesy_C.mid"</span>
<span id="cb3-3">  sound-font visualizer="#myVisualizer"&gt;</span>
<span id="cb3-4">&lt;/midi-player&gt;</span>
<span id="cb3-5">&lt;midi-visualizer type="piano-roll" id="myVisualizer"&gt;&lt;/midi-visualizer&gt;</span></code></pre></div>
</details>
</div>
<p>And, it works!</p>
<midi-player src="bluesy_C.mid" sound-font="" visualizer="#myVisualizer">
</midi-player>
<midi-visualizer type="piano-roll" id="myVisualizer"></midi-visualizer>
<hr>
<p>Cool, I have not looked deeply into this at all, so I have no idea what’s behind the sound generation. I’m just curious about what happens if I play a midi file that should have a few different voices. I choose the moon theme from the NES ducktales game. Such a great song.</p>
<midi-player src="the-moon.mid" sound-font="" visualizer="#myVisualizer">
</midi-player>
<midi-visualizer type="piano-roll" id="myVisualizer"></midi-visualizer>
<p>OH YA!!!!!</p>



 ]]></description>
  <category>midiblender</category>
  <category>midi</category>
  <guid>https://homophony.quest/blog/47_2_13_24_midi_player/</guid>
  <pubDate>Tue, 13 Feb 2024 05:00:00 GMT</pubDate>
  <media:content url="https://homophony.quest/blog/47_2_13_24_midi_player/cover.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>MIDI composition with {dplyr}, {midiblender}, and {pyramidi}</title>
  <dc:creator>Matt Crump</dc:creator>
  <link>https://homophony.quest/blog/46_2_12_24_dplyr_midi/</link>
  <description><![CDATA[ 




<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> diffusers <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> DiffusionPipeline</span>
<span id="cb1-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> transformers <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> set_seed</span>
<span id="cb1-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> PIL <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> Image</span>
<span id="cb1-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> torch</span>
<span id="cb1-5"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> random</span>
<span id="cb1-6"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> ssl</span>
<span id="cb1-7"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> os</span>
<span id="cb1-8">ssl._create_default_https_context <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ssl._create_unverified_context</span>
<span id="cb1-9"></span>
<span id="cb1-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#locate library</span></span>
<span id="cb1-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#model_id = "./stable-diffusion-v1-5"</span></span>
<span id="cb1-12">model_id <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dreamshaper-xl-turbo"</span></span>
<span id="cb1-13"></span>
<span id="cb1-14">pipeline <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> DiffusionPipeline.from_pretrained(</span>
<span id="cb1-15">    pretrained_model_name_or_path <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../../../../bigFiles/huggingface/dreamshaper-xl-turbo/"</span></span>
<span id="cb1-16">)</span>
<span id="cb1-17"></span>
<span id="cb1-18">pipeline <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pipeline.to(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mps"</span>)</span>
<span id="cb1-19"></span>
<span id="cb1-20"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Recommended if your computer has &lt; 64 GB of RAM</span></span>
<span id="cb1-21">pipeline.enable_attention_slicing(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"max"</span>)</span>
<span id="cb1-22"></span>
<span id="cb1-23">prompt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"composing music with rstats. dplyr musical notes. tidyverse. hexagons everywhere. 3d. music inside hexagons floating in the universe. musical notes inside the hexagons. cartoon. linocut"</span></span>
<span id="cb1-24"></span>
<span id="cb1-25"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> s <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>):</span>
<span id="cb1-26">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> n <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>]:</span>
<span id="cb1-27">    seed <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> s<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span></span>
<span id="cb1-28">    num_steps <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> n<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb1-29">    set_seed(seed)</span>
<span id="cb1-30">    </span>
<span id="cb1-31">    image <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pipeline(prompt,height <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1024</span>,width <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1024</span>,num_images_per_prompt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,num_inference_steps<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>num_steps)</span>
<span id="cb1-32">    </span>
<span id="cb1-33">    image_name <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"images/synth_</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">_</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">.jpeg"</span></span>
<span id="cb1-34">    </span>
<span id="cb1-35">    image_save <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> image.images[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].save(image_name.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">format</span>(seed,num_steps))</span></code></pre></div>
</details>
</div>
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><img src="https://homophony.quest/blog/46_2_12_24_dplyr_midi/cover.jpg" class="img-fluid quarto-figure quarto-figure-left figure-img" style="width:50.0%"></p>
</figure>
</div>

<div class="no-row-height column-margin column-container"><div class="">
<p>Massive modular synthesizer. Eurorack modular synthesizer. Huge synthesizer room, full or modular synthesizers with patch cords connecting everywer. 80s cartoon. Linocut. - dreamshaper</p>
</div></div><p>This morning I added some <a href="">dplyr</a> style functions to <a href="">midiblender</a> for row-by-row, explicit construction of a data frame containing midi information. I’ll provide some examples here, and use this post to try a few compositional goals with the dplyr approach.</p>
<p><a href="https://urswilke.github.io/pyramidi/articles/compose.html">pyramidi</a> also has examples of composition with dplyr syntax that are worth checking out. My approach relies on several pyramidi internal functions, and is pretty similar overall.</p>
<section id="midi-dataframe-construction-with-dplyr" class="level2">
<h2 class="anchored" data-anchor-id="midi-dataframe-construction-with-dplyr">Midi dataframe construction with {dplyr}</h2>
<p>Some of these examples are also in the vignette, <a href="https://www.crumplab.com/midiblender/articles/midi_construct.html">Midi data frame constructors with dplyr</a>.</p>
<p>The following block of code shows an example of systematically creating a midi data frame, on a row-by-row basis. The functions are mostly wrappers to <code>dplyr::add_row</code>, but they have midi variables in them.</p>
<p>Functions that add a row start with “add”, which makes them easy to find with autocomplete while programming. These functions also pass <code>...</code>, which is useful for placing a row <code>.before</code> or <code>.after</code> another row.</p>
<p>This code block writes important meta messages, shows that it is possible to write program_change and control_change messages, and writes a couple notes before ending the track.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(midiblender)</span>
<span id="cb2-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(pyramidi)</span>
<span id="cb2-3"></span>
<span id="cb2-4">new_midi_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">create_empty_midi_df</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># initialize columns</span></span>
<span id="cb2-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_meta_track_name</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"My track"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb2-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_meta_tempo</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">tempo =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">500000</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb2-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_meta_time_sig</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">numerator =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>,</span>
<span id="cb2-8">                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">denominator =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>,</span>
<span id="cb2-9">                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">clocks_per_click =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">36</span>,</span>
<span id="cb2-10">                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">notated_32nd_notes_per_beat =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb2-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_program_change</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">program =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb2-12">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">channel =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb2-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_control_change</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">control =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">value =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb2-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_note_on</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">time =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">60</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb2-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_note_off</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">time =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">60</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb2-16">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_meta_end_of_track</span>()</span>
<span id="cb2-17"></span>
<span id="cb2-18"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># print the data frame.</span></span>
<span id="cb2-19">knitr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">kable</span>(new_midi_df)</span></code></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 4%">
<col style="width: 3%">
<col style="width: 9%">
<col style="width: 5%">
<col style="width: 3%">
<col style="width: 6%">
<col style="width: 7%">
<col style="width: 10%">
<col style="width: 17%">
<col style="width: 4%">
<col style="width: 4%">
<col style="width: 4%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 5%">
<col style="width: 3%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">i_track</th>
<th style="text-align: left;">meta</th>
<th style="text-align: left;">type</th>
<th style="text-align: left;">name</th>
<th style="text-align: right;">time</th>
<th style="text-align: right;">numerator</th>
<th style="text-align: right;">denominator</th>
<th style="text-align: right;">clocks_per_click</th>
<th style="text-align: right;">notated_32nd_notes_per_beat</th>
<th style="text-align: right;">program</th>
<th style="text-align: right;">channel</th>
<th style="text-align: right;">control</th>
<th style="text-align: right;">value</th>
<th style="text-align: right;">note</th>
<th style="text-align: right;">velocity</th>
<th style="text-align: right;">tempo</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">0</td>
<td style="text-align: left;">TRUE</td>
<td style="text-align: left;">track_name</td>
<td style="text-align: left;">My track</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: right;">0</td>
<td style="text-align: left;">TRUE</td>
<td style="text-align: left;">set_tempo</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">5e+05</td>
</tr>
<tr class="odd">
<td style="text-align: right;">0</td>
<td style="text-align: left;">TRUE</td>
<td style="text-align: left;">time_signature</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: right;">0</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: left;">program_change</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: right;">0</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: left;">control_change</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: right;">0</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: left;">note_on</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">60</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: right;">0</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: left;">note_off</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">60</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: right;">0</td>
<td style="text-align: left;">TRUE</td>
<td style="text-align: left;">end_of_track</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="pyramidi-object-creation-and-export" class="level2">
<h2 class="anchored" data-anchor-id="pyramidi-object-creation-and-export">Pyramidi object creation and export</h2>
<p>This shows how to take a midi dataframe like the above, and export it to disk as a .mid file.</p>
<p>First, <code>pyramidi::MidiFramer$new()</code> creates a new pyramidi object.</p>
<p>Upon creation, it is possible to update <code>new_pyramidi_object$ticks_per_beat</code> with a new value. I believe the default value is <code>960L</code>, and the code below updates it to a smaller value.</p>
<p>The <code>new_midi_df</code> from above is then updated within the pyramidi object using <code>new_pyramidi_object$mf$midi_frame_unnested$update_unnested_mf(new_midi_df)</code>.</p>
<p>Finally, <code>new_pyramidi_object$mf$write_file("file_name.mid")</code> writes the file to disk.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#Initialize new pyramidi object</span></span>
<span id="cb3-2">new_pyramidi_object <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> pyramidi<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span>MidiFramer<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">new</span>()</span>
<span id="cb3-3"></span>
<span id="cb3-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># update ticks per beat</span></span>
<span id="cb3-5">new_pyramidi_object<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>ticks_per_beat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">96</span>L</span>
<span id="cb3-6"></span>
<span id="cb3-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># update object with new midi df</span></span>
<span id="cb3-8">new_pyramidi_object<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>mf<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>midi_frame_unnested<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">update_unnested_mf</span>(new_midi_df)</span>
<span id="cb3-9"></span>
<span id="cb3-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># write to midi file</span></span>
<span id="cb3-11">new_pyramidi_object<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>mf<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">write_file</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"file_name.mid"</span>)</span></code></pre></div>
</details>
</div>
</section>
<section id="composing-with-a-wide-data-frame-then-pivoting-to-long" class="level2">
<h2 class="anchored" data-anchor-id="composing-with-a-wide-data-frame-then-pivoting-to-long">Composing with a wide data frame, then pivoting to long</h2>
<p>Midi files writes note_on and note_off messages in succession with time stamps coding relative time since the last message. For composition, it may be convenient to work with a wider data frame.</p>
<p>Here’s an example of using dplyr to create a series of notes over time. The notes are randomly chosen from the vector <code>possible_notes</code>. The rhythm defining when a note occurs is generated by <code>bresenham_euclidean()</code>, which can produce some nice sounding rhythms. The code chunk will generate as many bars as defined in <code>bars</code>, and the shortest note is a 16th note.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(dplyr)</span>
<span id="cb4-2"></span>
<span id="cb4-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># note parameters</span></span>
<span id="cb4-4">bars <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># number of bars</span></span>
<span id="cb4-5">bar_time_steps <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># number of time steps in a bar</span></span>
<span id="cb4-6">note_duration <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">24</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># note duration in ticks</span></span>
<span id="cb4-7">possible_notes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">60</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">63</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">65</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">66</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">67</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">70</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">72</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">75</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># midi note values to pick</span></span>
<span id="cb4-8"></span>
<span id="cb4-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># create a tibble to compose notes in time </span></span>
<span id="cb4-10">compose_notes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> tibble<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note_id =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">integer</span>(),</span>
<span id="cb4-11">                             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">integer</span>(),</span>
<span id="cb4-12">                             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">beat_on =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">integer</span>(),</span>
<span id="cb4-13">                             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note_on =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">integer</span>(),</span>
<span id="cb4-14">                             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note_off =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">integer</span>()) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb4-15">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># add multiple bars worth of notes</span></span>
<span id="cb4-16">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_row</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">beat_on =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">replicate</span>(bars,<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bresenham_euclidean</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>),<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),</span>
<span id="cb4-17">                                            bar_time_steps,</span>
<span id="cb4-18">                                            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">start=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))),</span>
<span id="cb4-19">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(possible_notes, </span>
<span id="cb4-20">                        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> bar_time_steps<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>bars, </span>
<span id="cb4-21">                        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">replace=</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb4-22">          ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb4-23">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># handle note times</span></span>
<span id="cb4-24">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note_id =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">n</span>(),</span>
<span id="cb4-25">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note_on =</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">n</span>()<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>note_duration,</span>
<span id="cb4-26">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note_off =</span> note_on<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>note_duration) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb4-27">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># keep events where a beat occurred</span></span>
<span id="cb4-28">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(beat_on <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) </span>
<span id="cb4-29"></span>
<span id="cb4-30"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#print to show</span></span>
<span id="cb4-31">knitr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">kable</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(compose_notes))</span></code></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">note_id</th>
<th style="text-align: right;">note</th>
<th style="text-align: right;">beat_on</th>
<th style="text-align: right;">note_on</th>
<th style="text-align: right;">note_off</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">65</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">24</td>
</tr>
<tr class="even">
<td style="text-align: right;">9</td>
<td style="text-align: right;">72</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">192</td>
<td style="text-align: right;">216</td>
</tr>
<tr class="odd">
<td style="text-align: right;">17</td>
<td style="text-align: right;">63</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">384</td>
<td style="text-align: right;">408</td>
</tr>
<tr class="even">
<td style="text-align: right;">19</td>
<td style="text-align: right;">65</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">432</td>
<td style="text-align: right;">456</td>
</tr>
<tr class="odd">
<td style="text-align: right;">20</td>
<td style="text-align: right;">72</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">456</td>
<td style="text-align: right;">480</td>
</tr>
<tr class="even">
<td style="text-align: right;">21</td>
<td style="text-align: right;">72</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">480</td>
<td style="text-align: right;">504</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>At this point the <code>compose_notes</code> dataframe contains note_on and note_off information in wide format. A quick call to <code>tidyr::pivot_longer</code>, along with subtracting the time stamps to get them into relative time, and we have a dataframe that is nearly ready for export.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1">compose_notes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> compose_notes <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb5-2">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># pivot to long</span></span>
<span id="cb5-3">  tidyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_longer</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"note_on"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"note_off"</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names_to=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"type"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values_to=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"time"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb5-4">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># relative time</span></span>
<span id="cb5-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">time =</span> time <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lag</span>(time,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">default=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>))</span>
<span id="cb5-6"></span>
<span id="cb5-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#print to show</span></span>
<span id="cb5-8">knitr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">kable</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(compose_notes))</span></code></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">note_id</th>
<th style="text-align: right;">note</th>
<th style="text-align: right;">beat_on</th>
<th style="text-align: left;">type</th>
<th style="text-align: right;">time</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">65</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">note_on</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">65</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">note_off</td>
<td style="text-align: right;">24</td>
</tr>
<tr class="odd">
<td style="text-align: right;">9</td>
<td style="text-align: right;">72</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">note_on</td>
<td style="text-align: right;">168</td>
</tr>
<tr class="even">
<td style="text-align: right;">9</td>
<td style="text-align: right;">72</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">note_off</td>
<td style="text-align: right;">24</td>
</tr>
<tr class="odd">
<td style="text-align: right;">17</td>
<td style="text-align: right;">63</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">note_on</td>
<td style="text-align: right;">168</td>
</tr>
<tr class="even">
<td style="text-align: right;">17</td>
<td style="text-align: right;">63</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">note_off</td>
<td style="text-align: right;">24</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Now we have a body of midi messages. The last step is to put them into a full-fledged midi dataframe, and export them.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># create new midi_df</span></span>
<span id="cb6-2"></span>
<span id="cb6-3"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## add to a new midi df</span></span>
<span id="cb6-4">new_midi_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">create_empty_midi_df</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># initialize</span></span>
<span id="cb6-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_meta_track_name</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"My track"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb6-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_meta_tempo</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">tempo =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">500000</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb6-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_meta_time_sig</span>(</span>
<span id="cb6-8">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">numerator =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>,</span>
<span id="cb6-9">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">denominator =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>,</span>
<span id="cb6-10">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">clocks_per_click =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">36</span>,</span>
<span id="cb6-11">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">notated_32nd_notes_per_beat =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span></span>
<span id="cb6-12">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb6-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_program_change</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">program =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb6-14">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">channel =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb6-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_control_change</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">control =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">value =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb6-16">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># add new notes &lt;---------------Adding stuff from compose_notes</span></span>
<span id="cb6-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_row</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">i_track =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dim</span>(compose_notes)[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]), </span>
<span id="cb6-18">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">meta =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>,<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dim</span>(compose_notes)[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]),</span>
<span id="cb6-19">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note =</span> compose_notes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>note,</span>
<span id="cb6-20">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> compose_notes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>type,</span>
<span id="cb6-21">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">time =</span> compose_notes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>time,</span>
<span id="cb6-22">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">velocity =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">64</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb6-23">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_meta_end_of_track</span>()</span>
<span id="cb6-24"></span>
<span id="cb6-25"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#write midi</span></span>
<span id="cb6-26"></span>
<span id="cb6-27"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#Initialize new pyramidi object</span></span>
<span id="cb6-28">new_pyramidi_object <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> pyramidi<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span>MidiFramer<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">new</span>()</span>
<span id="cb6-29"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># update ticks per beat</span></span>
<span id="cb6-30">new_pyramidi_object<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>ticks_per_beat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">96</span>L</span>
<span id="cb6-31"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># update object with new midi df</span></span>
<span id="cb6-32">new_pyramidi_object<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>mf<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>midi_frame_unnested<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">update_unnested_mf</span>(new_midi_df)</span>
<span id="cb6-33"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># write to midi file</span></span>
<span id="cb6-34">new_pyramidi_object<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>mf<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">write_file</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"file_name.mid"</span>)</span></code></pre></div>
</details>
</div>
</section>
<section id="making-it-less-of-a-wall-of-code" class="level2">
<h2 class="anchored" data-anchor-id="making-it-less-of-a-wall-of-code">Making it less of a wall of code</h2>
<p>I’m not working on this right now. Going with walls of code.</p>
</section>
<section id="frequency-biased-sequences" class="level2">
<h2 class="anchored" data-anchor-id="frequency-biased-sequences">Frequency biased sequences</h2>
<p>I’ve got a project coming up where I will likely need to generate a whole bunch of “musical” sequences with specific kinds of statistical structure. I’m not sure whether I will use the {dplyr} style code for this. This is a note to future self about what it might look like.</p>
<ul>
<li>got something that will work later</li>
<li>need to write functions for creating unequal frequency vectors with specific constraints</li>
<li>Move development on this issue to another castle.</li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># note parameters</span></span>
<span id="cb7-2">bars <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span></span>
<span id="cb7-3">possible_time_steps <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span></span>
<span id="cb7-4">note_duration <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">24</span></span>
<span id="cb7-5">possible_notes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">60</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">63</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">65</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">66</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">67</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">70</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">72</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">75</span>)</span>
<span id="cb7-6"></span>
<span id="cb7-7">total_notes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span></span>
<span id="cb7-8">total_beats <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> bars<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>possible_time_steps</span>
<span id="cb7-9"></span>
<span id="cb7-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># need to work out some algorithms for unequal frequency distribution generation, these are enough for an example</span></span>
<span id="cb7-11">equal_frequencies <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(total_beats<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>)</span>
<span id="cb7-12">half_frequencies <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> equal_frequencies <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> (equal_frequencies <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(.<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>.<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">each =</span> total_notes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>))</span>
<span id="cb7-13">most_unequal_frequencies <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,(total_notes<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">-1</span>)),(total_notes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(total_notes<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">-1</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))</span>
<span id="cb7-14"></span>
<span id="cb7-15">note_frequency_matrix <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbind</span>(equal_frequencies,</span>
<span id="cb7-16">                              half_frequencies,</span>
<span id="cb7-17">                              most_unequal_frequencies)</span>
<span id="cb7-18"></span>
<span id="cb7-19">compose_notes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> tibble<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note_id =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">integer</span>(),</span>
<span id="cb7-20">                             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">integer</span>(),</span>
<span id="cb7-21">                             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">beat_on =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">integer</span>(),</span>
<span id="cb7-22">                             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note_on =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">integer</span>(),</span>
<span id="cb7-23">                             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note_off =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">integer</span>()) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb7-24">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1 beat every time_step</span></span>
<span id="cb7-25">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rowwise</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb7-26">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_row</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">beat_on =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,</span>
<span id="cb7-27">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(possible_notes),</span>
<span id="cb7-28">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times =</span> note_frequency_matrix[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,])),</span>
<span id="cb7-29">          ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb7-30">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ungroup</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb7-31">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># handle note times</span></span>
<span id="cb7-32">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note_id =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">n</span>(),</span>
<span id="cb7-33">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note_on =</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">n</span>()<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>note_duration,</span>
<span id="cb7-34">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note_off =</span> note_on<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>note_duration) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb7-35">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(beat_on <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb7-36">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#pivot to long</span></span>
<span id="cb7-37">  tidyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_longer</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"note_on"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"note_off"</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names_to=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"type"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values_to=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"time"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb7-38">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">time =</span> time <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lag</span>(time,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">default=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>))</span>
<span id="cb7-39"></span>
<span id="cb7-40"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## add to a new midi df</span></span>
<span id="cb7-41">new_midi_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">create_empty_midi_df</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># initialize</span></span>
<span id="cb7-42">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_meta_track_name</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"My track"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb7-43">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_meta_tempo</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">tempo =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">500000</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb7-44">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_meta_time_sig</span>(</span>
<span id="cb7-45">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">numerator =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>,</span>
<span id="cb7-46">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">denominator =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>,</span>
<span id="cb7-47">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">clocks_per_click =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">36</span>,</span>
<span id="cb7-48">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">notated_32nd_notes_per_beat =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span></span>
<span id="cb7-49">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb7-50">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_program_change</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">program =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb7-51">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">channel =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb7-52">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_control_change</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">control =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">value =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb7-53">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#use dplyr::add_row to add a bunch of notes</span></span>
<span id="cb7-54">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_row</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">i_track =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dim</span>(compose_notes)[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]), </span>
<span id="cb7-55">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">meta =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>,<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dim</span>(compose_notes)[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]),</span>
<span id="cb7-56">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note =</span> compose_notes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>note,</span>
<span id="cb7-57">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> compose_notes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>type,</span>
<span id="cb7-58">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">time =</span> compose_notes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>time,</span>
<span id="cb7-59">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">velocity =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">64</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb7-60">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_meta_end_of_track</span>()</span>
<span id="cb7-61"></span>
<span id="cb7-62"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#write midi</span></span>
<span id="cb7-63"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#Initialize new pyramidi object</span></span>
<span id="cb7-64">new_pyramidi_object <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> pyramidi<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span>MidiFramer<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">new</span>()</span>
<span id="cb7-65"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># update ticks per beat</span></span>
<span id="cb7-66">new_pyramidi_object<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>ticks_per_beat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">96</span>L</span>
<span id="cb7-67"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># update object with new midi df</span></span>
<span id="cb7-68">new_pyramidi_object<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>mf<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>midi_frame_unnested<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">update_unnested_mf</span>(new_midi_df)</span>
<span id="cb7-69"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># write to midi file</span></span>
<span id="cb7-70">new_pyramidi_object<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>mf<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">write_file</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"most_unequal.mid"</span>)</span></code></pre></div>
</details>
</div>
</section>
<section id="bar-blues-sequence" class="level2">
<h2 class="anchored" data-anchor-id="bar-blues-sequence">12-bar blues sequence</h2>
<p>I like a good blues scale. Undoubtedly, whatever happens next won’t be bluesy, but that’s ok.</p>
<p>Algorithm components</p>
<ol type="1">
<li>Sample notes from a blues scale</li>
<li>Eavery bar, randomly sample a euclidean rhythm to fill the bar</li>
<li>randomly assign notes to the beats in the euclidean rhythm</li>
<li>Create a few tracks of this.</li>
<li>try shifting chords, do 12 bar blues</li>
</ol>
<p>Got it working, nice</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1">all_tracks <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>()</span>
<span id="cb8-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># loop for each track</span></span>
<span id="cb8-3"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span>(t <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>) {</span>
<span id="cb8-4">  </span>
<span id="cb8-5">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># note parameters</span></span>
<span id="cb8-6">  bars <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span></span>
<span id="cb8-7">  possible_time_steps <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span></span>
<span id="cb8-8">  note_duration <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">24</span></span>
<span id="cb8-9">  possible_notes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">60</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">63</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">65</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">66</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">67</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">70</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">72</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">75</span>)</span>
<span id="cb8-10">  </span>
<span id="cb8-11">  key_vector <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">each=</span>possible_time_steps),<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>)</span>
<span id="cb8-12">  </span>
<span id="cb8-13">  compose_notes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> tibble<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>(</span>
<span id="cb8-14">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note_id =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">integer</span>(),</span>
<span id="cb8-15">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">integer</span>(),</span>
<span id="cb8-16">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">beat_on =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">integer</span>(),</span>
<span id="cb8-17">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note_on =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">integer</span>(),</span>
<span id="cb8-18">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note_off =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">integer</span>()</span>
<span id="cb8-19">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb8-20">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># use euclidean rhythm</span></span>
<span id="cb8-21">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rowwise</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb8-22">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_row</span>(</span>
<span id="cb8-23">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">beat_on =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">replicate</span>(</span>
<span id="cb8-24">        bars,</span>
<span id="cb8-25">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bresenham_euclidean</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),</span>
<span id="cb8-26">                            possible_time_steps,</span>
<span id="cb8-27">                            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">start =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb8-28">      )),</span>
<span id="cb8-29">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(possible_notes,</span>
<span id="cb8-30">                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> possible_time_steps <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> bars,</span>
<span id="cb8-31">                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">replace =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> key_vector</span>
<span id="cb8-32">    ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb8-33">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ungroup</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb8-34">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># handle note times</span></span>
<span id="cb8-35">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb8-36">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note_id =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">n</span>(),</span>
<span id="cb8-37">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note_on =</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">n</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> note_duration,</span>
<span id="cb8-38">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note_off =</span> note_on <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> note_duration</span>
<span id="cb8-39">    ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb8-40">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(beat_on <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb8-41">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#pivot to long</span></span>
<span id="cb8-42">    tidyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_longer</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"note_on"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"note_off"</span>),</span>
<span id="cb8-43">                        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"type"</span>,</span>
<span id="cb8-44">                        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"time"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb8-45">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">time =</span> time <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lag</span>(time, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">default =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>))</span>
<span id="cb8-46">  <span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">######################</span></span>
<span id="cb8-47">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># End composition </span></span>
<span id="cb8-48">  </span>
<span id="cb8-49">  <span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">#######################</span></span>
<span id="cb8-50">  <span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## add composition to a new midi df</span></span>
<span id="cb8-51">  new_midi_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">create_empty_midi_df</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># initialize</span></span>
<span id="cb8-52">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_meta_track_name</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"My track"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb8-53">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_meta_tempo</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">tempo =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">500000</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb8-54">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_meta_time_sig</span>(</span>
<span id="cb8-55">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">numerator =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>,</span>
<span id="cb8-56">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">denominator =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>,</span>
<span id="cb8-57">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">clocks_per_click =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">36</span>,</span>
<span id="cb8-58">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">notated_32nd_notes_per_beat =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span></span>
<span id="cb8-59">    ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb8-60">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_program_change</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">program =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb8-61">                       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">channel =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb8-62">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_control_change</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">control =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">value =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb8-63">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Composition added here</span></span>
<span id="cb8-64">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_row</span>(</span>
<span id="cb8-65">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">i_track =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dim</span>(compose_notes)[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]),</span>
<span id="cb8-66">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">meta =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dim</span>(compose_notes)[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]),</span>
<span id="cb8-67">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note =</span> compose_notes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>note,</span>
<span id="cb8-68">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> compose_notes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>type,</span>
<span id="cb8-69">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">time =</span> compose_notes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>time,</span>
<span id="cb8-70">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">velocity =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">64</span></span>
<span id="cb8-71">    ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb8-72">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_meta_end_of_track</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb8-73">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">i_track =</span> t) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># set current track number</span></span>
<span id="cb8-74">  </span>
<span id="cb8-75">  all_tracks <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbind</span>(all_tracks,new_midi_df)</span>
<span id="cb8-76">  </span>
<span id="cb8-77">}</span>
<span id="cb8-78"></span>
<span id="cb8-79"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#write midi</span></span>
<span id="cb8-80"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#Initialize new pyramidi object</span></span>
<span id="cb8-81">new_pyramidi_object <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> pyramidi<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span>MidiFramer<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">new</span>()</span>
<span id="cb8-82"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># update ticks per beat</span></span>
<span id="cb8-83">new_pyramidi_object<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>ticks_per_beat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">96</span>L</span>
<span id="cb8-84"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># update object with new midi df</span></span>
<span id="cb8-85">new_pyramidi_object<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>mf<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>midi_frame_unnested<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">update_unnested_mf</span>(all_tracks)</span>
<span id="cb8-86"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># write to midi file</span></span>
<span id="cb8-87">new_pyramidi_object<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>mf<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">write_file</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bluesy_A.mid"</span>)</span></code></pre></div>
</details>
</div>
<p><audio controls=""> <source src="bluesy_A_ableton_01.mp3" type="audio/wav"> </audio></p>
<p>I put three midi tracks into ableton, added synth voices and drums, and that’s what it sounds like.</p>
<p>Hmmm, the dplyr style worked out. I didn’t think it would be so easy to get a 12-bar blues thing going. It still sounds like a computer made it, but a computer did make it, so that’s fair.</p>
<hr>
<p>Adding parameters per track in a list.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(midiblender)</span>
<span id="cb9-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(dplyr)</span>
<span id="cb9-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(pyramidi)</span>
<span id="cb9-4"></span>
<span id="cb9-5">all_tracks <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>()</span>
<span id="cb9-6"></span>
<span id="cb9-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># note parameters</span></span>
<span id="cb9-8">  bars <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span></span>
<span id="cb9-9">  possible_time_steps <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span></span>
<span id="cb9-10">  note_duration <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">24</span></span>
<span id="cb9-11">  </span>
<span id="cb9-12">  track_params <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">track_1_bass =</span></span>
<span id="cb9-13">                         <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">possible_notes =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">60</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">72</span>,   <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#1     2     3  4     5     6     7  8 </span></span>
<span id="cb9-14">                                                   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>)), </span>
<span id="cb9-15">                            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">key_vector =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>), </span>
<span id="cb9-16">                                                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">each =</span> possible_time_steps), </span>
<span id="cb9-17">                                             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>)</span>
<span id="cb9-18">                           ),</span>
<span id="cb9-19">                       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">track_2_mid =</span></span>
<span id="cb9-20">                         <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">possible_notes =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">60</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">72</span>,   <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#1     2     3  4     5     6     7  8 </span></span>
<span id="cb9-21">                                                   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>)), </span>
<span id="cb9-22">                            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">key_vector =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>), </span>
<span id="cb9-23">                                                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">each =</span> possible_time_steps), </span>
<span id="cb9-24">                                             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>)</span>
<span id="cb9-25">                          ),</span>
<span id="cb9-26">                       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">track_3_mid =</span></span>
<span id="cb9-27">                         <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">possible_notes =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">60</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">72</span>,   <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#1     2     3  4     5     6     7  8 </span></span>
<span id="cb9-28">                                                   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)), </span>
<span id="cb9-29">                            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">key_vector =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>), </span>
<span id="cb9-30">                                                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">each =</span> possible_time_steps), </span>
<span id="cb9-31">                                             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>)</span>
<span id="cb9-32">                          )</span>
<span id="cb9-33">  )</span>
<span id="cb9-34">                       </span>
<span id="cb9-35">                           </span>
<span id="cb9-36"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># loop for each track</span></span>
<span id="cb9-37"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span>(t <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>) {</span>
<span id="cb9-38">  </span>
<span id="cb9-39">  compose_notes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> tibble<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>(</span>
<span id="cb9-40">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note_id =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">integer</span>(),</span>
<span id="cb9-41">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">integer</span>(),</span>
<span id="cb9-42">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">beat_on =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">integer</span>(),</span>
<span id="cb9-43">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note_on =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">integer</span>(),</span>
<span id="cb9-44">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note_off =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">integer</span>()</span>
<span id="cb9-45">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb9-46">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># use euclidean rhythm</span></span>
<span id="cb9-47">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rowwise</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb9-48">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_row</span>(</span>
<span id="cb9-49">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">beat_on =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">replicate</span>(</span>
<span id="cb9-50">        bars,</span>
<span id="cb9-51">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bresenham_euclidean</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">13</span>), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), </span>
<span id="cb9-52">                            possible_time_steps,</span>
<span id="cb9-53">                            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">start =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb9-54">      )),</span>
<span id="cb9-55">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(track_params[[t]]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>possible_notes,</span>
<span id="cb9-56">                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> possible_time_steps <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> bars,</span>
<span id="cb9-57">                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">replace =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> track_params[[t]]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>key_vector</span>
<span id="cb9-58">    ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb9-59">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ungroup</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb9-60">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># handle note times</span></span>
<span id="cb9-61">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb9-62">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note_id =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">n</span>(),</span>
<span id="cb9-63">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note_on =</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">n</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> note_duration,</span>
<span id="cb9-64">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note_off =</span> note_on <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> note_duration</span>
<span id="cb9-65">    ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb9-66">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(beat_on <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb9-67">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#pivot to long</span></span>
<span id="cb9-68">    tidyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_longer</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"note_on"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"note_off"</span>),</span>
<span id="cb9-69">                        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"type"</span>,</span>
<span id="cb9-70">                        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"time"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb9-71">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">time =</span> time <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lag</span>(time, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">default =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>))</span>
<span id="cb9-72">  <span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">######################</span></span>
<span id="cb9-73">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># End composition </span></span>
<span id="cb9-74">  </span>
<span id="cb9-75">  <span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">#######################</span></span>
<span id="cb9-76">  <span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## add composition to a new midi df</span></span>
<span id="cb9-77">  new_midi_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">create_empty_midi_df</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># initialize</span></span>
<span id="cb9-78">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_meta_track_name</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"My track"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb9-79">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_meta_tempo</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">tempo =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">500000</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb9-80">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_meta_time_sig</span>(</span>
<span id="cb9-81">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">numerator =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>,</span>
<span id="cb9-82">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">denominator =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>,</span>
<span id="cb9-83">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">clocks_per_click =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">36</span>,</span>
<span id="cb9-84">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">notated_32nd_notes_per_beat =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span></span>
<span id="cb9-85">    ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb9-86">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_program_change</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">program =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb9-87">                       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">channel =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb9-88">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_control_change</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">control =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">value =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb9-89">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Composition added here</span></span>
<span id="cb9-90">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_row</span>(</span>
<span id="cb9-91">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">i_track =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dim</span>(compose_notes)[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]),</span>
<span id="cb9-92">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">meta =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dim</span>(compose_notes)[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]),</span>
<span id="cb9-93">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note =</span> compose_notes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>note,</span>
<span id="cb9-94">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> compose_notes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>type,</span>
<span id="cb9-95">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">time =</span> compose_notes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>time,</span>
<span id="cb9-96">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">velocity =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">64</span></span>
<span id="cb9-97">    ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb9-98">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_meta_end_of_track</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb9-99">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">i_track =</span> t) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># set current track number</span></span>
<span id="cb9-100">  </span>
<span id="cb9-101">  all_tracks <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbind</span>(all_tracks,new_midi_df)</span>
<span id="cb9-102">  </span>
<span id="cb9-103">}</span>
<span id="cb9-104"></span>
<span id="cb9-105"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#write midi</span></span>
<span id="cb9-106"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#Initialize new pyramidi object</span></span>
<span id="cb9-107">new_pyramidi_object <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> pyramidi<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span>MidiFramer<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">new</span>()</span>
<span id="cb9-108"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># update ticks per beat</span></span>
<span id="cb9-109">new_pyramidi_object<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>ticks_per_beat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">96</span>L</span>
<span id="cb9-110"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># update object with new midi df</span></span>
<span id="cb9-111">new_pyramidi_object<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>mf<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>midi_frame_unnested<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">update_unnested_mf</span>(all_tracks)</span>
<span id="cb9-112"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># write to midi file</span></span>
<span id="cb9-113">new_pyramidi_object<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>mf<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">write_file</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bluesy_C.mid"</span>)</span></code></pre></div>
</details>
</div>


</section>

 ]]></description>
  <category>midiblender</category>
  <category>pyramidi</category>
  <category>rstats</category>
  <category>dplyr</category>
  <category>midi composition</category>
  <guid>https://homophony.quest/blog/46_2_12_24_dplyr_midi/</guid>
  <pubDate>Mon, 12 Feb 2024 05:00:00 GMT</pubDate>
  <media:content url="https://homophony.quest/blog/46_2_12_24_dplyr_midi/cover.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>Eurorack notes to self</title>
  <dc:creator>Matt Crump</dc:creator>
  <link>https://homophony.quest/blog/45_2_11_24_eurorack/</link>
  <description><![CDATA[ 




<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> diffusers <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> DiffusionPipeline</span>
<span id="cb1-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> transformers <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> set_seed</span>
<span id="cb1-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> PIL <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> Image</span>
<span id="cb1-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> torch</span>
<span id="cb1-5"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> random</span>
<span id="cb1-6"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> ssl</span>
<span id="cb1-7"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> os</span>
<span id="cb1-8">ssl._create_default_https_context <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ssl._create_unverified_context</span>
<span id="cb1-9"></span>
<span id="cb1-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#locate library</span></span>
<span id="cb1-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#model_id = "./stable-diffusion-v1-5"</span></span>
<span id="cb1-12">model_id <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dreamshaper-xl-turbo"</span></span>
<span id="cb1-13"></span>
<span id="cb1-14">pipeline <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> DiffusionPipeline.from_pretrained(</span>
<span id="cb1-15">    pretrained_model_name_or_path <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../../../../bigFiles/huggingface/dreamshaper-xl-turbo/"</span></span>
<span id="cb1-16">)</span>
<span id="cb1-17"></span>
<span id="cb1-18">pipeline <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pipeline.to(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mps"</span>)</span>
<span id="cb1-19"></span>
<span id="cb1-20"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Recommended if your computer has &lt; 64 GB of RAM</span></span>
<span id="cb1-21">pipeline.enable_attention_slicing(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"max"</span>)</span>
<span id="cb1-22"></span>
<span id="cb1-23">prompt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Massive modular synthesizer. Eurorack modular synthesizer. Huge synthesizer room, full or modular synthesizers with patch cords connecting everywer. 80s cartoon. Linocut."</span></span>
<span id="cb1-24"></span>
<span id="cb1-25"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> s <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>):</span>
<span id="cb1-26">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> n <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>]:</span>
<span id="cb1-27">    seed <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> s<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span></span>
<span id="cb1-28">    num_steps <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> n<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb1-29">    set_seed(seed)</span>
<span id="cb1-30">    </span>
<span id="cb1-31">    image <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pipeline(prompt,height <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1024</span>,width <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1024</span>,num_images_per_prompt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,num_inference_steps<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>num_steps)</span>
<span id="cb1-32">    </span>
<span id="cb1-33">    image_name <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"images/synth_</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">_</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">.jpeg"</span></span>
<span id="cb1-34">    </span>
<span id="cb1-35">    image_save <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> image.images[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].save(image_name.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">format</span>(seed,num_steps))</span></code></pre></div>
</details>
</div>
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><img src="https://homophony.quest/blog/45_2_11_24_eurorack/cover.jpg" class="img-fluid quarto-figure quarto-figure-left figure-img" style="width:50.0%"></p>
</figure>
</div>

<div class="no-row-height column-margin column-container"><div class="">
<p>Massive modular synthesizer. Eurorack modular synthesizer. Huge synthesizer room, full or modular synthesizers with patch cords connecting everywer. 80s cartoon. Linocut. - dreamshaper</p>
</div></div><p>Notes to self about eurorack stuff.</p>
<section id="programmable-eurorack-modules" class="level2">
<h2 class="anchored" data-anchor-id="programmable-eurorack-modules">Programmable Eurorack Modules</h2>
<p>I very briefly <a href="https://www.crumplab.com/blog/older_9999_7_28_20_OC/">tried to program ornaments and crime one time</a>. But that’s about it. I could see becoming interested in putting ideas from {midiblender}, and other ideas, into eurorack in different ways.</p>
<ul>
<li><p>older post on mod wiggler about open source programmable eurorack modules <a href="https://modwiggler.com/forum/viewtopic.php?t=220061" class="uri">https://modwiggler.com/forum/viewtopic.php?t=220061</a></p></li>
<li><p>a useful list of programmable audio platforms <a href="https://blog.macieksypniewski.com/2019/07/08/programmable-audio-platforms/" class="uri">https://blog.macieksypniewski.com/2019/07/08/programmable-audio-platforms/</a></p></li>
<li><p>Bela pepper <a href="https://shop.bela.io/collections/modular/products/pepper" class="uri">https://shop.bela.io/collections/modular/products/pepper</a></p></li>
<li><p><a href="https://monome.org/docs/">Monome</a> has some interesting stuff</p></li>
<li><p><a href="https://allensynthesis.co.uk/modules/europi.html">EuroPi</a> Based on raspberry pi pico I think</p></li>
<li><p><a href="https://www.expert-sleepers.co.uk/es8.html">Es8</a> or <a href="https://www.expert-sleepers.co.uk/es9.html">ES-9</a> USB-audio interface…I could use one of these in general I think…hmm.</p></li>
</ul>
</section>
<section id="eurorack-composition-ideas" class="level2">
<h2 class="anchored" data-anchor-id="eurorack-composition-ideas">Eurorack composition ideas</h2>
<p>I don’t really want to mess with my computer while messing with eurorack at the same time, as a general rule.</p>
<section id="easy-can-do-right-now" class="level3">
<h3 class="anchored" data-anchor-id="easy-can-do-right-now">Easy can do right now</h3>
<ol type="1">
<li>Use {midiblender} to compose MIDI files with some things I want, play them through hermod. This gives me 8-voices. Probably the easiest thing I can do right now. Benefits are that the midi files are pre-packaged, and I shouldn’t have to worry about any latency or anything like that.</li>
</ol>
<ul>
<li>I like this pattern for a bunch of reasons. I focus on some compositional ideas outside of eurorack. Generate all the midi based on the compositional ideas…which basically acts as CV and gate sources. Hook it all up to voices on, and wreck the whole thing as much as possible by turning knobs during playback. Sounds fun. Feels a little bit locked in to the compositional direction from the midi files, but I guess that’s the whole point of composing something.</li>
</ul>
<ol start="2" type="1">
<li>This is somewhere in the middle, but I wonder about a way to rapidly scroll through a bunch of midi files, while they are playing, kind of like how one might scroll through a wavetable and hear all of the notes. If I had banks of possible midi files to play, and could easily scroll them, that would be fun. hmmmm.</li>
</ol>
</section>
<section id="longer-term-cant-do-right-now" class="level3">
<h3 class="anchored" data-anchor-id="longer-term-cant-do-right-now">longer term can’t do right now</h3>
<ol start="2" type="1">
<li>Have a module (or computer program) that can accumulate CV or midi from a live performance, crunch the probabilities at various levels (e.g., into various markov chain ideas, or other weird stuff), and do interesting generative sequencing based off of the live performance statistics.</li>
</ol>


</section>
</section>

 ]]></description>
  <category>midiblender</category>
  <category>eurorack</category>
  <category>programmable eurorack</category>
  <category>composition</category>
  <guid>https://homophony.quest/blog/45_2_11_24_eurorack/</guid>
  <pubDate>Sun, 11 Feb 2024 05:00:00 GMT</pubDate>
  <media:content url="https://homophony.quest/blog/45_2_11_24_eurorack/cover.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>Euclidean Rhythms and circulating sequences with information theory concepts</title>
  <dc:creator>Matt Crump</dc:creator>
  <link>https://homophony.quest/blog/44_2_10_24_euclid/</link>
  <description><![CDATA[ 




<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> diffusers <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> DiffusionPipeline</span>
<span id="cb1-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> transformers <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> set_seed</span>
<span id="cb1-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> PIL <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> Image</span>
<span id="cb1-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> torch</span>
<span id="cb1-5"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> random</span>
<span id="cb1-6"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> ssl</span>
<span id="cb1-7"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> os</span>
<span id="cb1-8">ssl._create_default_https_context <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ssl._create_unverified_context</span>
<span id="cb1-9"></span>
<span id="cb1-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#locate library</span></span>
<span id="cb1-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#model_id = "./stable-diffusion-v1-5"</span></span>
<span id="cb1-12">model_id <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dreamshaper-xl-turbo"</span></span>
<span id="cb1-13"></span>
<span id="cb1-14">pipeline <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> DiffusionPipeline.from_pretrained(</span>
<span id="cb1-15">    pretrained_model_name_or_path <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../../../../bigFiles/huggingface/dreamshaper-xl-turbo/"</span></span>
<span id="cb1-16">)</span>
<span id="cb1-17"></span>
<span id="cb1-18">pipeline <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pipeline.to(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mps"</span>)</span>
<span id="cb1-19"></span>
<span id="cb1-20"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Recommended if your computer has &lt; 64 GB of RAM</span></span>
<span id="cb1-21">pipeline.enable_attention_slicing(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"max"</span>)</span>
<span id="cb1-22"></span>
<span id="cb1-23">prompt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"A computer drumming. synthesizer drum. Drum beats. probabilistic drums. information theory. Euclid. Math. Drum machines everywhere. background is a room full of drum machines. Rhythm. drums. Transformers cartoon. retro 80s."</span></span>
<span id="cb1-24"></span>
<span id="cb1-25"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> s <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>):</span>
<span id="cb1-26">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> n <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>]:</span>
<span id="cb1-27">    seed <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> s<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span></span>
<span id="cb1-28">    num_steps <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> n<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb1-29">    set_seed(seed)</span>
<span id="cb1-30">    </span>
<span id="cb1-31">    image <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pipeline(prompt,height <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1024</span>,width <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1024</span>,num_images_per_prompt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,num_inference_steps<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>num_steps)</span>
<span id="cb1-32">    </span>
<span id="cb1-33">    image_name <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"images/synth_</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">_</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">.jpeg"</span></span>
<span id="cb1-34">    </span>
<span id="cb1-35">    image_save <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> image.images[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].save(image_name.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">format</span>(seed,num_steps))</span></code></pre></div>
</details>
</div>
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><img src="https://homophony.quest/blog/44_2_10_24_euclid/cover.jpg" class="img-fluid quarto-figure quarto-figure-left figure-img" style="width:50.0%"></p>
</figure>
</div>

<div class="no-row-height column-margin column-container"><div class="">
<p>A computer drumming. synthesizer drum. Drum beats. probabilistic drums. information theory. Euclid. Math. Drum machines everywhere. background is a room full of drum machines. Rhythm. drums. Transformers cartoon. retro 80s. - dreamshaper</p>
</div></div><p>This is another exploratory post. I’m planning to use <a href="https://www.crumplab.com/midiblender/">midiblender</a> for a few things in the future. One of them is to generate stimuli for musical recognition tasks. The others are mostly fooling around. This here is a bit of both.</p>
<p>I’ve been practicing the following kinds of patterns on piano, and I’ve been thinking about coding them as a generative sequence algorithm. I’ll start playing around on a single note, like C major, and then slowly add notes from the circle of fifths around the note I’m playing. I’ll bring in F and G, which gives a very Csus feel. And, then I’ll go out even more, add a Bb and D. These fifths are symmetrical about C. Sometimes I’ll go a bit lopsided, maybe add an A into the mix, and feel it out as I play. Another way to look at this is that I’m playing some group of notes from the circle of fifths, like {Bb, F, C, G, D}. I could expand the collection by adding more notes, or reduce the collection by taking some away. Sometimes I rotate around the circle, etc. It’s fun to play on piano.</p>
<p>One goal for this post is to get an algorithm that does something like the above. Just wanders around the cycle of fifths, expands and contracts the collection of notes to play, and then spits them out in an interesting rhythm.</p>
<p>But, what rhythm should I code in here? Euclidean Rhythms to the rescue. They mostly sound fine. Not the most super interesting rhythms ever, but very fine. If you don’t know what they are, <a href="https://medium.com/code-music-noise/euclidean-rhythms-391d879494df">this was a good post</a> describing them, and it also had some code I modified to make a Euclidean Rhythms algorithm for R. I use these rhythms all the time in modular synthesis. So, part of this post is about getting them into {midiblender}.</p>
<p>Ideally I would have a bunch of midi notes spread about in euclidean rhythms, and I could assign pitches to those notes using some kind of circle of fifths algorithm. Enter the last part of the equation, concepts from information theory.</p>
<p>Information theory provides an equation to measure the variance of a discrete probability distribution. It’s called <a href="https://en.wikipedia.org/wiki/Entropy_(information_theory)">Shannon entropy</a>, and I won’t go into the details here too much. Actually, I doubt I will use the equation for this. It’s the concept of variation in a probability distribution that I’m interested in.</p>
<p>A uniform probability distribution has no variance. All of the elements in the distribution have an equal likelihood of occurrence. I could use a uniform distribution to randomly pick notes from a collection like {Bb, F, C, G, D}, and sequences produced from that distribution would have 100% entropy. Another option is to bias the probabilities so that some of the notes are more probable than others in the set. These kinds of sequences have less entropy and are more predictable.</p>
<p>Musical sequences usually don’t look like they come from a uniform distribution, often times some notes repeat more often than others. In terms of generating sequences with {midiblender}, I’d like some control over the variance of the probability distribution that is controlling note occurrences. Ideally, I would have an entropy knob on my eurorack somewhere that did all of this.</p>
<p>Those are the basic ideas. I’m going to code some stuff and see what happens.</p>
<section id="euclidean-rhythms-in-r" class="level2">
<h2 class="anchored" data-anchor-id="euclidean-rhythms-in-r">Euclidean Rhythms in R</h2>
<p>Here’s a function that creates Euclidean rhythms in R. Again, thanks to Jeff Holtzkener for a great <a href="https://medium.com/code-music-noise/euclidean-rhythms-391d879494df">run down on this algorithm</a>. To give some more credit, Euclidean rhythms were coined by Godfried Toussaint <span class="citation" data-cites="toussaint2005">(Toussaint 2005)</span>, and his paper is available <a href="https://archive.bridgesmathart.org/2005/bridges2005-47.pdf">here</a>.</p>
<p>The basic idea for the algorithm is to find a way to spread beats evenly through a set of time steps. 4 beats goes into 16 steps very evenly, 1 beat every 4 steps. But, how does one space 5 beats into 13 steps. The algorithm finds some nice solutions that happen to also sound good as rhythms. I learned from the Holtzkener post that <a href="https://en.wikipedia.org/wiki/Bresenham%27s_line_algorithm">Bresenham’s line algorithm</a> (for raster scans), also works to compute Euclidean Rhythms, so I use that equation here.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1">bresenham_euclidean <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(beats, steps, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">start =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) {</span>
<span id="cb2-2">  previous <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> start</span>
<span id="cb2-3">  pattern <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>()</span>
<span id="cb2-4">  </span>
<span id="cb2-5">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (i <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>(steps<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">-1</span>)) {</span>
<span id="cb2-6">    xVal <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">floor</span>((beats <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> steps) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (i))</span>
<span id="cb2-7">    pattern <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(pattern, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ifelse</span>(xVal <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> previous, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))</span>
<span id="cb2-8">    previous <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> xVal</span>
<span id="cb2-9">  }</span>
<span id="cb2-10">  </span>
<span id="cb2-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(pattern)</span>
<span id="cb2-12">}</span></code></pre></div>
</details>
</div>
<p>Here’s a 4 on the floor:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bresenham_euclidean</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">beats =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">steps =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">start =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) </span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 1 0 0 0 1 0 0 0 1 0 0 0 1 0 0 0</code></pre>
</div>
</div>
<p>Here’s 7 beats over 16 steps:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bresenham_euclidean</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">beats =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">steps =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">start =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) </span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 1 0 0 1 0 1 0 1 0 0 1 0 1 0 1 0</code></pre>
</div>
</div>
<p>Great it seems to work. I’m tempted to go in a completely different direction and do some killer beats with {midiblender}, but that is too exciting. I will be back one day for the killer beats.</p>
<p>Screw it, what is this blog if not a series of digressions. I think I’ve got enough breadcrumbs to lay down a beat quickly (fingers crossed).</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>The mp3s sometimes take a bit to load, especially the longer ones.</p>
</div>
</div>
</section>
<section id="a-basic-drum-beat" class="level2">
<h2 class="anchored" data-anchor-id="a-basic-drum-beat">A basic drum beat</h2>
<p>The metric structure for the beat should be easy. I just need to figure out which midi notes are which for the drum sounds.</p>
<p>notes:</p>
<ul>
<li>channel 9 from FluidR3_GM.sf2</li>
<li>percussion map <a href="https://usermanuals.finalemusic.com/SongWriter2012Win/Content/PercussionMaps.htm" class="uri">https://usermanuals.finalemusic.com/SongWriter2012Win/Content/PercussionMaps.htm</a></li>
</ul>
<p>kick = 36 snare = 38 hihats = 42</p>
<p>Let’s do 4 bars or something like that.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(midiblender)</span>
<span id="cb7-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># import midi</span></span>
<span id="cb7-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># using mario to get the midi headers</span></span>
<span id="cb7-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># need to add a vanilla midi file to this package for easier importing</span></span>
<span id="cb7-5">mario <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">midi_to_object</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"all_overworld.mid"</span>)</span>
<span id="cb7-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list2env</span>(mario, .GlobalEnv) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># send objects to global environment</span></span>
<span id="cb7-7"></span>
<span id="cb7-8">bars <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span></span>
<span id="cb7-9">notes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">128</span></span>
<span id="cb7-10">ticks <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">96</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>bars</span>
<span id="cb7-11"></span>
<span id="cb7-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># empty beat matrix</span></span>
<span id="cb7-13">beat_matrix <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow=</span>notes,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol=</span>ticks)</span>
<span id="cb7-14"></span>
<span id="cb7-15"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#assign kick beats</span></span>
<span id="cb7-16">kick <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bresenham_euclidean</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>bars,ticks, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">start =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb7-17">snare <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bresenham_euclidean</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>bars,ticks, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">start =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb7-18">hihats <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bresenham_euclidean</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>bars,ticks, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">start =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb7-19"></span>
<span id="cb7-20"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># assign to matrix</span></span>
<span id="cb7-21">beat_matrix[(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">36</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> kick</span>
<span id="cb7-22">beat_matrix[(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">38</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> snare</span>
<span id="cb7-23">beat_matrix[(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">42</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> hihats</span>
<span id="cb7-24"></span>
<span id="cb7-25"></span>
<span id="cb7-26"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># transform back to midi</span></span>
<span id="cb7-27">track_0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">copy_midi_df_track</span>(midi_df,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">track_num =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb7-28"></span>
<span id="cb7-29">midi_time_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix_to_midi_time</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">midi_matrix =</span> beat_matrix,</span>
<span id="cb7-30">                                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">smallest_time_unit =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,</span>
<span id="cb7-31">                                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note_off_length =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>)</span>
<span id="cb7-32"></span>
<span id="cb7-33">meta_messages_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_midi_meta_df</span>(track_0)</span>
<span id="cb7-34"></span>
<span id="cb7-35">meta_messages_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set_midi_tempo_meta</span>(meta_messages_df,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">update_tempo =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">500000</span>)</span>
<span id="cb7-36"></span>
<span id="cb7-37">split_meta_messages_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">split_meta_df</span>(meta_messages_df)</span>
<span id="cb7-38"></span>
<span id="cb7-39">new_midi_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix_to_midi_track</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">midi_time_df =</span> midi_time_df,</span>
<span id="cb7-40">                                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">split_meta_list =</span> split_meta_messages_df,</span>
<span id="cb7-41">                                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">channel =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>,</span>
<span id="cb7-42">                                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">velocity =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>)</span>
<span id="cb7-43"></span>
<span id="cb7-44"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">#### bounce</span></span>
<span id="cb7-45"></span>
<span id="cb7-46"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># update miditapyr df</span></span>
<span id="cb7-47">miditapyr_object<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>midi_frame_unnested<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">update_unnested_mf</span>(new_midi_df)</span>
<span id="cb7-48"></span>
<span id="cb7-49"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#write midi file to disk</span></span>
<span id="cb7-50">miditapyr_object<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">write_file</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"beat.mid"</span>)</span>
<span id="cb7-51"></span>
<span id="cb7-52"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">#########</span></span>
<span id="cb7-53"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># bounce to mp3 with fluid synth</span></span>
<span id="cb7-54"></span>
<span id="cb7-55">track_name <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"beat"</span></span>
<span id="cb7-56"></span>
<span id="cb7-57">wav_name <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(track_name,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">".wav"</span>)</span>
<span id="cb7-58">midi_name <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(track_name,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">".mid"</span>)</span>
<span id="cb7-59">mp3_name <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(track_name,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">".mp3"</span>)</span>
<span id="cb7-60"></span>
<span id="cb7-61"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># synthesize midi file to wav with fluid synth</span></span>
<span id="cb7-62">system_command <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> glue<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">glue</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'fluidsynth -F {wav_name} ~/Library/Audio/Sounds/Banks/FluidR3_GM.sf2 {midi_name}'</span>)</span>
<span id="cb7-63"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">system</span>(system_command)</span>
<span id="cb7-64"></span>
<span id="cb7-65"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># convert wav to mp3</span></span>
<span id="cb7-66">av<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">av_audio_convert</span>(wav_name,mp3_name)</span>
<span id="cb7-67"></span>
<span id="cb7-68"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># clean up and delete wav</span></span>
<span id="cb7-69"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">file.exists</span>(wav_name)){</span>
<span id="cb7-70">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">file.remove</span>(wav_name)</span>
<span id="cb7-71">}</span></code></pre></div>
</details>
</div>
<p><audio controls=""> <source src="beat.mp3" type="audio/wav"> </audio></p>
<p>A basic rock beat.</p>
<hr>
<p>Spent some time fiddling with this to see if I can get the beats to sounds like my <a href="https://vpme.de/euclidean-circles/">euclidean circles</a> eurorack module. Whatever I was doing wasn’t working, so I’m trying some other stuff.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(midiblender)</span>
<span id="cb8-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># import midi</span></span>
<span id="cb8-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># using mario to get the midi headers</span></span>
<span id="cb8-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># need to add a vanilla midi file to this package for easier importing</span></span>
<span id="cb8-5">mario <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">midi_to_object</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"all_overworld.mid"</span>)</span>
<span id="cb8-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list2env</span>(mario, .GlobalEnv) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># send objects to global environment</span></span>
<span id="cb8-7"></span>
<span id="cb8-8">bars <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb8-9">notes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">128</span></span>
<span id="cb8-10">ticks <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">96</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>bars</span>
<span id="cb8-11"></span>
<span id="cb8-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># empty beat matrix</span></span>
<span id="cb8-13">beat_matrix <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow=</span>notes,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol=</span>ticks)</span>
<span id="cb8-14"></span>
<span id="cb8-15"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#assign kick beats</span></span>
<span id="cb8-16">kick <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bresenham_euclidean</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">start =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb8-17">snare <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bresenham_euclidean</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">start =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb8-18">hihats <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bresenham_euclidean</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">13</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">start =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb8-19"></span>
<span id="cb8-20"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># assign to matrix</span></span>
<span id="cb8-21">beat_matrix[(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">36</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,ticks,ticks<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>)] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> kick</span>
<span id="cb8-22">beat_matrix[(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">38</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,ticks,ticks<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>)] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> snare</span>
<span id="cb8-23">beat_matrix[(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">42</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,ticks,ticks<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>)] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> hihats</span>
<span id="cb8-24"></span>
<span id="cb8-25">beat_matrix <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cbind</span>(beat_matrix,</span>
<span id="cb8-26">                     beat_matrix,</span>
<span id="cb8-27">                     beat_matrix,</span>
<span id="cb8-28">                     beat_matrix)</span>
<span id="cb8-29"></span>
<span id="cb8-30"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># transform back to midi</span></span>
<span id="cb8-31">track_0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">copy_midi_df_track</span>(midi_df,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">track_num =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb8-32"></span>
<span id="cb8-33">midi_time_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix_to_midi_time</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">midi_matrix =</span> beat_matrix,</span>
<span id="cb8-34">                                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">smallest_time_unit =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,</span>
<span id="cb8-35">                                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note_off_length =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>)</span>
<span id="cb8-36"></span>
<span id="cb8-37">meta_messages_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_midi_meta_df</span>(track_0)</span>
<span id="cb8-38"></span>
<span id="cb8-39">meta_messages_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set_midi_tempo_meta</span>(meta_messages_df,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">update_tempo =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">500000</span>)</span>
<span id="cb8-40"></span>
<span id="cb8-41">split_meta_messages_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">split_meta_df</span>(meta_messages_df)</span>
<span id="cb8-42"></span>
<span id="cb8-43">new_midi_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix_to_midi_track</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">midi_time_df =</span> midi_time_df,</span>
<span id="cb8-44">                                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">split_meta_list =</span> split_meta_messages_df,</span>
<span id="cb8-45">                                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">channel =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>,</span>
<span id="cb8-46">                                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">velocity =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>)</span>
<span id="cb8-47"></span>
<span id="cb8-48"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">#### bounce</span></span>
<span id="cb8-49"></span>
<span id="cb8-50"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># update miditapyr df</span></span>
<span id="cb8-51">miditapyr_object<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>midi_frame_unnested<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">update_unnested_mf</span>(new_midi_df)</span>
<span id="cb8-52"></span>
<span id="cb8-53"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#write midi file to disk</span></span>
<span id="cb8-54">miditapyr_object<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">write_file</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"beat_2.mid"</span>)</span>
<span id="cb8-55"></span>
<span id="cb8-56"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">#########</span></span>
<span id="cb8-57"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># bounce to mp3 with fluid synth</span></span>
<span id="cb8-58"></span>
<span id="cb8-59">track_name <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"beat_2"</span></span>
<span id="cb8-60"></span>
<span id="cb8-61">wav_name <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(track_name,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">".wav"</span>)</span>
<span id="cb8-62">midi_name <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(track_name,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">".mid"</span>)</span>
<span id="cb8-63">mp3_name <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(track_name,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">".mp3"</span>)</span>
<span id="cb8-64"></span>
<span id="cb8-65"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># synthesize midi file to wav with fluid synth</span></span>
<span id="cb8-66">system_command <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> glue<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">glue</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'fluidsynth -F {wav_name} ~/Library/Audio/Sounds/Banks/FluidR3_GM.sf2 {midi_name}'</span>)</span>
<span id="cb8-67"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">system</span>(system_command)</span>
<span id="cb8-68"></span>
<span id="cb8-69"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># convert wav to mp3</span></span>
<span id="cb8-70">av<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">av_audio_convert</span>(wav_name,mp3_name)</span>
<span id="cb8-71"></span>
<span id="cb8-72"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># clean up and delete wav</span></span>
<span id="cb8-73"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">file.exists</span>(wav_name)){</span>
<span id="cb8-74">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">file.remove</span>(wav_name)</span>
<span id="cb8-75">}</span></code></pre></div>
</details>
</div>
<p><audio controls=""> <source src="beat_2.mp3" type="audio/wav"> </audio></p>
<p>Nice, a little more intrigue, thanks to the euclidean rhythms. I need to spend way more time thinking about better ways to code this. Hmmm…so tempting to do one more.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(midiblender)</span>
<span id="cb9-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># import midi</span></span>
<span id="cb9-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># using mario to get the midi headers</span></span>
<span id="cb9-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># need to add a vanilla midi file to this package for easier importing</span></span>
<span id="cb9-5">mario <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">midi_to_object</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"all_overworld.mid"</span>)</span>
<span id="cb9-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list2env</span>(mario, .GlobalEnv) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># send objects to global environment</span></span>
<span id="cb9-7"></span>
<span id="cb9-8">bars <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb9-9">notes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">128</span></span>
<span id="cb9-10">ticks <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">96</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>bars</span>
<span id="cb9-11"></span>
<span id="cb9-12">all_beat_matrix <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow=</span>notes,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">96</span>)</span>
<span id="cb9-13"></span>
<span id="cb9-14"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span>(i <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>) {</span>
<span id="cb9-15">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># empty beat matrix</span></span>
<span id="cb9-16">  beat_matrix <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow =</span> notes, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol =</span> ticks)</span>
<span id="cb9-17">  </span>
<span id="cb9-18">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#assign kick beats</span></span>
<span id="cb9-19">  kick <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bresenham_euclidean</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">start =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb9-20">  snare <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bresenham_euclidean</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">start =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb9-21">  hihats <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bresenham_euclidean</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">start =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb9-22">  </span>
<span id="cb9-23">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># assign to matrix</span></span>
<span id="cb9-24">  beat_matrix[(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">36</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, ticks, ticks <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>)] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> kick</span>
<span id="cb9-25">  beat_matrix[(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">38</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, ticks, ticks <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>)] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> snare</span>
<span id="cb9-26">  beat_matrix[(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">42</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, ticks, ticks <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>)] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> hihats</span>
<span id="cb9-27">  </span>
<span id="cb9-28">  all_beat_matrix <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cbind</span>(all_beat_matrix, beat_matrix)</span>
<span id="cb9-29">}</span>
<span id="cb9-30"></span>
<span id="cb9-31"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># transform back to midi</span></span>
<span id="cb9-32">track_0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">copy_midi_df_track</span>(midi_df,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">track_num =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb9-33"></span>
<span id="cb9-34">midi_time_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix_to_midi_time</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">midi_matrix =</span> all_beat_matrix,</span>
<span id="cb9-35">                                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">smallest_time_unit =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,</span>
<span id="cb9-36">                                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note_off_length =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>)</span>
<span id="cb9-37"></span>
<span id="cb9-38">meta_messages_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_midi_meta_df</span>(track_0)</span>
<span id="cb9-39"></span>
<span id="cb9-40">meta_messages_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set_midi_tempo_meta</span>(meta_messages_df,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">update_tempo =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">500000</span>)</span>
<span id="cb9-41"></span>
<span id="cb9-42">split_meta_messages_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">split_meta_df</span>(meta_messages_df)</span>
<span id="cb9-43"></span>
<span id="cb9-44">new_midi_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix_to_midi_track</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">midi_time_df =</span> midi_time_df,</span>
<span id="cb9-45">                                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">split_meta_list =</span> split_meta_messages_df,</span>
<span id="cb9-46">                                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">channel =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>,</span>
<span id="cb9-47">                                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">velocity =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>)</span>
<span id="cb9-48"></span>
<span id="cb9-49"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">#### bounce</span></span>
<span id="cb9-50"></span>
<span id="cb9-51"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># update miditapyr df</span></span>
<span id="cb9-52">miditapyr_object<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>midi_frame_unnested<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">update_unnested_mf</span>(new_midi_df)</span>
<span id="cb9-53"></span>
<span id="cb9-54"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#write midi file to disk</span></span>
<span id="cb9-55">miditapyr_object<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">write_file</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"beat_3.mid"</span>)</span>
<span id="cb9-56"></span>
<span id="cb9-57"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">#########</span></span>
<span id="cb9-58"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># bounce to mp3 with fluid synth</span></span>
<span id="cb9-59"></span>
<span id="cb9-60">track_name <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"beat_3"</span></span>
<span id="cb9-61"></span>
<span id="cb9-62">wav_name <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(track_name,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">".wav"</span>)</span>
<span id="cb9-63">midi_name <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(track_name,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">".mid"</span>)</span>
<span id="cb9-64">mp3_name <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(track_name,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">".mp3"</span>)</span>
<span id="cb9-65"></span>
<span id="cb9-66"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># synthesize midi file to wav with fluid synth</span></span>
<span id="cb9-67">system_command <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> glue<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">glue</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'fluidsynth -F {wav_name} ~/Library/Audio/Sounds/Banks/FluidR3_GM.sf2 {midi_name}'</span>)</span>
<span id="cb9-68"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">system</span>(system_command)</span>
<span id="cb9-69"></span>
<span id="cb9-70"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># convert wav to mp3</span></span>
<span id="cb9-71">av<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">av_audio_convert</span>(wav_name,mp3_name)</span>
<span id="cb9-72"></span>
<span id="cb9-73"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># clean up and delete wav</span></span>
<span id="cb9-74"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">file.exists</span>(wav_name)){</span>
<span id="cb9-75">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">file.remove</span>(wav_name)</span>
<span id="cb9-76">}</span></code></pre></div>
</details>
</div>
<p><audio controls=""> <source src="beat_3.mp3" type="audio/wav"> </audio></p>
<p>Cool, for this one I randomly chose the paramaters for the euclidean sources every bar. Not super groovy, but shows some of the variation you can get from euclidean rhythms. I’ll continue to mess with drums some other time.</p>
</section>
<section id="setting-notes-to-euclidean-rhythms" class="level2">
<h2 class="anchored" data-anchor-id="setting-notes-to-euclidean-rhythms">Setting notes to euclidean rhythms</h2>
<p>Before I try any of that information theory stuff, let’s see if I can set some notes to the euclidean rhythms.</p>
<p>I have a roundabout strategy to do this and a sense it will blend. I’m going to take some inspiration from <a href="https://homophony.quest/blog/37_2_5_24_matrix_analysis/#alternative-note-and-time-feature-generation">this code</a>, that I used to generate new sequences from separate vectors for note probability and time probability.</p>
<ol type="1">
<li>Use euclidean rhythms to generate a bunch of possible time stamps, that should have some mildly OK rhythm.</li>
<li>Get the point estimates for time steps to probabilistically generate rhythm later.</li>
<li>Make a vector of note probabilities</li>
<li>Put them together and listen to it.</li>
</ol>
<p>notes:</p>
<ul>
<li>realizing I don’t have a favorite way of picking individual notes</li>
</ul>
<hr>
<p>test for one track 8 bars.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(midiblender)</span>
<span id="cb10-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(dplyr)</span>
<span id="cb10-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tibble)</span>
<span id="cb10-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># import midi</span></span>
<span id="cb10-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># using mario to get the midi headers</span></span>
<span id="cb10-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># need to add a vanilla midi file to this package for easier importing</span></span>
<span id="cb10-7">mario <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">midi_to_object</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"all_overworld.mid"</span>)</span>
<span id="cb10-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list2env</span>(mario, .GlobalEnv) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># send objects to global environment</span></span>
<span id="cb10-9"></span>
<span id="cb10-10"></span>
<span id="cb10-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Sample some beats for timesteps into the matrix</span></span>
<span id="cb10-12">bars <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb10-13">notes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">128</span></span>
<span id="cb10-14">ticks <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">96</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>bars</span>
<span id="cb10-15"></span>
<span id="cb10-16">all_beat_matrix <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow=</span>notes,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">96</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>)</span>
<span id="cb10-17"></span>
<span id="cb10-18"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span>(i <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>) {</span>
<span id="cb10-19">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># empty beat matrix</span></span>
<span id="cb10-20">  beat_matrix <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow =</span> notes, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol =</span> ticks)</span>
<span id="cb10-21">  </span>
<span id="cb10-22">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#assign kick beats</span></span>
<span id="cb10-23">  kick <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bresenham_euclidean</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">start =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb10-24">  snare <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bresenham_euclidean</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">start =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb10-25">  hihats <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bresenham_euclidean</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">start =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb10-26">  </span>
<span id="cb10-27">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># assign to matrix</span></span>
<span id="cb10-28">  beat_matrix[(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">36</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, ticks, ticks <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>)] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> kick</span>
<span id="cb10-29">  beat_matrix[(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">38</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, ticks, ticks <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>)] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> snare</span>
<span id="cb10-30">  beat_matrix[(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">42</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, ticks, ticks <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>)] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> hihats</span>
<span id="cb10-31">  </span>
<span id="cb10-32">  all_beat_matrix <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cbind</span>(all_beat_matrix, beat_matrix)</span>
<span id="cb10-33">}</span>
<span id="cb10-34"></span>
<span id="cb10-35"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># get the point estimates</span></span>
<span id="cb10-36">time_probabilities <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colSums</span>(all_beat_matrix)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(all_beat_matrix)</span>
<span id="cb10-37"></span>
<span id="cb10-38">bar_probabilities <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix</span>(time_probabilities,</span>
<span id="cb10-39">                            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">96</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>),</span>
<span id="cb10-40">                            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">byrow =</span> T)</span>
<span id="cb10-41"></span>
<span id="cb10-42">bar_probabilities <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colMeans</span>(bar_probabilities)</span>
<span id="cb10-43"></span>
<span id="cb10-44"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># make my own midi notes df</span></span>
<span id="cb10-45"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># add this to midiblender later</span></span>
<span id="cb10-46">midi_notes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> pyramidi<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span>midi_defs <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb10-47">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rowwise</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb10-48">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note_letter =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unlist</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">strsplit</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.character</span>(note_name),<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"-"</span>))[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>],</span>
<span id="cb10-49">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">octave =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unlist</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">strsplit</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.character</span>(note_name),<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"-"</span>))[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>])</span>
<span id="cb10-50"></span>
<span id="cb10-51">midi_notes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">notes =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(midi_notes[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>,]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>note_letter,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span>)[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">128</span>],</span>
<span id="cb10-52">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">octaves =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">each =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>)[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">128</span>],</span>
<span id="cb10-53">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">midi_number =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">127</span></span>
<span id="cb10-54">)</span>
<span id="cb10-55"></span>
<span id="cb10-56">song <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow=</span>notes,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">96</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>)</span>
<span id="cb10-57"></span>
<span id="cb10-58"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># begin bar by bar composition loop</span></span>
<span id="cb10-59"></span>
<span id="cb10-60"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span>(i <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>){</span>
<span id="cb10-61"></span>
<span id="cb10-62">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># get some notes to sample from fifths around a starting note</span></span>
<span id="cb10-63">  starting_note <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">60</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># C4</span></span>
<span id="cb10-64">  fifth_intervals <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span>, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span>)</span>
<span id="cb10-65">  notes_to_choose <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> starting_note <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> fifth_intervals</span>
<span id="cb10-66">  octave_range <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span></span>
<span id="cb10-67">  </span>
<span id="cb10-68">  note_names <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> midi_notes <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb10-69">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(midi_number <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> notes_to_choose) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb10-70">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pull</span>(notes)</span>
<span id="cb10-71">  </span>
<span id="cb10-72">  possible_notes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> midi_notes <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb10-73">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(notes <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> note_names <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>,</span>
<span id="cb10-74">           octaves <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> octave_range <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb10-75">  </span>
<span id="cb10-76">  possible_notes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> possible_notes <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb10-77">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">probs =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dim</span>(possible_notes)[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>])</span>
<span id="cb10-78">  </span>
<span id="cb10-79">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># create probability vector</span></span>
<span id="cb10-80">  pitch_probabilities <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">128</span>)</span>
<span id="cb10-81">  pitch_probabilities[possible_notes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>midi_number <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span></span>
<span id="cb10-82">    possible_notes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>probs</span>
<span id="cb10-83">  </span>
<span id="cb10-84">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># get new pitches</span></span>
<span id="cb10-85">  new_pitches <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbinom</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(pitch_probabilities),</span>
<span id="cb10-86">                        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">32</span>,</span>
<span id="cb10-87">                        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">prob =</span> pitch_probabilities)</span>
<span id="cb10-88">  new_pitches[new_pitches <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb10-89">  </span>
<span id="cb10-90">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># get new times</span></span>
<span id="cb10-91">  new_times <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbinom</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(bar_probabilities),</span>
<span id="cb10-92">                      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">256</span>,</span>
<span id="cb10-93">                      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">prob =</span> bar_probabilities)</span>
<span id="cb10-94">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># To Do: come back here and make it ok to have more than 1</span></span>
<span id="cb10-95">  new_times[new_times <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb10-96">  </span>
<span id="cb10-97">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># get row column ids</span></span>
<span id="cb10-98">  sampled_notes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">which</span>(new_pitches <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb10-99">  sampled_times <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">which</span>(new_times <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb10-100">  </span>
<span id="cb10-101">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># combine, make sure equal length</span></span>
<span id="cb10-102">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> (<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(sampled_notes) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(sampled_times)) {</span>
<span id="cb10-103">    sampled_ids <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span></span>
<span id="cb10-104">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">notes =</span> sampled_notes[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(sampled_times)],</span>
<span id="cb10-105">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times =</span> sampled_times)</span>
<span id="cb10-106">  } <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span> {</span>
<span id="cb10-107">    sampled_ids <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">notes =</span> sampled_notes,</span>
<span id="cb10-108">                          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times =</span> sampled_times[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(sampled_notes)])</span>
<span id="cb10-109">  }</span>
<span id="cb10-110">  </span>
<span id="cb10-111">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># shuffle the notes across the times so the sampling is uniform</span></span>
<span id="cb10-112">  sampled_ids<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>notes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(sampled_ids<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>notes)</span>
<span id="cb10-113">  </span>
<span id="cb10-114">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># make a note by time unit matrix</span></span>
<span id="cb10-115">  one_bar <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb10-116">                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">128</span>,</span>
<span id="cb10-117">                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">96</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>)</span>
<span id="cb10-118">  </span>
<span id="cb10-119">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># assign 1s to note locations in time</span></span>
<span id="cb10-120">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (i <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dim</span>(sampled_ids)[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]) {</span>
<span id="cb10-121">    one_bar[sampled_ids<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>notes[i], sampled_ids<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>times[i]] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb10-122">  }</span>
<span id="cb10-123">  </span>
<span id="cb10-124">  song <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cbind</span>(song,one_bar)</span>
<span id="cb10-125">}</span>
<span id="cb10-126"></span>
<span id="cb10-127"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">#####################</span></span>
<span id="cb10-128"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># transform back to midi</span></span>
<span id="cb10-129">track_0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">copy_midi_df_track</span>(midi_df,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">track_num =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb10-130"></span>
<span id="cb10-131">midi_time_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix_to_midi_time</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">midi_matrix =</span> song,</span>
<span id="cb10-132">                                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">smallest_time_unit =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>,</span>
<span id="cb10-133">                                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note_off_length =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">32</span>)</span>
<span id="cb10-134"></span>
<span id="cb10-135">meta_messages_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_midi_meta_df</span>(track_0)</span>
<span id="cb10-136"></span>
<span id="cb10-137">meta_messages_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set_midi_tempo_meta</span>(meta_messages_df,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">update_tempo =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">500000</span>)</span>
<span id="cb10-138"></span>
<span id="cb10-139">split_meta_messages_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">split_meta_df</span>(meta_messages_df)</span>
<span id="cb10-140"></span>
<span id="cb10-141">new_midi_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix_to_midi_track</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">midi_time_df =</span> midi_time_df,</span>
<span id="cb10-142">                                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">split_meta_list =</span> split_meta_messages_df,</span>
<span id="cb10-143">                                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">channel =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb10-144">                                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">velocity =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>)</span>
<span id="cb10-145"></span>
<span id="cb10-146"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">#### bounce</span></span>
<span id="cb10-147"></span>
<span id="cb10-148"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># update miditapyr df</span></span>
<span id="cb10-149">miditapyr_object<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>midi_frame_unnested<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">update_unnested_mf</span>(new_midi_df)</span>
<span id="cb10-150"></span>
<span id="cb10-151"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#write midi file to disk</span></span>
<span id="cb10-152">miditapyr_object<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">write_file</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fifths.mid"</span>)</span>
<span id="cb10-153"></span>
<span id="cb10-154"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">#########</span></span>
<span id="cb10-155"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># bounce to mp3 with fluid synth</span></span>
<span id="cb10-156"></span>
<span id="cb10-157">track_name <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fifths"</span></span>
<span id="cb10-158"></span>
<span id="cb10-159">wav_name <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(track_name,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">".wav"</span>)</span>
<span id="cb10-160">midi_name <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(track_name,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">".mid"</span>)</span>
<span id="cb10-161">mp3_name <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(track_name,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">".mp3"</span>)</span>
<span id="cb10-162"></span>
<span id="cb10-163"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># synthesize midi file to wav with fluid synth</span></span>
<span id="cb10-164">system_command <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> glue<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">glue</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'fluidsynth -F {wav_name} ~/Library/Audio/Sounds/Banks/FluidR3_GM.sf2 {midi_name}'</span>)</span>
<span id="cb10-165"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">system</span>(system_command)</span>
<span id="cb10-166"></span>
<span id="cb10-167"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># convert wav to mp3</span></span>
<span id="cb10-168">av<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">av_audio_convert</span>(wav_name,mp3_name)</span>
<span id="cb10-169"></span>
<span id="cb10-170"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># clean up and delete wav</span></span>
<span id="cb10-171"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">file.exists</span>(wav_name)){</span>
<span id="cb10-172">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">file.remove</span>(wav_name)</span>
<span id="cb10-173">}</span></code></pre></div>
</details>
</div>
<p>That worked, but it’s sounds like piano popcorn. Not worth sharing.</p>
<hr>
<p>I’ve increased number of loops here for multiple tracks. Each track has different note densities. The results are almost listenable, even more so if I put the midi tracks into ableton and give them some more interesting synth voices.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(midiblender)</span>
<span id="cb11-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(dplyr)</span>
<span id="cb11-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tibble)</span>
<span id="cb11-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># import midi</span></span>
<span id="cb11-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># using mario to get the midi headers</span></span>
<span id="cb11-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># need to add a vanilla midi file to this package for easier importing</span></span>
<span id="cb11-7">mario <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">midi_to_object</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"all_overworld.mid"</span>)</span>
<span id="cb11-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list2env</span>(mario, .GlobalEnv) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># send objects to global environment</span></span>
<span id="cb11-9"></span>
<span id="cb11-10"></span>
<span id="cb11-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Sample some beats for timesteps into the matrix</span></span>
<span id="cb11-12">bars <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb11-13">notes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">128</span></span>
<span id="cb11-14">ticks <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">96</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>bars</span>
<span id="cb11-15"></span>
<span id="cb11-16">all_beat_matrix <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow=</span>notes,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">96</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>)</span>
<span id="cb11-17"></span>
<span id="cb11-18"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span>(i <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>) {</span>
<span id="cb11-19">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># empty beat matrix</span></span>
<span id="cb11-20">  beat_matrix <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow =</span> notes, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol =</span> ticks)</span>
<span id="cb11-21">  </span>
<span id="cb11-22">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#assign kick beats</span></span>
<span id="cb11-23">  kick <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bresenham_euclidean</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">start =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb11-24">  snare <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bresenham_euclidean</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">start =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb11-25">  hihats <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bresenham_euclidean</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">start =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb11-26">  </span>
<span id="cb11-27">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># assign to matrix</span></span>
<span id="cb11-28">  beat_matrix[(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">36</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, ticks, ticks <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>)] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> kick</span>
<span id="cb11-29">  beat_matrix[(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">38</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, ticks, ticks <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>)] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> snare</span>
<span id="cb11-30">  beat_matrix[(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">42</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, ticks, ticks <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>)] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> hihats</span>
<span id="cb11-31">  </span>
<span id="cb11-32">  all_beat_matrix <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cbind</span>(all_beat_matrix, beat_matrix)</span>
<span id="cb11-33">}</span>
<span id="cb11-34"></span>
<span id="cb11-35"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># get the point estimates</span></span>
<span id="cb11-36">time_probabilities <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colSums</span>(all_beat_matrix)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(all_beat_matrix)</span>
<span id="cb11-37"></span>
<span id="cb11-38">bar_probabilities <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix</span>(time_probabilities,</span>
<span id="cb11-39">                            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">96</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>),</span>
<span id="cb11-40">                            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">byrow =</span> T)</span>
<span id="cb11-41"></span>
<span id="cb11-42">bar_probabilities <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colMeans</span>(bar_probabilities)</span>
<span id="cb11-43"></span>
<span id="cb11-44"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># make my own midi notes df</span></span>
<span id="cb11-45"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># add this to midiblender later</span></span>
<span id="cb11-46">midi_notes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> pyramidi<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span>midi_defs <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb11-47">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rowwise</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb11-48">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note_letter =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unlist</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">strsplit</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.character</span>(note_name),<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"-"</span>))[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>],</span>
<span id="cb11-49">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">octave =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unlist</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">strsplit</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.character</span>(note_name),<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"-"</span>))[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>])</span>
<span id="cb11-50"></span>
<span id="cb11-51">midi_notes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">notes =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(midi_notes[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>,]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>note_letter,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span>)[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">128</span>],</span>
<span id="cb11-52">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">octaves =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">each =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>)[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">128</span>],</span>
<span id="cb11-53">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">midi_number =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">127</span></span>
<span id="cb11-54">)</span>
<span id="cb11-55"></span>
<span id="cb11-56">all_track_midi <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>()</span>
<span id="cb11-57"></span>
<span id="cb11-58">time_densities <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">256</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">128</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">64</span>)</span>
<span id="cb11-59"></span>
<span id="cb11-60"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># track loop</span></span>
<span id="cb11-61"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span>(t <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>){</span>
<span id="cb11-62"></span>
<span id="cb11-63">song <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow=</span>notes,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb11-64"></span>
<span id="cb11-65"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># begin bar by bar composition loop</span></span>
<span id="cb11-66"></span>
<span id="cb11-67"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span>(i <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>){</span>
<span id="cb11-68"></span>
<span id="cb11-69">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># get some notes to sample from fifths around a starting note</span></span>
<span id="cb11-70">  starting_note <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">60</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># C4</span></span>
<span id="cb11-71">  fifth_intervals <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span>, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span>)</span>
<span id="cb11-72">  notes_to_choose <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> starting_note <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> fifth_intervals</span>
<span id="cb11-73">  octave_range <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span></span>
<span id="cb11-74">  </span>
<span id="cb11-75">  note_names <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> midi_notes <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb11-76">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(midi_number <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> notes_to_choose) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb11-77">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pull</span>(notes)</span>
<span id="cb11-78">  </span>
<span id="cb11-79">  possible_notes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> midi_notes <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb11-80">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(notes <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> note_names <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>,</span>
<span id="cb11-81">           octaves <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> octave_range <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb11-82">  </span>
<span id="cb11-83">  possible_notes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> possible_notes <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb11-84">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">probs =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dim</span>(possible_notes)[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>])</span>
<span id="cb11-85">  </span>
<span id="cb11-86">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># create probability vector</span></span>
<span id="cb11-87">  pitch_probabilities <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">128</span>)</span>
<span id="cb11-88">  pitch_probabilities[possible_notes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>midi_number <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span></span>
<span id="cb11-89">    possible_notes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>probs</span>
<span id="cb11-90">  </span>
<span id="cb11-91">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># get new pitches</span></span>
<span id="cb11-92">  new_pitches <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbinom</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(pitch_probabilities),</span>
<span id="cb11-93">                        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">32</span>,</span>
<span id="cb11-94">                        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">prob =</span> pitch_probabilities)</span>
<span id="cb11-95">  new_pitches[new_pitches <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb11-96">  </span>
<span id="cb11-97">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># get new times</span></span>
<span id="cb11-98">  new_times <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbinom</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(bar_probabilities),</span>
<span id="cb11-99">                      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> time_densities[t],</span>
<span id="cb11-100">                      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">prob =</span> bar_probabilities)</span>
<span id="cb11-101">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># To Do: come back here and make it ok to have more than 1</span></span>
<span id="cb11-102">  new_times[new_times <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb11-103">  </span>
<span id="cb11-104">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># get row column ids</span></span>
<span id="cb11-105">  sampled_notes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">which</span>(new_pitches <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb11-106">  sampled_times <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">which</span>(new_times <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb11-107">  </span>
<span id="cb11-108">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># combine, make sure equal length</span></span>
<span id="cb11-109">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> (<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(sampled_notes) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(sampled_times)) {</span>
<span id="cb11-110">    sampled_ids <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span></span>
<span id="cb11-111">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">notes =</span> sampled_notes[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(sampled_times)],</span>
<span id="cb11-112">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times =</span> sampled_times)</span>
<span id="cb11-113">  } <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span> {</span>
<span id="cb11-114">    sampled_ids <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">notes =</span> sampled_notes,</span>
<span id="cb11-115">                          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times =</span> sampled_times[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(sampled_notes)])</span>
<span id="cb11-116">  }</span>
<span id="cb11-117">  </span>
<span id="cb11-118">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># shuffle the notes across the times so the sampling is uniform</span></span>
<span id="cb11-119">  sampled_ids<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>notes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(sampled_ids<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>notes)</span>
<span id="cb11-120">  </span>
<span id="cb11-121">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># make a note by time unit matrix</span></span>
<span id="cb11-122">  one_bar <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb11-123">                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">128</span>,</span>
<span id="cb11-124">                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">96</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>)</span>
<span id="cb11-125">  </span>
<span id="cb11-126">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># assign 1s to note locations in time</span></span>
<span id="cb11-127">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (r <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dim</span>(sampled_ids)[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]) {</span>
<span id="cb11-128">    one_bar[sampled_ids<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>notes[r], sampled_ids<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>times[r]] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb11-129">  }</span>
<span id="cb11-130">  </span>
<span id="cb11-131">  song <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cbind</span>(song,one_bar)</span>
<span id="cb11-132">}</span>
<span id="cb11-133"></span>
<span id="cb11-134"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">#####################</span></span>
<span id="cb11-135"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># transform back to midi</span></span>
<span id="cb11-136">track_0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">copy_midi_df_track</span>(midi_df,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">track_num =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb11-137"></span>
<span id="cb11-138">midi_time_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix_to_midi_time</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">midi_matrix =</span> song,</span>
<span id="cb11-139">                                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">smallest_time_unit =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,</span>
<span id="cb11-140">                                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note_off_length =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">32</span>)</span>
<span id="cb11-141"></span>
<span id="cb11-142">meta_messages_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_midi_meta_df</span>(track_0)</span>
<span id="cb11-143"></span>
<span id="cb11-144">meta_messages_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set_midi_tempo_meta</span>(meta_messages_df,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">update_tempo =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">500000</span>)</span>
<span id="cb11-145"></span>
<span id="cb11-146">split_meta_messages_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">split_meta_df</span>(meta_messages_df)</span>
<span id="cb11-147"></span>
<span id="cb11-148">new_midi_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix_to_midi_track</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">midi_time_df =</span> midi_time_df,</span>
<span id="cb11-149">                                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">split_meta_list =</span> split_meta_messages_df,</span>
<span id="cb11-150">                                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">channel =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb11-151">                                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">velocity =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>)</span>
<span id="cb11-152">new_midi_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> new_midi_df <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb11-153">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">i_track =</span> t)</span>
<span id="cb11-154"></span>
<span id="cb11-155">all_track_midi <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbind</span>(all_track_midi,</span>
<span id="cb11-156">                        new_midi_df)</span>
<span id="cb11-157">}</span>
<span id="cb11-158"></span>
<span id="cb11-159"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">#### bounce</span></span>
<span id="cb11-160"></span>
<span id="cb11-161"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># update miditapyr df</span></span>
<span id="cb11-162">miditapyr_object<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>midi_frame_unnested<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">update_unnested_mf</span>(all_track_midi)</span>
<span id="cb11-163"></span>
<span id="cb11-164"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#write midi file to disk</span></span>
<span id="cb11-165">miditapyr_object<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">write_file</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fifths_tracks.mid"</span>)</span>
<span id="cb11-166"></span>
<span id="cb11-167"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">#########</span></span>
<span id="cb11-168"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># bounce to mp3 with fluid synth</span></span>
<span id="cb11-169"></span>
<span id="cb11-170">track_name <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fifths"</span></span>
<span id="cb11-171"></span>
<span id="cb11-172">wav_name <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(track_name,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">".wav"</span>)</span>
<span id="cb11-173">midi_name <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(track_name,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">".mid"</span>)</span>
<span id="cb11-174">mp3_name <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(track_name,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">".mp3"</span>)</span>
<span id="cb11-175"></span>
<span id="cb11-176"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># synthesize midi file to wav with fluid synth</span></span>
<span id="cb11-177">system_command <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> glue<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">glue</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'fluidsynth -F {wav_name} ~/Library/Audio/Sounds/Banks/FluidR3_GM.sf2 {midi_name}'</span>)</span>
<span id="cb11-178"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">system</span>(system_command)</span>
<span id="cb11-179"></span>
<span id="cb11-180"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># convert wav to mp3</span></span>
<span id="cb11-181">av<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">av_audio_convert</span>(wav_name,mp3_name)</span>
<span id="cb11-182"></span>
<span id="cb11-183"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># clean up and delete wav</span></span>
<span id="cb11-184"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">file.exists</span>(wav_name)){</span>
<span id="cb11-185">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">file.remove</span>(wav_name)</span>
<span id="cb11-186">}</span></code></pre></div>
</details>
</div>
<p>This was fun, even if my eyes are bleeding from the wall of code. I put the three tracks generated here into Ableton, assigned them some synth voices, added a couple drum beats, slowed down the tempo, and it sounds like this:</p>
<p><strong>This one is louder than the others, not super loud, but louder</strong></p>
<p><audio controls=""> <source src="fifths_3_track.mp3" type="audio/wav"> </audio></p>
<p>I didn’t get to all of my goals. I still need to come back and change the probability of different notes so they aren’t uniform. Right now all the pitches were uniformly sampled each time. The result is OK, but I want to hear other versions sampled from non-uniform distributions.</p>
<p>At this point I think I’ve basically recreated something like what Marbles by Mutable Instruments is doing. I could have probably done this in eurorack. And, that would have been fun too.</p>
<p>Time to take a break.</p>
<section id="pseudo-composition-code" class="level3">
<h3 class="anchored" data-anchor-id="pseudo-composition-code">Pseudo Composition code</h3>
<p>The above is what I would consider my first attempt at composing generative sequences in R. Taking a couple minutes here to write pseudo code on what it was that happened in the code.</p>
<ol type="1">
<li>Import a MIDI file</li>
<li>Run euclidean rhythms into a matrix for a while to get point estimates for rhythm time steps. Turn this into a vector of time probabilities.</li>
<li>Begin a Track Composition loop</li>
</ol>
<ul>
<li>Loop for each of 3 tracks
<ul>
<li>Begin a Bar composition Loop
<ul>
<li>Loop for 16 bars</li>
<li>pick a collection of notes</li>
<li>assign probability of occurrence</li>
<li>generate time stamps, and notes from time and note probability vectors</li>
<li>Combine them together</li>
<li>put them in a one_bar matrix</li>
</ul></li>
<li>put all the bars into a midi_df, setting i_track to the track number</li>
</ul></li>
</ul>
<p>It was helpful to summarize the code this morning. It’s unlikely I will begin any re-factoring, but it’s easier to see where I could make this more compact and less of a wall of code.</p>
<hr>
</section>
</section>
<section id="randomly-sampling-note-probability-distributions" class="level2">
<h2 class="anchored" data-anchor-id="randomly-sampling-note-probability-distributions">Randomly sampling note probability distributions</h2>
<p>The above code samples notes from some collection, like {C, F, G, Bb, D} with equal proportion. I’d like to at least start with making the proportions unequal, and have this move around a bit over bars. Whatever note has the highest proportion might take on the tonal center of the evolving sequence.</p>
<p>A next step would be to expand and contract the note collection, and have it rotate around the circle of fifths.</p>
<p>This seems to work. I’m grabbing a colleciton of notes, using a simple vector, like 1,2,3,4,5, to set note frequencies. That can be multiplied to change the ratio of most to least frequent. The frequency vector is converted to a probability vector later. Every bar, the ordering of the probalities as they apply to notes is randomized. That could be too fast moving to really notice differences. Need to explore this a little bit.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(midiblender)</span>
<span id="cb12-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(dplyr)</span>
<span id="cb12-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tibble)</span>
<span id="cb12-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># import midi</span></span>
<span id="cb12-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># using mario to get the midi headers</span></span>
<span id="cb12-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># need to add a vanilla midi file to this package for easier importing</span></span>
<span id="cb12-7">mario <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">midi_to_object</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"all_overworld.mid"</span>)</span>
<span id="cb12-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list2env</span>(mario, .GlobalEnv) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># send objects to global environment</span></span>
<span id="cb12-9"></span>
<span id="cb12-10"></span>
<span id="cb12-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Sample some beats for timesteps into the matrix</span></span>
<span id="cb12-12">bars <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb12-13">notes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">128</span></span>
<span id="cb12-14">ticks <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">96</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>bars</span>
<span id="cb12-15"></span>
<span id="cb12-16">all_beat_matrix <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow=</span>notes,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">96</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>)</span>
<span id="cb12-17"></span>
<span id="cb12-18"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span>(i <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>) {</span>
<span id="cb12-19">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># empty beat matrix</span></span>
<span id="cb12-20">  beat_matrix <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow =</span> notes, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol =</span> ticks)</span>
<span id="cb12-21">  </span>
<span id="cb12-22">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#assign kick beats</span></span>
<span id="cb12-23">  kick <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bresenham_euclidean</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">start =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb12-24">  snare <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bresenham_euclidean</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">start =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb12-25">  hihats <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bresenham_euclidean</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">start =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb12-26">  </span>
<span id="cb12-27">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># assign to matrix</span></span>
<span id="cb12-28">  beat_matrix[(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">36</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, ticks, ticks <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>)] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> kick</span>
<span id="cb12-29">  beat_matrix[(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">38</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, ticks, ticks <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>)] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> snare</span>
<span id="cb12-30">  beat_matrix[(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">42</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, ticks, ticks <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>)] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> hihats</span>
<span id="cb12-31">  </span>
<span id="cb12-32">  all_beat_matrix <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cbind</span>(all_beat_matrix, beat_matrix)</span>
<span id="cb12-33">}</span>
<span id="cb12-34"></span>
<span id="cb12-35"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># get the point estimates</span></span>
<span id="cb12-36">time_probabilities <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colSums</span>(all_beat_matrix)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(all_beat_matrix)</span>
<span id="cb12-37"></span>
<span id="cb12-38">bar_probabilities <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix</span>(time_probabilities,</span>
<span id="cb12-39">                            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">96</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>),</span>
<span id="cb12-40">                            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">byrow =</span> T)</span>
<span id="cb12-41"></span>
<span id="cb12-42">bar_probabilities <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colMeans</span>(bar_probabilities)</span>
<span id="cb12-43"></span>
<span id="cb12-44"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># make my own midi notes df</span></span>
<span id="cb12-45"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># add this to midiblender later</span></span>
<span id="cb12-46">midi_notes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> pyramidi<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span>midi_defs <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb12-47">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rowwise</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb12-48">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note_letter =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unlist</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">strsplit</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.character</span>(note_name),<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"-"</span>))[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>],</span>
<span id="cb12-49">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">octave =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unlist</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">strsplit</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.character</span>(note_name),<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"-"</span>))[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>])</span>
<span id="cb12-50"></span>
<span id="cb12-51">midi_notes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">notes =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(midi_notes[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>,]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>note_letter,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span>)[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">128</span>],</span>
<span id="cb12-52">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">octaves =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">each =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>)[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">128</span>],</span>
<span id="cb12-53">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">midi_number =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">127</span></span>
<span id="cb12-54">)</span>
<span id="cb12-55"></span>
<span id="cb12-56"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Empty data frame to hold midi track dfs</span></span>
<span id="cb12-57">all_track_midi <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>()</span>
<span id="cb12-58"></span>
<span id="cb12-59"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># paramaters that get changed for every track</span></span>
<span id="cb12-60"></span>
<span id="cb12-61">time_densities <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">256</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">128</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">64</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># controls number of notes per bar </span></span>
<span id="cb12-62"></span>
<span id="cb12-63"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># track loop</span></span>
<span id="cb12-64"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span>(t <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>){</span>
<span id="cb12-65"></span>
<span id="cb12-66">song <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow=</span>notes,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb12-67"></span>
<span id="cb12-68"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># begin bar by bar composition loop</span></span>
<span id="cb12-69"></span>
<span id="cb12-70"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span>(i <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>){</span>
<span id="cb12-71"></span>
<span id="cb12-72">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># get some notes to sample from fifths around a starting note</span></span>
<span id="cb12-73">  starting_note <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">60</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># C4</span></span>
<span id="cb12-74">  fifth_intervals <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span>, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span>)</span>
<span id="cb12-75">  notes_to_choose <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> starting_note <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> fifth_intervals</span>
<span id="cb12-76">  octave_range <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span></span>
<span id="cb12-77">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># starting to bias note sampling here</span></span>
<span id="cb12-78">  note_frequencies <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(fifth_intervals)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) </span>
<span id="cb12-79">  </span>
<span id="cb12-80">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># pair the frequencies with the notes</span></span>
<span id="cb12-81">  note_names <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> midi_notes <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb12-82">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(midi_number <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> notes_to_choose) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb12-83">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(notes) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb12-84">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note_frequencies =</span> note_frequencies)</span>
<span id="cb12-85">  </span>
<span id="cb12-86">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># get all possible notes across octaves in collection</span></span>
<span id="cb12-87">  possible_notes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> midi_notes <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb12-88">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(notes <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> note_names<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>notes <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>,</span>
<span id="cb12-89">           octaves <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> octave_range <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb12-90">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># add note frequencies</span></span>
<span id="cb12-91">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">left_join</span>(note_names,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"notes"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb12-92">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">probs =</span> note_frequencies<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(note_frequencies))</span>
<span id="cb12-93">  </span>
<span id="cb12-94">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># create probability vector</span></span>
<span id="cb12-95">  pitch_probabilities <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">128</span>)</span>
<span id="cb12-96">  pitch_probabilities[possible_notes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>midi_number <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span></span>
<span id="cb12-97">    possible_notes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>probs</span>
<span id="cb12-98">  </span>
<span id="cb12-99">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># get new pitches</span></span>
<span id="cb12-100">  new_pitches <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbinom</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(pitch_probabilities),</span>
<span id="cb12-101">                        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">32</span>,</span>
<span id="cb12-102">                        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">prob =</span> pitch_probabilities)</span>
<span id="cb12-103">  new_pitches[new_pitches <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb12-104">  </span>
<span id="cb12-105">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># get new times</span></span>
<span id="cb12-106">  new_times <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbinom</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(bar_probabilities),</span>
<span id="cb12-107">                      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> time_densities[t],</span>
<span id="cb12-108">                      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">prob =</span> bar_probabilities)</span>
<span id="cb12-109">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># To Do: come back here and make it ok to have more than 1</span></span>
<span id="cb12-110">  new_times[new_times <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb12-111">  </span>
<span id="cb12-112">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># get row column ids</span></span>
<span id="cb12-113">  sampled_notes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">which</span>(new_pitches <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb12-114">  sampled_times <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">which</span>(new_times <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb12-115">  </span>
<span id="cb12-116">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># combine, make sure equal length</span></span>
<span id="cb12-117">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> (<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(sampled_notes) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(sampled_times)) {</span>
<span id="cb12-118">    sampled_ids <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span></span>
<span id="cb12-119">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">notes =</span> sampled_notes[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(sampled_times)],</span>
<span id="cb12-120">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times =</span> sampled_times)</span>
<span id="cb12-121">  } <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span> {</span>
<span id="cb12-122">    sampled_ids <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">notes =</span> sampled_notes,</span>
<span id="cb12-123">                          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times =</span> sampled_times[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(sampled_notes)])</span>
<span id="cb12-124">  }</span>
<span id="cb12-125">  </span>
<span id="cb12-126">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># shuffle the notes across the times so the sampling is uniform</span></span>
<span id="cb12-127">  sampled_ids<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>notes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(sampled_ids<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>notes)</span>
<span id="cb12-128">  </span>
<span id="cb12-129">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># make a note by time unit matrix</span></span>
<span id="cb12-130">  one_bar <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb12-131">                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">128</span>,</span>
<span id="cb12-132">                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">96</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>)</span>
<span id="cb12-133">  </span>
<span id="cb12-134">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># assign 1s to note locations in time</span></span>
<span id="cb12-135">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (r <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dim</span>(sampled_ids)[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]) {</span>
<span id="cb12-136">    one_bar[sampled_ids<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>notes[r], sampled_ids<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>times[r]] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb12-137">  }</span>
<span id="cb12-138">  </span>
<span id="cb12-139">  song <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cbind</span>(song,one_bar)</span>
<span id="cb12-140">}</span>
<span id="cb12-141"></span>
<span id="cb12-142"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">#####################</span></span>
<span id="cb12-143"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># transform back to midi</span></span>
<span id="cb12-144">track_0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">copy_midi_df_track</span>(midi_df,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">track_num =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb12-145"></span>
<span id="cb12-146">midi_time_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix_to_midi_time</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">midi_matrix =</span> song,</span>
<span id="cb12-147">                                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">smallest_time_unit =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,</span>
<span id="cb12-148">                                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note_off_length =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">32</span>)</span>
<span id="cb12-149"></span>
<span id="cb12-150">meta_messages_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_midi_meta_df</span>(track_0)</span>
<span id="cb12-151"></span>
<span id="cb12-152">meta_messages_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set_midi_tempo_meta</span>(meta_messages_df,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">update_tempo =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">500000</span>)</span>
<span id="cb12-153"></span>
<span id="cb12-154">split_meta_messages_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">split_meta_df</span>(meta_messages_df)</span>
<span id="cb12-155"></span>
<span id="cb12-156">new_midi_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix_to_midi_track</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">midi_time_df =</span> midi_time_df,</span>
<span id="cb12-157">                                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">split_meta_list =</span> split_meta_messages_df,</span>
<span id="cb12-158">                                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">channel =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb12-159">                                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">velocity =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>)</span>
<span id="cb12-160">new_midi_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> new_midi_df <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb12-161">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">i_track =</span> t)</span>
<span id="cb12-162"></span>
<span id="cb12-163">all_track_midi <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbind</span>(all_track_midi,</span>
<span id="cb12-164">                        new_midi_df)</span>
<span id="cb12-165">}</span>
<span id="cb12-166"></span>
<span id="cb12-167"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">#### bounce</span></span>
<span id="cb12-168"></span>
<span id="cb12-169"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># update miditapyr df</span></span>
<span id="cb12-170">miditapyr_object<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>midi_frame_unnested<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">update_unnested_mf</span>(all_track_midi)</span>
<span id="cb12-171"></span>
<span id="cb12-172"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#write midi file to disk</span></span>
<span id="cb12-173">miditapyr_object<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">write_file</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fifths_tracks_prob.mid"</span>)</span>
<span id="cb12-174"></span>
<span id="cb12-175"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">######</span></span>
<span id="cb12-176"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># using Ableton for sounds</span></span></code></pre></div>
</details>
</div>
<p><audio controls=""> <source src="fifths_3_track_prob_1.mp3" type="audio/wav"> </audio></p>
<p>At some point I put three tracks into Ableton and chose some synth voices.</p>
</section>
<section id="expandingreducing-the-note-collection" class="level2">
<h2 class="anchored" data-anchor-id="expandingreducing-the-note-collection">Expanding/reducing the note collection</h2>
<p>Increased the number of tracks to 4. Every bar the number of notes that can get sampled is randomly varied from a collection of notes around the circle of fifths. I didn’t yet get the composition spinning around the circle, but I’m skipping that for now.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(midiblender)</span>
<span id="cb13-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(dplyr)</span>
<span id="cb13-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tibble)</span>
<span id="cb13-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># import midi</span></span>
<span id="cb13-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># using mario to get the midi headers</span></span>
<span id="cb13-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># need to add a vanilla midi file to this package for easier importing</span></span>
<span id="cb13-7">mario <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">midi_to_object</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"all_overworld.mid"</span>)</span>
<span id="cb13-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list2env</span>(mario, .GlobalEnv) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># send objects to global environment</span></span>
<span id="cb13-9"></span>
<span id="cb13-10"></span>
<span id="cb13-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Sample some beats for timesteps into the matrix</span></span>
<span id="cb13-12">bars <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb13-13">notes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">128</span></span>
<span id="cb13-14">ticks <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">96</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>bars</span>
<span id="cb13-15"></span>
<span id="cb13-16">all_beat_matrix <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow=</span>notes,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">96</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>)</span>
<span id="cb13-17"></span>
<span id="cb13-18"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span>(i <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>) {</span>
<span id="cb13-19">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># empty beat matrix</span></span>
<span id="cb13-20">  beat_matrix <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow =</span> notes, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol =</span> ticks)</span>
<span id="cb13-21">  </span>
<span id="cb13-22">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#assign kick beats</span></span>
<span id="cb13-23">  kick <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bresenham_euclidean</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">start =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb13-24">  snare <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bresenham_euclidean</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">start =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb13-25">  hihats <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bresenham_euclidean</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">start =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb13-26">  </span>
<span id="cb13-27">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># assign to matrix</span></span>
<span id="cb13-28">  beat_matrix[(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">36</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, ticks, ticks <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>)] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> kick</span>
<span id="cb13-29">  beat_matrix[(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">38</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, ticks, ticks <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>)] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> snare</span>
<span id="cb13-30">  beat_matrix[(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">42</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, ticks, ticks <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>)] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> hihats</span>
<span id="cb13-31">  </span>
<span id="cb13-32">  all_beat_matrix <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cbind</span>(all_beat_matrix, beat_matrix)</span>
<span id="cb13-33">}</span>
<span id="cb13-34"></span>
<span id="cb13-35"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># get the point estimates</span></span>
<span id="cb13-36">time_probabilities <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colSums</span>(all_beat_matrix)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(all_beat_matrix)</span>
<span id="cb13-37"></span>
<span id="cb13-38">bar_probabilities <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix</span>(time_probabilities,</span>
<span id="cb13-39">                            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">96</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>),</span>
<span id="cb13-40">                            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">byrow =</span> T)</span>
<span id="cb13-41"></span>
<span id="cb13-42">bar_probabilities <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colMeans</span>(bar_probabilities)</span>
<span id="cb13-43"></span>
<span id="cb13-44"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># make my own midi notes df</span></span>
<span id="cb13-45"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># add this to midiblender later</span></span>
<span id="cb13-46">midi_notes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> pyramidi<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span>midi_defs <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb13-47">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rowwise</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb13-48">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note_letter =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unlist</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">strsplit</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.character</span>(note_name),<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"-"</span>))[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>],</span>
<span id="cb13-49">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">octave =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unlist</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">strsplit</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.character</span>(note_name),<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"-"</span>))[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>])</span>
<span id="cb13-50"></span>
<span id="cb13-51">midi_notes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">notes =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(midi_notes[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>,]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>note_letter,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span>)[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">128</span>],</span>
<span id="cb13-52">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">octaves =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">each =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>)[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">128</span>],</span>
<span id="cb13-53">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">midi_number =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">127</span></span>
<span id="cb13-54">)</span>
<span id="cb13-55"></span>
<span id="cb13-56"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Empty data frame to hold midi track dfs</span></span>
<span id="cb13-57">all_track_midi <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>()</span>
<span id="cb13-58"></span>
<span id="cb13-59"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># paramaters that get changed for every track</span></span>
<span id="cb13-60"></span>
<span id="cb13-61">time_densities <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">512</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">256</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">128</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">64</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># controls number of notes per bar </span></span>
<span id="cb13-62"></span>
<span id="cb13-63"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># track loop</span></span>
<span id="cb13-64"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span>(t <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>){</span>
<span id="cb13-65"></span>
<span id="cb13-66">song <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow=</span>notes,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb13-67"></span>
<span id="cb13-68"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># begin bar by bar composition loop</span></span>
<span id="cb13-69"></span>
<span id="cb13-70"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span>(i <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">32</span>){</span>
<span id="cb13-71"></span>
<span id="cb13-72">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># get some notes to sample from fifths around a starting note</span></span>
<span id="cb13-73">  starting_note <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">60</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># C4</span></span>
<span id="cb13-74">  fifth_intervals <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span>, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span>, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span>)</span>
<span id="cb13-75">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># size of collection now changes every bar</span></span>
<span id="cb13-76">  notes_to_choose <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> starting_note <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(fifth_intervals,<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))</span>
<span id="cb13-77">  octave_range <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span></span>
<span id="cb13-78">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># starting to bias note sampling here</span></span>
<span id="cb13-79">  note_frequencies <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(notes_to_choose)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) </span>
<span id="cb13-80">  </span>
<span id="cb13-81">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># pair the frequencies with the notes</span></span>
<span id="cb13-82">  note_names <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> midi_notes <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb13-83">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(midi_number <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> notes_to_choose) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb13-84">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(notes) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb13-85">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note_frequencies =</span> note_frequencies)</span>
<span id="cb13-86">  </span>
<span id="cb13-87">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># get all possible notes across octaves in collection</span></span>
<span id="cb13-88">  possible_notes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> midi_notes <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb13-89">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(notes <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> note_names<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>notes <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>,</span>
<span id="cb13-90">           octaves <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> octave_range <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb13-91">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># add note frequencies</span></span>
<span id="cb13-92">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">left_join</span>(note_names,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"notes"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb13-93">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">probs =</span> note_frequencies<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(note_frequencies))</span>
<span id="cb13-94">  </span>
<span id="cb13-95">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># create probability vector</span></span>
<span id="cb13-96">  pitch_probabilities <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">128</span>)</span>
<span id="cb13-97">  pitch_probabilities[possible_notes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>midi_number <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span></span>
<span id="cb13-98">    possible_notes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>probs</span>
<span id="cb13-99">  </span>
<span id="cb13-100">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># get new pitches</span></span>
<span id="cb13-101">  new_pitches <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbinom</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(pitch_probabilities),</span>
<span id="cb13-102">                        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">32</span>,</span>
<span id="cb13-103">                        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">prob =</span> pitch_probabilities)</span>
<span id="cb13-104">  new_pitches[new_pitches <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb13-105">  </span>
<span id="cb13-106">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># get new times</span></span>
<span id="cb13-107">  new_times <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbinom</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(bar_probabilities),</span>
<span id="cb13-108">                      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> time_densities[t],</span>
<span id="cb13-109">                      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">prob =</span> bar_probabilities)</span>
<span id="cb13-110">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># To Do: come back here and make it ok to have more than 1</span></span>
<span id="cb13-111">  new_times[new_times <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb13-112">  </span>
<span id="cb13-113">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># make a note by time unit matrix</span></span>
<span id="cb13-114">    one_bar <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb13-115">                      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">128</span>,</span>
<span id="cb13-116">                      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">96</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>)</span>
<span id="cb13-117">  </span>
<span id="cb13-118">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(new_times) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>){</span>
<span id="cb13-119">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># get row column ids</span></span>
<span id="cb13-120">    sampled_notes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">which</span>(new_pitches <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb13-121">    sampled_times <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">which</span>(new_times <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb13-122">    </span>
<span id="cb13-123">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># combine, make sure equal length</span></span>
<span id="cb13-124">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> (<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(sampled_notes) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(sampled_times)) {</span>
<span id="cb13-125">      sampled_ids <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span></span>
<span id="cb13-126">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">notes =</span> sampled_notes[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(sampled_times)],</span>
<span id="cb13-127">               <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times =</span> sampled_times)</span>
<span id="cb13-128">    } <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span> {</span>
<span id="cb13-129">      sampled_ids <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">notes =</span> sampled_notes,</span>
<span id="cb13-130">                            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times =</span> sampled_times[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(sampled_notes)])</span>
<span id="cb13-131">    }</span>
<span id="cb13-132">    </span>
<span id="cb13-133">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># shuffle the notes across the times so the sampling is uniform</span></span>
<span id="cb13-134">    sampled_ids<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>notes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(sampled_ids<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>notes)</span>
<span id="cb13-135">    </span>
<span id="cb13-136">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># assign 1s to note locations in time</span></span>
<span id="cb13-137">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (r <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dim</span>(sampled_ids)[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]) {</span>
<span id="cb13-138">      one_bar[sampled_ids<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>notes[r], sampled_ids<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>times[r]] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb13-139">    }</span>
<span id="cb13-140">  }</span>
<span id="cb13-141">  </span>
<span id="cb13-142">  song <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cbind</span>(song,one_bar)</span>
<span id="cb13-143">}</span>
<span id="cb13-144"></span>
<span id="cb13-145"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">#####################</span></span>
<span id="cb13-146"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># transform back to midi</span></span>
<span id="cb13-147">track_0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">copy_midi_df_track</span>(midi_df,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">track_num =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb13-148"></span>
<span id="cb13-149">midi_time_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix_to_midi_time</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">midi_matrix =</span> song,</span>
<span id="cb13-150">                                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">smallest_time_unit =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,</span>
<span id="cb13-151">                                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note_off_length =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">32</span>)</span>
<span id="cb13-152"></span>
<span id="cb13-153">meta_messages_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_midi_meta_df</span>(track_0)</span>
<span id="cb13-154"></span>
<span id="cb13-155">meta_messages_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set_midi_tempo_meta</span>(meta_messages_df,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">update_tempo =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">500000</span>)</span>
<span id="cb13-156"></span>
<span id="cb13-157">split_meta_messages_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">split_meta_df</span>(meta_messages_df)</span>
<span id="cb13-158"></span>
<span id="cb13-159">new_midi_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix_to_midi_track</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">midi_time_df =</span> midi_time_df,</span>
<span id="cb13-160">                                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">split_meta_list =</span> split_meta_messages_df,</span>
<span id="cb13-161">                                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">channel =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb13-162">                                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">velocity =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>)</span>
<span id="cb13-163">new_midi_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> new_midi_df <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb13-164">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">i_track =</span> t)</span>
<span id="cb13-165"></span>
<span id="cb13-166">all_track_midi <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbind</span>(all_track_midi,</span>
<span id="cb13-167">                        new_midi_df)</span>
<span id="cb13-168">}</span>
<span id="cb13-169"></span>
<span id="cb13-170"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">#### bounce</span></span>
<span id="cb13-171"></span>
<span id="cb13-172"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># update miditapyr df</span></span>
<span id="cb13-173">miditapyr_object<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>midi_frame_unnested<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">update_unnested_mf</span>(all_track_midi)</span>
<span id="cb13-174"></span>
<span id="cb13-175"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#write midi file to disk</span></span>
<span id="cb13-176">miditapyr_object<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">write_file</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fifths_4_tracks_prob_2.mid"</span>)</span>
<span id="cb13-177"></span>
<span id="cb13-178"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">######</span></span>
<span id="cb13-179"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># using Ableton for sounds</span></span></code></pre></div>
</details>
</div>
<p><audio controls=""> <source src="fifths_4_track_prob_2.mp3" type="audio/wav"> </audio></p>
<p>This one is again using ableton for sounds, with a little bit more care taken to make it sound mildly interesting. Had fun. Still sounds like halting robot music that drones on without much change in direction.</p>
<p>Alright, finished here for now.</p>



</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0">
<div id="ref-toussaint2005" class="csl-entry">
Toussaint, Godfried. 2005. <span>“The Euclidean Algorithm Generates Traditional Musical Rhythms.”</span> In, 4756. <a href="https://archive.bridgesmathart.org/2005/bridges2005-47.html">https://archive.bridgesmathart.org/2005/bridges2005-47.html</a>.
</div>
</div></section></div> ]]></description>
  <category>midiblender</category>
  <category>euclidean rhythms</category>
  <category>information theory</category>
  <guid>https://homophony.quest/blog/44_2_10_24_euclid/</guid>
  <pubDate>Sat, 10 Feb 2024 05:00:00 GMT</pubDate>
  <media:content url="https://homophony.quest/blog/44_2_10_24_euclid/cover.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>Turning up the randomness to 11 for MAXIMUM MIDI MADNESS</title>
  <dc:creator>Matt Crump</dc:creator>
  <link>https://homophony.quest/blog/43_2_9_24_max_random/</link>
  <description><![CDATA[ 




<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> diffusers <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> DiffusionPipeline</span>
<span id="cb1-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> transformers <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> set_seed</span>
<span id="cb1-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> PIL <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> Image</span>
<span id="cb1-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> torch</span>
<span id="cb1-5"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> random</span>
<span id="cb1-6"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> ssl</span>
<span id="cb1-7"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> os</span>
<span id="cb1-8">ssl._create_default_https_context <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ssl._create_unverified_context</span>
<span id="cb1-9"></span>
<span id="cb1-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#locate library</span></span>
<span id="cb1-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#model_id = "./stable-diffusion-v1-5"</span></span>
<span id="cb1-12">model_id <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dreamshaper-xl-turbo"</span></span>
<span id="cb1-13"></span>
<span id="cb1-14">pipeline <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> DiffusionPipeline.from_pretrained(</span>
<span id="cb1-15">    pretrained_model_name_or_path <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../../../../bigFiles/huggingface/dreamshaper-xl-turbo/"</span></span>
<span id="cb1-16">)</span>
<span id="cb1-17"></span>
<span id="cb1-18">pipeline <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pipeline.to(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mps"</span>)</span>
<span id="cb1-19"></span>
<span id="cb1-20"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Recommended if your computer has &lt; 64 GB of RAM</span></span>
<span id="cb1-21">pipeline.enable_attention_slicing(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"max"</span>)</span>
<span id="cb1-22"></span>
<span id="cb1-23">prompt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Random MIDI randomness. Explosive torrent of musical notes. Exploding the universe of music. Music everywhere. Neon super colorful sonic cartoon."</span></span>
<span id="cb1-24"></span>
<span id="cb1-25"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> s <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>):</span>
<span id="cb1-26">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> n <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>]:</span>
<span id="cb1-27">    seed <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> s<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span></span>
<span id="cb1-28">    num_steps <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> n<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb1-29">    set_seed(seed)</span>
<span id="cb1-30">    </span>
<span id="cb1-31">    image <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pipeline(prompt,height <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1024</span>,width <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1024</span>,num_images_per_prompt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,num_inference_steps<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>num_steps)</span>
<span id="cb1-32">    </span>
<span id="cb1-33">    image_name <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"images/synth_</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">_</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">.jpeg"</span></span>
<span id="cb1-34">    </span>
<span id="cb1-35">    image_save <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> image.images[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].save(image_name.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">format</span>(seed,num_steps))</span></code></pre></div>
</details>
</div>
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><img src="https://homophony.quest/blog/43_2_9_24_max_random/cover.jpg" class="img-fluid quarto-figure quarto-figure-left figure-img" style="width:50.0%"></p>
</figure>
</div>

<div class="no-row-height column-margin column-container"><div class="">
<p>Random MIDI randomness. Explosive torrent of musical notes. Exploding the universe of music. Music everywhere. Neon super colorful sonic cartoon. - dreamshaper</p>
</div></div><div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>Some of the audio is loud, be careful with volume. MIDI was mangled.</p>
</div>
</div>
<p>If I’m going to mangle MIDI, I should at least stuff it with as many notes from a uniform distribution as I care to.</p>
<p>I will now attempt to randomize the pancakes out of a MIDI file until they splatter into a polyphonic volcano of mangled bliss (that’s the dream scenario).</p>
<p>According to some quick research, it seems that fluid synth (that I’m using to quickly render MIDI files with premium cheese factor) has at least 128 voices of polyphony, which is enough to play all of the midi notes at the same time…potentially all in randomized voices.</p>
<p>Here’s the plan. Will it blend? I don’t know. I’m pretty sure the first part of the plan will blend quickly.</p>
<ol type="1">
<li>Create a piano roll matrix with 128 rows and enough columns of midi ticks for 30 seconds.</li>
<li>Completely randomize note occurrence across the whole matrix, such that any note could occur in any time point.</li>
<li>Increase the note density so that there is a lot of notes being randomly generated…maybe not all the way to 128 notes per tick, that seems too extreme (but what does that sound like !?!).</li>
<li>Bump this super fat rando matrix out to a midi file.</li>
<li>For the easy win, render it via fluid synth and listen to it.</li>
<li>Maybe this will be easy too, but I’d like to randomize the synth voice for each note in the matrix. I’m not sure how straight forward this part is…will find out. Update, I didn’t do that part, saving for another day.</li>
</ol>
<p>Let the abomination begin.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(midiblender)</span>
<span id="cb2-2"></span>
<span id="cb2-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#import midi</span></span>
<span id="cb2-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#using mario to get the midi headers</span></span>
<span id="cb2-5">mario <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">midi_to_object</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"all_overworld.mid"</span>)</span>
<span id="cb2-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list2env</span>(mario, .GlobalEnv) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># send objects to global environment</span></span>
<span id="cb2-7"></span>
<span id="cb2-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># convert midi to matrix</span></span>
<span id="cb2-9">n_notes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">128</span></span>
<span id="cb2-10">n_ticks <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">96</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#15 bars at 120BPM of this should be enough</span></span>
<span id="cb2-11"></span>
<span id="cb2-12">feature_vector <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,n_notes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>n_ticks)</span>
<span id="cb2-13">prob_vector <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> feature_vector<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(feature_vector)</span>
<span id="cb2-14"></span>
<span id="cb2-15"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ensures uniform sampling of notes into tick intervals</span></span>
<span id="cb2-16"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Number of notes is approximately  = density</span></span>
<span id="cb2-17"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># my note density goes to 1100</span></span>
<span id="cb2-18">rando_vector <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> midiblender<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">new_features_from_probs</span>(prob_vector,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">density =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1100</span>)</span>
<span id="cb2-19"></span>
<span id="cb2-20"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># convert back piano roll matrix</span></span>
<span id="cb2-21">rando_matrix <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">feature_vector_to_matrix</span>(rando_vector, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">num_notes=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">128</span>)</span>
<span id="cb2-22"></span>
<span id="cb2-23"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">###############</span></span>
<span id="cb2-24"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># turn it back into midi and render to mp3</span></span>
<span id="cb2-25"></span>
<span id="cb2-26">track_0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">copy_midi_df_track</span>(midi_df,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">track_num =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb2-27"></span>
<span id="cb2-28"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># transform back to midi</span></span>
<span id="cb2-29">midi_time_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix_to_midi_time</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">midi_matrix =</span> rando_matrix,</span>
<span id="cb2-30">                                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">smallest_time_unit =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,</span>
<span id="cb2-31">                                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note_off_length =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>)</span>
<span id="cb2-32"></span>
<span id="cb2-33">meta_messages_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_midi_meta_df</span>(track_0)</span>
<span id="cb2-34"></span>
<span id="cb2-35">meta_messages_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set_midi_tempo_meta</span>(meta_messages_df,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">update_tempo =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">500000</span>)</span>
<span id="cb2-36"></span>
<span id="cb2-37">split_meta_messages_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">split_meta_df</span>(meta_messages_df)</span>
<span id="cb2-38"></span>
<span id="cb2-39">new_midi_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix_to_midi_track</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">midi_time_df =</span> midi_time_df,</span>
<span id="cb2-40">                                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">split_meta_list =</span> split_meta_messages_df,</span>
<span id="cb2-41">                                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">channel =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb2-42">                                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">velocity =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>)</span>
<span id="cb2-43"></span>
<span id="cb2-44"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">#### bounce</span></span>
<span id="cb2-45"></span>
<span id="cb2-46"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># update miditapyr df</span></span>
<span id="cb2-47">miditapyr_object<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>midi_frame_unnested<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">update_unnested_mf</span>(new_midi_df)</span>
<span id="cb2-48"></span>
<span id="cb2-49"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#write midi file to disk</span></span>
<span id="cb2-50">miditapyr_object<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">write_file</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rando_1100.mid"</span>)</span>
<span id="cb2-51"></span>
<span id="cb2-52"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">#########</span></span>
<span id="cb2-53"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># bounce to mp3 with fluid synth</span></span>
<span id="cb2-54"></span>
<span id="cb2-55">track_name <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rando_1100"</span></span>
<span id="cb2-56"></span>
<span id="cb2-57">wav_name <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(track_name,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">".wav"</span>)</span>
<span id="cb2-58">midi_name <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(track_name,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">".mid"</span>)</span>
<span id="cb2-59">mp3_name <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(track_name,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">".mp3"</span>)</span>
<span id="cb2-60"></span>
<span id="cb2-61"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># synthesize midi file to wav with fluid synth</span></span>
<span id="cb2-62">system_command <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> glue<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">glue</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'fluidsynth -F {wav_name} ~/Library/Audio/Sounds/Banks/nintendo_soundfont.sf2 {midi_name}'</span>)</span>
<span id="cb2-63"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">system</span>(system_command)</span>
<span id="cb2-64"></span>
<span id="cb2-65"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># convert wav to mp3</span></span>
<span id="cb2-66">av<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">av_audio_convert</span>(wav_name,mp3_name)</span>
<span id="cb2-67"></span>
<span id="cb2-68"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># clean up and delete wav</span></span>
<span id="cb2-69"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">file.exists</span>(wav_name)){</span>
<span id="cb2-70">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">file.remove</span>(wav_name)</span>
<span id="cb2-71">}</span></code></pre></div>
</details>
</div>
<p><audio controls=""> <source src="rando_1100.mp3" type="audio/wav"> </audio></p>
<p>I used a nintendo sound font sound here. It’s nice and random, too pretty though. Not nearly enough notes.</p>
<p>There are 128 possible notes and 15 bars. Each bar has four beats of 96 ticks. In total, there is 128 x 96 x 4 x 15 = 737280 cells where a note could be. I sampled about 1100 notes uniformly into those cells. That’s just not enough.</p>
<p>It should at least go to 11 percent, or about 81000 notes in 30 seconds. That seems like so many…oooooeeee.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#import midi</span></span>
<span id="cb3-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#using mario to get the midi headers</span></span>
<span id="cb3-3">mario <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">midi_to_object</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"all_overworld.mid"</span>)</span>
<span id="cb3-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list2env</span>(mario, .GlobalEnv) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># send objects to global environment</span></span>
<span id="cb3-5"></span>
<span id="cb3-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># convert midi to matrix</span></span>
<span id="cb3-7">n_notes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">128</span></span>
<span id="cb3-8">n_ticks <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">96</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#15 bars at 120BPM of this should be enough</span></span>
<span id="cb3-9"></span>
<span id="cb3-10">feature_vector <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,n_notes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>n_ticks)</span>
<span id="cb3-11">prob_vector <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> feature_vector<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(feature_vector)</span>
<span id="cb3-12"></span>
<span id="cb3-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ensures uniform sampling of notes into tick intervals</span></span>
<span id="cb3-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Number of notes is approximately  = density</span></span>
<span id="cb3-15"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># my note density goes to 11%</span></span>
<span id="cb3-16">rando_vector <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> midiblender<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">new_features_from_probs</span>(prob_vector,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">density =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">81100</span>)</span>
<span id="cb3-17"></span>
<span id="cb3-18"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># convert back piano roll matrix</span></span>
<span id="cb3-19">rando_matrix <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">feature_vector_to_matrix</span>(rando_vector, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">num_notes=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">128</span>)</span>
<span id="cb3-20"></span>
<span id="cb3-21"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">###############</span></span>
<span id="cb3-22"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># turn it back into midi and render to mp3</span></span>
<span id="cb3-23"></span>
<span id="cb3-24">track_0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">copy_midi_df_track</span>(midi_df,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">track_num =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb3-25"></span>
<span id="cb3-26"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># transform back to midi</span></span>
<span id="cb3-27">midi_time_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix_to_midi_time</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">midi_matrix =</span> rando_matrix,</span>
<span id="cb3-28">                                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">smallest_time_unit =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,</span>
<span id="cb3-29">                                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note_off_length =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>)</span>
<span id="cb3-30"></span>
<span id="cb3-31">meta_messages_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_midi_meta_df</span>(track_0)</span>
<span id="cb3-32"></span>
<span id="cb3-33">meta_messages_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set_midi_tempo_meta</span>(meta_messages_df,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">update_tempo =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">500000</span>)</span>
<span id="cb3-34"></span>
<span id="cb3-35">split_meta_messages_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">split_meta_df</span>(meta_messages_df)</span>
<span id="cb3-36"></span>
<span id="cb3-37">new_midi_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix_to_midi_track</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">midi_time_df =</span> midi_time_df,</span>
<span id="cb3-38">                                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">split_meta_list =</span> split_meta_messages_df,</span>
<span id="cb3-39">                                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">channel =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb3-40">                                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">velocity =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>)</span>
<span id="cb3-41"></span>
<span id="cb3-42"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">#### bounce</span></span>
<span id="cb3-43"></span>
<span id="cb3-44"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># update miditapyr df</span></span>
<span id="cb3-45">miditapyr_object<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>midi_frame_unnested<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">update_unnested_mf</span>(new_midi_df)</span>
<span id="cb3-46"></span>
<span id="cb3-47"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#write midi file to disk</span></span>
<span id="cb3-48">miditapyr_object<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">write_file</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rando_B.mid"</span>)</span>
<span id="cb3-49"></span>
<span id="cb3-50"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">#########</span></span>
<span id="cb3-51"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># bounce to mp3 with fluid synth</span></span>
<span id="cb3-52"></span>
<span id="cb3-53">track_name <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rando_B"</span></span>
<span id="cb3-54"></span>
<span id="cb3-55">wav_name <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(track_name,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">".wav"</span>)</span>
<span id="cb3-56">midi_name <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(track_name,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">".mid"</span>)</span>
<span id="cb3-57">mp3_name <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(track_name,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">".mp3"</span>)</span>
<span id="cb3-58"></span>
<span id="cb3-59"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># synthesize midi file to wav with fluid synth</span></span>
<span id="cb3-60">system_command <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> glue<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">glue</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'fluidsynth -F {wav_name} ~/Library/Audio/Sounds/Banks/nintendo_soundfont.sf2 {midi_name}'</span>)</span>
<span id="cb3-61"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">system</span>(system_command)</span>
<span id="cb3-62"></span>
<span id="cb3-63"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># convert wav to mp3</span></span>
<span id="cb3-64">av<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">av_audio_convert</span>(wav_name,mp3_name)</span>
<span id="cb3-65"></span>
<span id="cb3-66"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># clean up and delete wav</span></span>
<span id="cb3-67"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">file.exists</span>(wav_name)){</span>
<span id="cb3-68">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">file.remove</span>(wav_name)</span>
<span id="cb3-69">}</span></code></pre></div>
</details>
</div>
<p>HAHAHHAHAHA. Oh MY. Giving my eurorack a run on thick noise.</p>
<p>MuseScore4 would not render the sheet music for this. But, fluid synth didn’t even blink.</p>
<p><strong>It’s very loud, so beware.</strong></p>
<p><audio controls=""> <source src="rando_B.mp3" type="audio/wav"> </audio></p>
<p>Chunky compared to white noise, and whiffs of crystal rain.</p>
<section id="notes" class="level2">
<h2 class="anchored" data-anchor-id="notes">Notes</h2>
<p>That was fun. Had to try it. Even though this is basically ridiculous, I might return here one day with some FX pedals.</p>
<hr>
<p>I couldn’t stay away. Too many questions. And, it seems like I could add program change notes to change the synth voice, so I’m going to try that. And, I wondered about ramping the note density up and down over time, and will try that too. Maybe some other stuff.</p>
</section>
<section id="randomizing-notes-and-program-changes" class="level2">
<h2 class="anchored" data-anchor-id="randomizing-notes-and-program-changes">Randomizing notes and program changes</h2>
<p>Based ona few checks of MIDI files, it seems I could insert a program change message anywhere in a track, and this ought to change the synth voice. Gotta try it out.</p>
<p>Notes:</p>
<ul>
<li>how many patches are in the nintendo sound font? need to find out.</li>
</ul>
<p>Maybe run this? Seems to work and shows a long enough list to get me started.</p>
<pre><code>echo "inst 1" | fluidsynth ~/Library/Audio/Sounds/Banks/nintendo_soundfont.sf2</code></pre>
<p>Had to break out a while loop for this one!</p>
<p>Need to keep the program change between 0-127. I guess there would be other stuff to switch banks. Leaving that for now.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(midiblender)</span>
<span id="cb5-2"></span>
<span id="cb5-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#import midi</span></span>
<span id="cb5-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#using mario to get the midi headers</span></span>
<span id="cb5-5">mario <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">midi_to_object</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"all_overworld.mid"</span>)</span>
<span id="cb5-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list2env</span>(mario, .GlobalEnv) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># send objects to global environment</span></span>
<span id="cb5-7"></span>
<span id="cb5-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># convert midi to matrix</span></span>
<span id="cb5-9">n_notes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">128</span></span>
<span id="cb5-10">n_ticks <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">96</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#15 bars at 120BPM of this should be enough</span></span>
<span id="cb5-11"></span>
<span id="cb5-12">feature_vector <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,n_notes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>n_ticks)</span>
<span id="cb5-13">prob_vector <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> feature_vector<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(feature_vector)</span>
<span id="cb5-14"></span>
<span id="cb5-15"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ensures uniform sampling of notes into tick intervals</span></span>
<span id="cb5-16"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Number of notes is approximately  = density</span></span>
<span id="cb5-17"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># my note density goes to 1100</span></span>
<span id="cb5-18">rando_vector <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> midiblender<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">new_features_from_probs</span>(prob_vector,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">density =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1100</span>)</span>
<span id="cb5-19"></span>
<span id="cb5-20"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># convert back piano roll matrix</span></span>
<span id="cb5-21">rando_matrix <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">feature_vector_to_matrix</span>(rando_vector, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">num_notes=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">128</span>)</span>
<span id="cb5-22"></span>
<span id="cb5-23"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">###############</span></span>
<span id="cb5-24"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># turn it back into midi and render to mp3</span></span>
<span id="cb5-25"></span>
<span id="cb5-26">track_0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">copy_midi_df_track</span>(midi_df,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">track_num =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb5-27"></span>
<span id="cb5-28"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># transform back to midi</span></span>
<span id="cb5-29">midi_time_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix_to_midi_time</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">midi_matrix =</span> rando_matrix,</span>
<span id="cb5-30">                                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">smallest_time_unit =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,</span>
<span id="cb5-31">                                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note_off_length =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>)</span>
<span id="cb5-32"></span>
<span id="cb5-33">meta_messages_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_midi_meta_df</span>(track_0)</span>
<span id="cb5-34"></span>
<span id="cb5-35">meta_messages_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set_midi_tempo_meta</span>(meta_messages_df,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">update_tempo =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">500000</span>)</span>
<span id="cb5-36"></span>
<span id="cb5-37">split_meta_messages_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">split_meta_df</span>(meta_messages_df)</span>
<span id="cb5-38"></span>
<span id="cb5-39">new_midi_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix_to_midi_track</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">midi_time_df =</span> midi_time_df,</span>
<span id="cb5-40">                                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">split_meta_list =</span> split_meta_messages_df,</span>
<span id="cb5-41">                                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">channel =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb5-42">                                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">velocity =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>)</span>
<span id="cb5-43"></span>
<span id="cb5-44"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">###################</span></span>
<span id="cb5-45"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># add random program changes before each note on</span></span>
<span id="cb5-46"></span>
<span id="cb5-47">i <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb5-48"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">while</span>(i <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dim</span>(new_midi_df)[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]){</span>
<span id="cb5-49">  i <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> i<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb5-50">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span>(new_midi_df<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>type[i] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"note_on"</span>){</span>
<span id="cb5-51">   new_midi_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> new_midi_df <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb5-52">      dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_row</span>(</span>
<span id="cb5-53">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">i_track =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb5-54">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">meta =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>,</span>
<span id="cb5-55">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">time =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb5-56">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">program =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">127</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),</span>
<span id="cb5-57">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">channel =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb5-58">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"program_change"</span>,</span>
<span id="cb5-59">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.before =</span> i)</span>
<span id="cb5-60">   i <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> i<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb5-61">  }</span>
<span id="cb5-62">  </span>
<span id="cb5-63">}</span>
<span id="cb5-64"></span>
<span id="cb5-65"></span>
<span id="cb5-66"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">#### bounce</span></span>
<span id="cb5-67"></span>
<span id="cb5-68"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># update miditapyr df</span></span>
<span id="cb5-69">miditapyr_object<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>midi_frame_unnested<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">update_unnested_mf</span>(new_midi_df)</span>
<span id="cb5-70"></span>
<span id="cb5-71"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#write midi file to disk</span></span>
<span id="cb5-72">miditapyr_object<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">write_file</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rando_1100_PC_B.mid"</span>)</span>
<span id="cb5-73"></span>
<span id="cb5-74"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">#########</span></span>
<span id="cb5-75"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># bounce to mp3 with fluid synth</span></span>
<span id="cb5-76"></span>
<span id="cb5-77">track_name <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rando_1100_PC"</span></span>
<span id="cb5-78"></span>
<span id="cb5-79">wav_name <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(track_name,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">".wav"</span>)</span>
<span id="cb5-80">midi_name <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(track_name,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">".mid"</span>)</span>
<span id="cb5-81">mp3_name <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(track_name,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">".mp3"</span>)</span>
<span id="cb5-82"></span>
<span id="cb5-83"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># synthesize midi file to wav with fluid synth</span></span>
<span id="cb5-84">system_command <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> glue<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">glue</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'fluidsynth -F {wav_name} ~/Library/Audio/Sounds/Banks/nintendo_soundfont.sf2 {midi_name}'</span>)</span>
<span id="cb5-85"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">system</span>(system_command)</span>
<span id="cb5-86"></span>
<span id="cb5-87"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#system_command &lt;- glue::glue('fluidsynth -F {wav_name} ~/Library/Audio/Sounds/Banks/FluidR3_GM.sf2 {midi_name}')</span></span>
<span id="cb5-88"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#system(system_command)</span></span>
<span id="cb5-89"></span>
<span id="cb5-90"></span>
<span id="cb5-91"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># convert wav to mp3</span></span>
<span id="cb5-92">av<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">av_audio_convert</span>(wav_name,mp3_name)</span>
<span id="cb5-93"></span>
<span id="cb5-94"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># clean up and delete wav</span></span>
<span id="cb5-95"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">file.exists</span>(wav_name)){</span>
<span id="cb5-96">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">file.remove</span>(wav_name)</span>
<span id="cb5-97">}</span></code></pre></div>
</details>
</div>
<p><audio controls=""> <source src="rando_1100_PC.mp3" type="audio/wav"> </audio></p>
<p>I got a lot of fluidsynth warnings for instrument not found when the PC value was 120 or greater. Oh well. This sounds like a breathy R2D2.</p>
<p>Here’s another one using the <code>FluidR3_GM.sf2</code> soundfont, which is a General MIDI kind of thing. I set the note length to a bit longer.</p>
<p><audio controls=""> <source src="rando_1100_PC_B.mp3" type="audio/wav"> </audio></p>
<p>Ha, I like it.</p>
</section>
<section id="mario-with-every-note-played-by-a-random-instrument" class="level2">
<h2 class="anchored" data-anchor-id="mario-with-every-note-played-by-a-random-instrument">Mario with every note played by a random instrument</h2>
<p>I gotta one more thing with this. What does the Mario music sound like when every note is played by a different instrument?</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(midiblender)</span>
<span id="cb6-2"></span>
<span id="cb6-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#import midi</span></span>
<span id="cb6-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#using mario to get the midi headers</span></span>
<span id="cb6-5">mario <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">midi_to_object</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"all_overworld.mid"</span>)</span>
<span id="cb6-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list2env</span>(mario, .GlobalEnv) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># send objects to global environment</span></span>
<span id="cb6-7"></span>
<span id="cb6-8">new_midi_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> midi_df</span>
<span id="cb6-9"></span>
<span id="cb6-10"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">###################</span></span>
<span id="cb6-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># add random program changes before each note on</span></span>
<span id="cb6-12"></span>
<span id="cb6-13">i <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb6-14"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">while</span>(i <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dim</span>(new_midi_df)[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]){</span>
<span id="cb6-15">  i <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> i<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb6-16">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span>(new_midi_df<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>type[i] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"note_on"</span>){</span>
<span id="cb6-17">   new_midi_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> new_midi_df <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb6-18">      dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_row</span>(</span>
<span id="cb6-19">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">i_track =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb6-20">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">meta =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>,</span>
<span id="cb6-21">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">time =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb6-22">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">program =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">127</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),</span>
<span id="cb6-23">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">channel =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb6-24">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"program_change"</span>,</span>
<span id="cb6-25">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.before =</span> i)</span>
<span id="cb6-26">   i <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> i<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb6-27">  }</span>
<span id="cb6-28">  </span>
<span id="cb6-29">}</span>
<span id="cb6-30"></span>
<span id="cb6-31"></span>
<span id="cb6-32"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">#### bounce</span></span>
<span id="cb6-33"></span>
<span id="cb6-34"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># update miditapyr df</span></span>
<span id="cb6-35">miditapyr_object<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>midi_frame_unnested<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">update_unnested_mf</span>(new_midi_df)</span>
<span id="cb6-36"></span>
<span id="cb6-37"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#write midi file to disk</span></span>
<span id="cb6-38">miditapyr_object<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">write_file</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mario_rand_voice.mid"</span>)</span>
<span id="cb6-39"></span>
<span id="cb6-40"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">#########</span></span>
<span id="cb6-41"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># bounce to mp3 with fluid synth</span></span>
<span id="cb6-42"></span>
<span id="cb6-43">track_name <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mario_rand_voice"</span></span>
<span id="cb6-44"></span>
<span id="cb6-45">wav_name <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(track_name,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">".wav"</span>)</span>
<span id="cb6-46">midi_name <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(track_name,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">".mid"</span>)</span>
<span id="cb6-47">mp3_name <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(track_name,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">".mp3"</span>)</span>
<span id="cb6-48"></span>
<span id="cb6-49"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># synthesize midi file to wav with fluid synth</span></span>
<span id="cb6-50"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#system_command &lt;- glue::glue('fluidsynth -F {wav_name} ~/Library/Audio/Sounds/Banks/nintendo_soundfont.sf2 {midi_name}')</span></span>
<span id="cb6-51"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#system(system_command)</span></span>
<span id="cb6-52"></span>
<span id="cb6-53">system_command <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> glue<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">glue</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'fluidsynth -F {wav_name} ~/Library/Audio/Sounds/Banks/FluidR3_GM.sf2 {midi_name}'</span>)</span>
<span id="cb6-54"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">system</span>(system_command)</span>
<span id="cb6-55"></span>
<span id="cb6-56"></span>
<span id="cb6-57"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># convert wav to mp3</span></span>
<span id="cb6-58">av<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">av_audio_convert</span>(wav_name,mp3_name)</span>
<span id="cb6-59"></span>
<span id="cb6-60"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># clean up and delete wav</span></span>
<span id="cb6-61"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">file.exists</span>(wav_name)){</span>
<span id="cb6-62">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">file.remove</span>(wav_name)</span>
<span id="cb6-63">}</span></code></pre></div>
</details>
</div>
<p><audio controls=""> <source src="mario_rand_voice.mp3" type="audio/wav"> </audio></p>
<p>Meh…If I had a better handle on which patches I was randomizing over I bet that could sound more interesting.</p>
<p>Maybe I should write a utility function to play through the sounds really fast and check them out.</p>
</section>
<section id="sweeping-randomness-up-and-down" class="level2">
<h2 class="anchored" data-anchor-id="sweeping-randomness-up-and-down">Sweeping randomness up and down</h2>
<p>If this was a eurorack module there would be a whole bunch of knobs to turn. I would turn a knob for note density, so let’s see how easy it would be to have the randomness start with few notes, go up to ludicrous speed, and then come back down again.</p>
<p>And, program change all the notes, because why not.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(midiblender)</span>
<span id="cb7-2"></span>
<span id="cb7-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#import midi</span></span>
<span id="cb7-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#using mario to get the midi headers</span></span>
<span id="cb7-5">mario <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">midi_to_object</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"all_overworld.mid"</span>)</span>
<span id="cb7-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list2env</span>(mario, .GlobalEnv) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># send objects to global environment</span></span>
<span id="cb7-7"></span>
<span id="cb7-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># convert midi to matrix</span></span>
<span id="cb7-9">n_notes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">128</span></span>
<span id="cb7-10">n_ticks <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">96</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#15 bars at 120BPM of this should be enough</span></span>
<span id="cb7-11">points <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> n_notes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>n_ticks</span>
<span id="cb7-12"></span>
<span id="cb7-13">mid_point <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(points <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb7-14">ramp_up <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">length.out =</span> mid_point))</span>
<span id="cb7-15">ramp_down <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">length.out =</span> (points <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> mid_point)))</span>
<span id="cb7-16">feature_vector <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(ramp_up,ramp_down)</span>
<span id="cb7-17">prob_vector <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> feature_vector<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(feature_vector)</span>
<span id="cb7-18"></span>
<span id="cb7-19"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ensures uniform sampling of notes into tick intervals</span></span>
<span id="cb7-20"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Number of notes is approximately  = density</span></span>
<span id="cb7-21"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># my note density goes to 1100</span></span>
<span id="cb7-22">rando_vector <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> midiblender<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">new_features_from_probs</span>(prob_vector,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">density =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4000</span>)</span>
<span id="cb7-23"></span>
<span id="cb7-24"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># convert back piano roll matrix</span></span>
<span id="cb7-25">rando_matrix <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">feature_vector_to_matrix</span>(rando_vector, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">num_notes=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">128</span>)</span>
<span id="cb7-26"></span>
<span id="cb7-27"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">###############</span></span>
<span id="cb7-28"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># turn it back into midi and render to mp3</span></span>
<span id="cb7-29"></span>
<span id="cb7-30">track_0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">copy_midi_df_track</span>(midi_df,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">track_num =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb7-31"></span>
<span id="cb7-32"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># transform back to midi</span></span>
<span id="cb7-33">midi_time_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix_to_midi_time</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">midi_matrix =</span> rando_matrix,</span>
<span id="cb7-34">                                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">smallest_time_unit =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,</span>
<span id="cb7-35">                                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note_off_length =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>)</span>
<span id="cb7-36"></span>
<span id="cb7-37">meta_messages_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_midi_meta_df</span>(track_0)</span>
<span id="cb7-38"></span>
<span id="cb7-39">meta_messages_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set_midi_tempo_meta</span>(meta_messages_df,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">update_tempo =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">500000</span>)</span>
<span id="cb7-40"></span>
<span id="cb7-41">split_meta_messages_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">split_meta_df</span>(meta_messages_df)</span>
<span id="cb7-42"></span>
<span id="cb7-43">new_midi_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix_to_midi_track</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">midi_time_df =</span> midi_time_df,</span>
<span id="cb7-44">                                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">split_meta_list =</span> split_meta_messages_df,</span>
<span id="cb7-45">                                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">channel =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb7-46">                                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">velocity =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>)</span>
<span id="cb7-47"></span>
<span id="cb7-48"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">###################</span></span>
<span id="cb7-49"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># add random program changes before each note on</span></span>
<span id="cb7-50"></span>
<span id="cb7-51">i <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb7-52"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">while</span>(i <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dim</span>(new_midi_df)[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]){</span>
<span id="cb7-53">  i <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> i<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb7-54">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span>(new_midi_df<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>type[i] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"note_on"</span>){</span>
<span id="cb7-55">   new_midi_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> new_midi_df <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb7-56">      dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_row</span>(</span>
<span id="cb7-57">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">i_track =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb7-58">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">meta =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>,</span>
<span id="cb7-59">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">time =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb7-60">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">program =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">127</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),</span>
<span id="cb7-61">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">channel =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb7-62">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"program_change"</span>,</span>
<span id="cb7-63">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.before =</span> i)</span>
<span id="cb7-64">   i <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> i<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb7-65">  }</span>
<span id="cb7-66">  </span>
<span id="cb7-67">}</span>
<span id="cb7-68"></span>
<span id="cb7-69"></span>
<span id="cb7-70"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">#### bounce</span></span>
<span id="cb7-71"></span>
<span id="cb7-72"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># update miditapyr df</span></span>
<span id="cb7-73">miditapyr_object<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>midi_frame_unnested<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">update_unnested_mf</span>(new_midi_df)</span>
<span id="cb7-74"></span>
<span id="cb7-75"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#write midi file to disk</span></span>
<span id="cb7-76">miditapyr_object<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">write_file</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rando_ramp.mid"</span>)</span>
<span id="cb7-77"></span>
<span id="cb7-78"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">#########</span></span>
<span id="cb7-79"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># bounce to mp3 with fluid synth</span></span>
<span id="cb7-80"></span>
<span id="cb7-81">track_name <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rando_ramp"</span></span>
<span id="cb7-82"></span>
<span id="cb7-83">wav_name <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(track_name,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">".wav"</span>)</span>
<span id="cb7-84">midi_name <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(track_name,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">".mid"</span>)</span>
<span id="cb7-85">mp3_name <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(track_name,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">".mp3"</span>)</span>
<span id="cb7-86"></span>
<span id="cb7-87"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># synthesize midi file to wav with fluid synth</span></span>
<span id="cb7-88"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#system_command &lt;- glue::glue('fluidsynth -F {wav_name} ~/Library/Audio/Sounds/Banks/nintendo_soundfont.sf2 {midi_name}')</span></span>
<span id="cb7-89"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#system(system_command)</span></span>
<span id="cb7-90"></span>
<span id="cb7-91">system_command <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> glue<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">glue</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'fluidsynth -F {wav_name} ~/Library/Audio/Sounds/Banks/FluidR3_GM.sf2 {midi_name}'</span>)</span>
<span id="cb7-92"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">system</span>(system_command)</span>
<span id="cb7-93"></span>
<span id="cb7-94"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># convert wav to mp3</span></span>
<span id="cb7-95">av<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">av_audio_convert</span>(wav_name,mp3_name)</span>
<span id="cb7-96"></span>
<span id="cb7-97"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># clean up and delete wav</span></span>
<span id="cb7-98"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">file.exists</span>(wav_name)){</span>
<span id="cb7-99">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">file.remove</span>(wav_name)</span>
<span id="cb7-100">}</span></code></pre></div>
</details>
</div>
<p><audio controls=""> <source src="rando_ramp.mp3" type="audio/wav"> </audio></p>
<p>A ramp up and down of sorts was added. Didn’t achieve ludicrous levels so much in the middle. Clocking out on this.</p>


</section>

 ]]></description>
  <category>midiblender</category>
  <category>fun</category>
  <guid>https://homophony.quest/blog/43_2_9_24_max_random/</guid>
  <pubDate>Fri, 09 Feb 2024 05:00:00 GMT</pubDate>
  <media:content url="https://homophony.quest/blog/43_2_9_24_max_random/cover.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>Analyzing and filtering note occurence by point estimation</title>
  <dc:creator>Matt Crump</dc:creator>
  <link>https://homophony.quest/blog/42_2_8_24_prob_filter/</link>
  <description><![CDATA[ 




<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> diffusers <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> DiffusionPipeline</span>
<span id="cb1-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> transformers <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> set_seed</span>
<span id="cb1-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> PIL <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> Image</span>
<span id="cb1-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> torch</span>
<span id="cb1-5"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> random</span>
<span id="cb1-6"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> ssl</span>
<span id="cb1-7"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> os</span>
<span id="cb1-8">ssl._create_default_https_context <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ssl._create_unverified_context</span>
<span id="cb1-9"></span>
<span id="cb1-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#locate library</span></span>
<span id="cb1-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#model_id = "./stable-diffusion-v1-5"</span></span>
<span id="cb1-12">model_id <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dreamshaper-xl-turbo"</span></span>
<span id="cb1-13"></span>
<span id="cb1-14">pipeline <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> DiffusionPipeline.from_pretrained(</span>
<span id="cb1-15">    pretrained_model_name_or_path <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../../../../bigFiles/huggingface/dreamshaper-xl-turbo/"</span></span>
<span id="cb1-16">)</span>
<span id="cb1-17"></span>
<span id="cb1-18">pipeline <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pipeline.to(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mps"</span>)</span>
<span id="cb1-19"></span>
<span id="cb1-20"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Recommended if your computer has &lt; 64 GB of RAM</span></span>
<span id="cb1-21">pipeline.enable_attention_slicing(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"max"</span>)</span>
<span id="cb1-22"></span>
<span id="cb1-23">prompt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"futuristic vacuum cleaner on white background. sucking up probabilities of musical notes. cartoon. 80s retro."</span></span>
<span id="cb1-24"></span>
<span id="cb1-25"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> s <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>):</span>
<span id="cb1-26">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> n <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>]:</span>
<span id="cb1-27">    seed <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> s<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span></span>
<span id="cb1-28">    num_steps <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> n<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb1-29">    set_seed(seed)</span>
<span id="cb1-30">    </span>
<span id="cb1-31">    image <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pipeline(prompt,height <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1024</span>,width <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1024</span>,num_images_per_prompt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,num_inference_steps<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>num_steps)</span>
<span id="cb1-32">    </span>
<span id="cb1-33">    image_name <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"images/synth_</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">_</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">.jpeg"</span></span>
<span id="cb1-34">    </span>
<span id="cb1-35">    image_save <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> image.images[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].save(image_name.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">format</span>(seed,num_steps))</span></code></pre></div>
</details>
</div>
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><img src="https://homophony.quest/blog/42_2_8_24_prob_filter/cover.jpg" class="img-fluid quarto-figure quarto-figure-left figure-img" style="width:50.0%"></p>
</figure>
</div>

<div class="no-row-height column-margin column-container"><div class="">
<p>futuristic vacuum cleaner on white background. sucking up probabilities of musical notes. cartoon. 80s retro.</p>
</div></div><p>There’s many ideas swirling around leading me to this MIDI mangling experiment. My preference would be to discuss them in advance of the code, but I’m going to mostly resist that urge. Perhaps another time.</p>
<p>Getting right into then, let’s use <a href="https://www.crumplab.com/midiblender/">midiblender</a> to import the mario music into a matrix.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(midiblender)</span>
<span id="cb2-2"></span>
<span id="cb2-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#import midi</span></span>
<span id="cb2-4">mario <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">midi_to_object</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"all_overworld.mid"</span>)</span>
<span id="cb2-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list2env</span>(mario, .GlobalEnv) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># send objects to global environment</span></span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;environment: R_GlobalEnv&gt;</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># convert midi to matrix</span></span>
<span id="cb4-2">piano_roll <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">midi_df_to_matrix</span>(midi_df,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">track=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb4-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dim</span>(piano_roll)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1]   128 14113</code></pre>
</div>
</div>
<p>The <code>piano_roll</code> matrix has 128 rows for each possible midi note, and 14113 columns for each midi time tick. All of the notes are coded as 1s in this matrix. All other cells are set to 0.</p>
<section id="point-estimates-of-note-occurrence-probability" class="level2">
<h2 class="anchored" data-anchor-id="point-estimates-of-note-occurrence-probability">Point estimates of note occurrence probability</h2>
<p>Let’s do a bit of data analysis. How many notes occur in this midi file?</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(piano_roll)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 901</code></pre>
</div>
</div>
<p>What are the frequencies of each note across the song?</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1">note_frequencies <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rowSums</span>(piano_roll)</span>
<span id="cb8-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(note_frequencies)</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://homophony.quest/blog/42_2_8_24_prob_filter/index_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Most of the notes are between MIDI note 40ish and 85ish. The most frequent note is clocking in around 90 occurences.</p>
<p>Dividing the vector of note frequencies by the total sum gives point estimates of the probabilities for each note.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1">note_probabilities <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> note_frequencies<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(note_frequencies)</span>
<span id="cb9-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sort</span>(note_probabilities))</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://homophony.quest/blog/42_2_8_24_prob_filter/index_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>There a quick sorted plot, most notes have 0 probability of occurrence, and then it swings up to a max of 0.1054384. Neato.</p>
<p>In previous posts I’ve been taking point estimation much further in terms of reshaping the matrix and estimating probabilities for notes in particular time slices. I haven’t yet tried doing something simple like the above, and using only these probabilities to generate new sequences. And, I’m not going to do that here either.</p>
</section>
<section id="filtering-note-occurrences-by-point-estimates." class="level2">
<h2 class="anchored" data-anchor-id="filtering-note-occurrences-by-point-estimates.">Filtering note occurrences by point estimates.</h2>
<p>I have a bunch of things I want to try with this, but in this post I’ll keep it simple to get the idea down.</p>
<p>Here’s a simple filtering idea. Remove notes from the original piece depending on their point estimates. We could listen to mario with all of the high probability notes removed, or all of the low probability notes removed, or whatever combo one desires.</p>
<p>The more complicated plans involve deriving point estimates for conditional probabilities based on prior note occurrence, and/or note x time probabilities, and then filtering notes on that basis.</p>
<p>Before I do that, here’s a short digression. Consider listening to note sequences as an exercise in dynamic expectation. This is a pretty common notion in music and music cognition. You hear notes over time as they repeat and change, and have feelings of expectation about what comes next.</p>
<p>Let’s say you are a note accumulator matrix, like the piano roll. As you accumulate note occurrences, some happen more often than others. If the music has repetitive structure, then there could be a sense of expectation. The new notes might have the same frequency profiles as the old notes, giving a sense of congruency…this is what the matrix was expecting. The new notes might have different frequencies, violating the expectation of the matrix, but nevertheless adding to the total accumulation of notes…the matrix would be less surprised about similar deviations the next time. Apologies for over-anthropomorphizing the matrix.</p>
<p>The point estimates above are very global point estimates of note probability taken over all local contexts. After listening to mario music on repeat, as I did for who knows how long as a kid, these probabilities represent a kind of mean expectation about what notes I should be hearing in general.</p>
<p>I don’t know the music analysis literature well enough to know what this would be called, but it would be pretty straightforward to look at notes in a musical piece in terms of how they deviate from their point estimates. And, there are lots of interesting questions here about which point estimates to choose. Ones from the song, or set of songs like it, or a massive corpus of midi files, or a person’s entire listening experience. But, the analysis stuff is for another day.</p>
<p>Gotta reign in this digression. One point is there seems to be some interesting applied value in being able to quickly code notes in terms of their point estimates. It’ll be super easy to do this in R. For example, we would just replace all the 1s in each row of the piano matrix with their respective point estimates.</p>
<p>Fortunately, R does the <a href="https://en.wikipedia.org/wiki/Hadamard_product_(matrices)">hadamard product</a>, so it’s just this.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1">point_estimate_matrix <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> piano_roll <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> note_probabilities</span></code></pre></div>
</details>
</div>
<p>Great, so what do we do with the new matrix? Lots of possibilities come to mind. This could be a quick way to edit for wrong notes. If this was a recorded performance, and you accidentally flubbed a couple notes, these could be low frequency occurrences with very low probability of occurrence. Just delete the really low probability notes and re-constitute the midi file from the matrix.</p>
<p>Need to be delicate with the low probability notes, they might be really surprising and special. Maybe there needs to be more low probability notes.</p>
<p>The goal of this post was to listen to mario with high probability notes deleted, or with low probability notes deleted. We’ll do both. I suspect the technique could be interesting also with respect to probabilistically generated notes, many of which sound awful. Maybe tracking them and deleting them by their point estimates could make the probabilistic sequences sound “better”. If I think about this in terms of a eurorack module, I don’t really care how musical it sounds, I just want a knob to turn and mangle the probabilities in any direction for fun timez.</p>
<p>No more digression, let’s do this thing.</p>
</section>
<section id="high-pass-probability-filtering-mario-without-high-probability-notes" class="level2">
<h2 class="anchored" data-anchor-id="high-pass-probability-filtering-mario-without-high-probability-notes">High pass probability filtering: Mario without high probability notes</h2>
<p>Did a quick check and notes with a higher than 5% point estimate account for about 56% of all of the note occurrences. These notes get played a lot in mario.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(note_probabilities[note_probabilities <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">05</span>])</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.5615982</code></pre>
</div>
</div>
<p>OK, bye bye high frequency notes. Setting those ones to 0. Setting all other values to 1, converting this back into a note occurrence matrix.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1">mario_no_high <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> point_estimate_matrix</span>
<span id="cb13-2">mario_no_high[mario_no_high <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">05</span>] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb13-3">mario_no_high[mario_no_high <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> </span></code></pre></div>
</details>
</div>
<p>Now, a bit of {midiblender} magic, and let’s turn this matrix back into a midi file and listen to it.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1">track_0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">copy_midi_df_track</span>(midi_df,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">track_num =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb14-2"></span>
<span id="cb14-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># transform back to midi</span></span>
<span id="cb14-4">midi_time_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix_to_midi_time</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">midi_matrix =</span> mario_no_high,</span>
<span id="cb14-5">                                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">smallest_time_unit =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,</span>
<span id="cb14-6">                                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note_off_length =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>)</span>
<span id="cb14-7"></span>
<span id="cb14-8">meta_messages_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_midi_meta_df</span>(track_0)</span>
<span id="cb14-9"></span>
<span id="cb14-10">meta_messages_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set_midi_tempo_meta</span>(meta_messages_df,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">update_tempo =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">500000</span>)</span>
<span id="cb14-11"></span>
<span id="cb14-12">split_meta_messages_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">split_meta_df</span>(meta_messages_df)</span>
<span id="cb14-13"></span>
<span id="cb14-14">new_midi_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix_to_midi_track</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">midi_time_df =</span> midi_time_df,</span>
<span id="cb14-15">                                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">split_meta_list =</span> split_meta_messages_df,</span>
<span id="cb14-16">                                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">channel =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb14-17">                                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">velocity =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>)</span>
<span id="cb14-18"></span>
<span id="cb14-19"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">#### bounce</span></span>
<span id="cb14-20"></span>
<span id="cb14-21"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># update miditapyr df</span></span>
<span id="cb14-22">miditapyr_object<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>midi_frame_unnested<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">update_unnested_mf</span>(new_midi_df)</span>
<span id="cb14-23"></span>
<span id="cb14-24"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#write midi file to disk</span></span>
<span id="cb14-25">miditapyr_object<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">write_file</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mario_no_high.mid"</span>)</span>
<span id="cb14-26"></span>
<span id="cb14-27"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">#########</span></span>
<span id="cb14-28"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># bounce to mp3 with fluid synth</span></span>
<span id="cb14-29"></span>
<span id="cb14-30">track_name <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mario_no_high"</span></span>
<span id="cb14-31"></span>
<span id="cb14-32">wav_name <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(track_name,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">".wav"</span>)</span>
<span id="cb14-33">midi_name <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(track_name,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">".mid"</span>)</span>
<span id="cb14-34">mp3_name <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(track_name,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">".mp3"</span>)</span>
<span id="cb14-35"></span>
<span id="cb14-36"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># synthesize midi file to wav with fluid synth</span></span>
<span id="cb14-37">system_command <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> glue<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">glue</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'fluidsynth -F {wav_name} ~/Library/Audio/Sounds/Banks/nintendo_soundfont.sf2 {midi_name}'</span>)</span>
<span id="cb14-38"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">system</span>(system_command)</span>
<span id="cb14-39"></span>
<span id="cb14-40"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># convert wav to mp3</span></span>
<span id="cb14-41">av<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">av_audio_convert</span>(wav_name,mp3_name)</span>
<span id="cb14-42"></span>
<span id="cb14-43"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># clean up and delete wav</span></span>
<span id="cb14-44"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">file.exists</span>(wav_name)){</span>
<span id="cb14-45">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">file.remove</span>(wav_name)</span>
<span id="cb14-46">}</span></code></pre></div>
</details>
</div>
<p><audio controls=""> <source src="mario_no_high.mp3" type="audio/wav"> </audio></p>
<p>Well, half of the notes are gone, and it sounds pretty sparse. Very cool function though.</p>
</section>
<section id="low-pass-probability-filtering-mario-without-low-probability-notes" class="level2">
<h2 class="anchored" data-anchor-id="low-pass-probability-filtering-mario-without-low-probability-notes">Low pass probability filtering: Mario without low probability notes</h2>
<p>Let’s do the opposite, and take out the low probability notes. It will be even more sparse using .05 as the cutoff. But it must be done.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(note_probabilities[note_probabilities <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">05</span>])</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.4384018</code></pre>
</div>
</div>
<p>OK, bye bye high frequency notes. Setting those ones to 0. Setting all other values to 1, converting this back into a note occurrence matrix.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1">mario_no_low <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> point_estimate_matrix</span>
<span id="cb17-2">mario_no_low[mario_no_low <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">05</span>] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb17-3">mario_no_low[mario_no_low <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> </span></code></pre></div>
</details>
</div>
<p>Now, a bit of {midiblender} magic, and let’s turn this matrix back into a midi file and listen to it.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1">track_0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">copy_midi_df_track</span>(midi_df,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">track_num =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb18-2"></span>
<span id="cb18-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># transform back to midi</span></span>
<span id="cb18-4">midi_time_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix_to_midi_time</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">midi_matrix =</span> mario_no_low,</span>
<span id="cb18-5">                                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">smallest_time_unit =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,</span>
<span id="cb18-6">                                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note_off_length =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>)</span>
<span id="cb18-7"></span>
<span id="cb18-8">meta_messages_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_midi_meta_df</span>(track_0)</span>
<span id="cb18-9"></span>
<span id="cb18-10">meta_messages_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set_midi_tempo_meta</span>(meta_messages_df,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">update_tempo =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">500000</span>)</span>
<span id="cb18-11"></span>
<span id="cb18-12">split_meta_messages_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">split_meta_df</span>(meta_messages_df)</span>
<span id="cb18-13"></span>
<span id="cb18-14">new_midi_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix_to_midi_track</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">midi_time_df =</span> midi_time_df,</span>
<span id="cb18-15">                                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">split_meta_list =</span> split_meta_messages_df,</span>
<span id="cb18-16">                                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">channel =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb18-17">                                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">velocity =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>)</span>
<span id="cb18-18"></span>
<span id="cb18-19"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">#### bounce</span></span>
<span id="cb18-20"></span>
<span id="cb18-21"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># update miditapyr df</span></span>
<span id="cb18-22">miditapyr_object<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>midi_frame_unnested<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">update_unnested_mf</span>(new_midi_df)</span>
<span id="cb18-23"></span>
<span id="cb18-24"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#write midi file to disk</span></span>
<span id="cb18-25">miditapyr_object<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">write_file</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mario_no_low.mid"</span>)</span>
<span id="cb18-26"></span>
<span id="cb18-27"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">#########</span></span>
<span id="cb18-28"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># bounce to mp3 with fluid synth</span></span>
<span id="cb18-29"></span>
<span id="cb18-30">track_name <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mario_no_low"</span></span>
<span id="cb18-31"></span>
<span id="cb18-32">wav_name <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(track_name,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">".wav"</span>)</span>
<span id="cb18-33">midi_name <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(track_name,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">".mid"</span>)</span>
<span id="cb18-34">mp3_name <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(track_name,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">".mp3"</span>)</span>
<span id="cb18-35"></span>
<span id="cb18-36"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># synthesize midi file to wav with fluid synth</span></span>
<span id="cb18-37">system_command <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> glue<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">glue</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'fluidsynth -F {wav_name} ~/Library/Audio/Sounds/Banks/nintendo_soundfont.sf2 {midi_name}'</span>)</span>
<span id="cb18-38"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">system</span>(system_command)</span>
<span id="cb18-39"></span>
<span id="cb18-40"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># convert wav to mp3</span></span>
<span id="cb18-41">av<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">av_audio_convert</span>(wav_name,mp3_name)</span>
<span id="cb18-42"></span>
<span id="cb18-43"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># clean up and delete wav</span></span>
<span id="cb18-44"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">file.exists</span>(wav_name)){</span>
<span id="cb18-45">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">file.remove</span>(wav_name)</span>
<span id="cb18-46">}</span></code></pre></div>
</details>
</div>
<p><audio controls=""> <source src="mario_no_low.mp3" type="audio/wav"> </audio></p>
<p>Again, pretty sparse, but emphasizing different aspects of mario.</p>
</section>
<section id="conclusions-i-want-a-eurorack-module-for-this" class="level2">
<h2 class="anchored" data-anchor-id="conclusions-i-want-a-eurorack-module-for-this">Conclusions: I want a eurorack module for this</h2>
<p>I wish I could just dial around a knob, like a filter knob, that did this to a midi file while it was playing. Maybe someday I’ll figure out how to do that for a eurorack module.</p>
<p>These examples didn’t sound like much, but whatever. I could imagine this being very useful in general. For example, it would be nice to step back and look some composition and quickly appreciate what the spread of point estimates are. Maybe it is too regular, so you filter down the high probability stuff, or the opposite. It would be fun to have an equalizer like situation, where instead of emphasizing different wave frequencies, it allowed one to bring up or down different note probabilities. I think this would have really interesting effects, especially on super dense improvisational stuff, where I would probably want to delete things, and being able to do that on the basis of probabilities seems promising.</p>
<p>This is just a quick and dirty example, will fool around with this more for sure.</p>


</section>

 ]]></description>
  <category>midiblender</category>
  <category>probabilistic filtering</category>
  <category>rstatsmusic</category>
  <category>midi</category>
  <category>rstats</category>
  <guid>https://homophony.quest/blog/42_2_8_24_prob_filter/</guid>
  <pubDate>Thu, 08 Feb 2024 05:00:00 GMT</pubDate>
  <media:content url="https://homophony.quest/blog/42_2_8_24_prob_filter/cover.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>{midiblender} is alive!</title>
  <dc:creator>Matt Crump</dc:creator>
  <link>https://homophony.quest/blog/41_2_8_24_midiblender_alive/</link>
  <description><![CDATA[ 




<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> diffusers <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> DiffusionPipeline</span>
<span id="cb1-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> transformers <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> set_seed</span>
<span id="cb1-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> PIL <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> Image</span>
<span id="cb1-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> torch</span>
<span id="cb1-5"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> random</span>
<span id="cb1-6"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> ssl</span>
<span id="cb1-7"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> os</span>
<span id="cb1-8">ssl._create_default_https_context <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ssl._create_unverified_context</span>
<span id="cb1-9"></span>
<span id="cb1-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#locate library</span></span>
<span id="cb1-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#model_id = "./stable-diffusion-v1-5"</span></span>
<span id="cb1-12">model_id <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dreamshaper-xl-turbo"</span></span>
<span id="cb1-13"></span>
<span id="cb1-14">pipeline <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> DiffusionPipeline.from_pretrained(</span>
<span id="cb1-15">    pretrained_model_name_or_path <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../../../../bigFiles/huggingface/dreamshaper-xl-turbo/"</span></span>
<span id="cb1-16">)</span>
<span id="cb1-17"></span>
<span id="cb1-18">pipeline <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pipeline.to(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mps"</span>)</span>
<span id="cb1-19"></span>
<span id="cb1-20"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Recommended if your computer has &lt; 64 GB of RAM</span></span>
<span id="cb1-21">pipeline.enable_attention_slicing(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"max"</span>)</span>
<span id="cb1-22"></span>
<span id="cb1-23">prompt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blender on white background. blender blending musical notes. cartoon. 80s retro."</span></span>
<span id="cb1-24"></span>
<span id="cb1-25"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> s <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>):</span>
<span id="cb1-26">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> n <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>]:</span>
<span id="cb1-27">    seed <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> s<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span></span>
<span id="cb1-28">    num_steps <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> n<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb1-29">    set_seed(seed)</span>
<span id="cb1-30">    </span>
<span id="cb1-31">    image <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pipeline(prompt,height <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1024</span>,width <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1024</span>,num_images_per_prompt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,num_inference_steps<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>num_steps)</span>
<span id="cb1-32">    </span>
<span id="cb1-33">    image_name <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"images/synth_</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">_</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">.jpeg"</span></span>
<span id="cb1-34">    </span>
<span id="cb1-35">    image_save <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> image.images[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].save(image_name.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">format</span>(seed,num_steps))</span></code></pre></div>
</details>
</div>
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><img src="https://homophony.quest/blog/41_2_8_24_midiblender_alive/cover.jpg" class="img-fluid quarto-figure quarto-figure-left figure-img" style="width:50.0%"></p>
</figure>
</div>

<div class="no-row-height column-margin column-container"><div class="">
<p>R stats package logo</p>
</div></div><p>A super quick post to say that <a href="https://www.crumplab.com/midiblender/">midiblender</a> is alive on github.</p>
<p>The github repo is: <a href="https://github.com/CrumpLab/midiblender" class="uri">https://github.com/CrumpLab/midiblender</a></p>
<p>This is the beginnings of an #rstats package for experimental mangling of #MIDI files. TBH, it’s my personal experimental hacky-code base wrapped in R package clothing. I’m messing with it constantly, and sharing in case others are interested.</p>
<p>I wrote a <a href="https://www.crumplab.com/midiblender/articles/Getting_started.html">getting starting vignette</a> that could be helpful for others to try stuff out.</p>
<p>Otherwise, I’m planning to keep posting examples and experiments on this blog. So, more {midiblender} to come.</p>



 ]]></description>
  <category>midiblender</category>
  <category>generativemusic</category>
  <category>rstatsmusic</category>
  <category>midi</category>
  <category>rstats</category>
  <guid>https://homophony.quest/blog/41_2_8_24_midiblender_alive/</guid>
  <pubDate>Thu, 08 Feb 2024 05:00:00 GMT</pubDate>
  <media:content url="https://homophony.quest/blog/41_2_8_24_midiblender_alive/cover.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>Midi blending Canon in D probabilistically</title>
  <dc:creator>Matt Crump</dc:creator>
  <link>https://homophony.quest/blog/40_2_7_24_midiblender_canon/</link>
  <description><![CDATA[ 




<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> diffusers <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> DiffusionPipeline</span>
<span id="cb1-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> transformers <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> set_seed</span>
<span id="cb1-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> PIL <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> Image</span>
<span id="cb1-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> torch</span>
<span id="cb1-5"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> random</span>
<span id="cb1-6"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> ssl</span>
<span id="cb1-7"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> os</span>
<span id="cb1-8">ssl._create_default_https_context <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ssl._create_unverified_context</span>
<span id="cb1-9"></span>
<span id="cb1-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#locate library</span></span>
<span id="cb1-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#model_id = "./stable-diffusion-v1-5"</span></span>
<span id="cb1-12">model_id <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dreamshaper-xl-turbo"</span></span>
<span id="cb1-13"></span>
<span id="cb1-14">pipeline <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> DiffusionPipeline.from_pretrained(</span>
<span id="cb1-15">    pretrained_model_name_or_path <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../../../../bigFiles/huggingface/dreamshaper-xl-turbo/"</span></span>
<span id="cb1-16">)</span>
<span id="cb1-17"></span>
<span id="cb1-18">pipeline <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pipeline.to(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mps"</span>)</span>
<span id="cb1-19"></span>
<span id="cb1-20"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Recommended if your computer has &lt; 64 GB of RAM</span></span>
<span id="cb1-21">pipeline.enable_attention_slicing(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"max"</span>)</span>
<span id="cb1-22"></span>
<span id="cb1-23">prompt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blender on white background. blender blending musical notes. cartoon. 80s retro."</span></span>
<span id="cb1-24"></span>
<span id="cb1-25"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> s <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>):</span>
<span id="cb1-26">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> n <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>]:</span>
<span id="cb1-27">    seed <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> s<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span></span>
<span id="cb1-28">    num_steps <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> n<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb1-29">    set_seed(seed)</span>
<span id="cb1-30">    </span>
<span id="cb1-31">    image <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pipeline(prompt,height <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1024</span>,width <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1024</span>,num_images_per_prompt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,num_inference_steps<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>num_steps)</span>
<span id="cb1-32">    </span>
<span id="cb1-33">    image_name <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"images/synth_</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">_</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">.jpeg"</span></span>
<span id="cb1-34">    </span>
<span id="cb1-35">    image_save <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> image.images[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].save(image_name.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">format</span>(seed,num_steps))</span></code></pre></div>
</details>
</div>
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><img src="https://homophony.quest/blog/40_2_7_24_midiblender_canon/cover.jpg" class="img-fluid quarto-figure quarto-figure-left figure-img" style="width:50.0%"></p>
</figure>
</div>

<div class="no-row-height column-margin column-container"><div class="">
<p>Probabilistically generated sheet music.</p>
</div></div><p>Still working on {midiblender} here. Check out <a href="https://homophony.quest/notes.html">past posts for more info</a>.</p>
<p>Another quick post with some code and mp3 examples. I’m waffling on whether to share {midiblender} on github sooner than later. It’s in a personally usable state, which is my intended use case. I guess my inclination is to share in case others find the code helpful, with a big warning that “it might not blend”. I’m too new to processing midi files, and the code is not general enough to handle lots of aspects of midi files. Anyway, on with the post.</p>
<p>This one is basically an extension of what I was doing with the mario overworld theme <a href="https://homophony.quest/blog/39_2_7_24_midiblender_mario/">in the last post</a>.</p>
<p>Instead of mario, this time I’m importing Pachelbel’s Canon in D. It’s not the most well-articulated midi file, but it is recognizable as the Canon in D. One goal is make sure my code will mangle other midi files, so I’m kicking the tires here.</p>
<section id="endless-canon-in-probabilid" class="level2">
<h2 class="anchored" data-anchor-id="endless-canon-in-probabilid">Endless Canon in ProbabiliD</h2>
<p>In this example I slice up the midi file into small temporal intervals, like 2 beats of a bar, and represent each of them in a pitch x midi ticks matrix. Using this matrix I compute probabilities of each note in time within the bar, and then generate new notes based on those probabilities. There is a little bit more going on to make it slightly more musically. I start with the first two beats in the song and compute a measure of similarity between them, and all other 2 beat slices. I take the slices that have some positive similarity and compute the note and time probabilities from this smaller set. I have it set up so that when I generate notes from these probabilities (by sampling from binomial distributions), I also sample notes from the probabilities for the next beat. I then use those probabilities in the next step to filter the matrix for most similar bars, and so on.</p>
<p>It’s endless in the sense that I could run the loop for much longer and it would keep going, but I stopped it to get about 3 minutes out.</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(midiblender)</span>
<span id="cb2-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#import midi</span></span>
<span id="cb2-3">mario <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">midi_to_object</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"canon.mid"</span>)</span>
<span id="cb2-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list2env</span>(mario, .GlobalEnv) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># send objects to global environment</span></span>
<span id="cb2-5">track_0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">copy_midi_df_track</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">midi_df =</span> midi_df,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">track_num =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb2-6"></span>
<span id="cb2-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># convert to a piano roll matrix</span></span>
<span id="cb2-8">all_midi <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">midi_df_to_matrix</span>(midi_df,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">track=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb2-9"></span>
<span id="cb2-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># reshape to desired interval</span></span>
<span id="cb2-11">music_matrix <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">reshape_piano_roll</span>(all_midi,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">96</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb2-12"></span>
<span id="cb2-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># probabilistic sampling</span></span>
<span id="cb2-14"></span>
<span id="cb2-15"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># create conditional vector</span></span>
<span id="cb2-16">conditional_vector <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dim</span>(music_matrix)[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>])</span>
<span id="cb2-17">conditional_vector <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> music_matrix[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,]</span>
<span id="cb2-18">dot_products <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> conditional_vector <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%*%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t</span>(music_matrix)</span>
<span id="cb2-19">positive_similarity <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">which</span>(dot_products <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb2-20"></span>
<span id="cb2-21"></span>
<span id="cb2-22">feature_probs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_feature_probs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">midi_matrix =</span> music_matrix[positive_similarity,])</span>
<span id="cb2-23"></span>
<span id="cb2-24">mean_note_density <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_mean_note_density</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">midi_matrix =</span> music_matrix[positive_similarity,])</span>
<span id="cb2-25"></span>
<span id="cb2-26">new_features <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">new_features_from_probs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">probs =</span> feature_probs,</span>
<span id="cb2-27">                                        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">density =</span> mean_note_density,</span>
<span id="cb2-28">                                        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">examples =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb2-29"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># loop</span></span>
<span id="cb2-30">new_feature_vectors <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> new_features</span>
<span id="cb2-31"></span>
<span id="cb2-32"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span>(i <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>) {</span>
<span id="cb2-33">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># put second half into conditional vector</span></span>
<span id="cb2-34">  conditional_vector <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(new_features[((<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(new_features)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(new_features)],</span>
<span id="cb2-35">                          <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(new_features)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>))</span>
<span id="cb2-36">  dot_products <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> conditional_vector <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%*%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t</span>(music_matrix)</span>
<span id="cb2-37">  positive_similarity <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">which</span>(dot_products <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb2-38">  </span>
<span id="cb2-39">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(positive_similarity)  <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>){</span>
<span id="cb2-40">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># sample some random stuff</span></span>
<span id="cb2-41">    positive_similarity <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dim</span>(music_matrix)[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>],<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">25</span>)</span>
<span id="cb2-42">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(i)</span>
<span id="cb2-43">  }</span>
<span id="cb2-44">  </span>
<span id="cb2-45">  </span>
<span id="cb2-46">  feature_probs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span></span>
<span id="cb2-47">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_feature_probs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">midi_matrix =</span> music_matrix[positive_similarity, ])</span>
<span id="cb2-48">  </span>
<span id="cb2-49">  mean_note_density <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span></span>
<span id="cb2-50">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_mean_note_density</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">midi_matrix =</span> music_matrix[positive_similarity, ])</span>
<span id="cb2-51">  </span>
<span id="cb2-52">  new_features <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">new_features_from_probs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">probs =</span> feature_probs,</span>
<span id="cb2-53">                                          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">density =</span> mean_note_density,</span>
<span id="cb2-54">                                          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">examples =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb2-55">  new_feature_vectors <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbind</span>(new_feature_vectors,new_features)</span>
<span id="cb2-56">}</span>
<span id="cb2-57"></span>
<span id="cb2-58">new_matrix <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">feature_vector_to_matrix</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vec =</span> new_feature_vectors,</span>
<span id="cb2-59">                                       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">num_notes =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">128</span>)</span>
<span id="cb2-60"></span>
<span id="cb2-61"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># transform back to midi</span></span>
<span id="cb2-62">midi_time_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix_to_midi_time</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">midi_matrix =</span> new_matrix,</span>
<span id="cb2-63">                                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">smallest_time_unit =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,</span>
<span id="cb2-64">                                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note_off_length =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>)</span>
<span id="cb2-65"></span>
<span id="cb2-66">meta_messages_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_midi_meta_df</span>(track_0)</span>
<span id="cb2-67"></span>
<span id="cb2-68">meta_messages_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set_midi_tempo_meta</span>(meta_messages_df,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">update_tempo =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000000</span>)</span>
<span id="cb2-69"></span>
<span id="cb2-70">split_meta_messages_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">split_meta_df</span>(meta_messages_df)</span>
<span id="cb2-71"></span>
<span id="cb2-72">new_midi_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix_to_midi_track</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">midi_time_df =</span> midi_time_df,</span>
<span id="cb2-73">                                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">split_meta_list =</span> split_meta_messages_df,</span>
<span id="cb2-74">                                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">channel =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb2-75">                                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">velocity =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>)</span>
<span id="cb2-76"></span>
<span id="cb2-77"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">#### bounce</span></span>
<span id="cb2-78"></span>
<span id="cb2-79"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># update miditapyr df</span></span>
<span id="cb2-80">miditapyr_object<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>midi_frame_unnested<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">update_unnested_mf</span>(new_midi_df)</span>
<span id="cb2-81"></span>
<span id="cb2-82"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#write midi file to disk</span></span>
<span id="cb2-83">miditapyr_object<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">write_file</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"endless_canon.mid"</span>)</span>
<span id="cb2-84"></span>
<span id="cb2-85"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">#########</span></span>
<span id="cb2-86"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># bounce to mp3 with fluid synth</span></span>
<span id="cb2-87"></span>
<span id="cb2-88">track_name <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"endless_canon"</span></span>
<span id="cb2-89"></span>
<span id="cb2-90">wav_name <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(track_name,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">".wav"</span>)</span>
<span id="cb2-91">midi_name <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(track_name,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">".mid"</span>)</span>
<span id="cb2-92">mp3_name <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(track_name,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">".mp3"</span>)</span>
<span id="cb2-93"></span>
<span id="cb2-94"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># synthesize midi file to wav with fluid synth</span></span>
<span id="cb2-95">system_command <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> glue<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">glue</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'fluidsynth -F {wav_name} ~/Library/Audio/Sounds/Banks/FluidR3_GM.sf2 {midi_name}'</span>)</span>
<span id="cb2-96"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">system</span>(system_command)</span>
<span id="cb2-97"></span>
<span id="cb2-98"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># convert wav to mp3</span></span>
<span id="cb2-99">av<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">av_audio_convert</span>(wav_name,mp3_name)</span>
<span id="cb2-100"></span>
<span id="cb2-101"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># clean up and delete wav</span></span>
<span id="cb2-102"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">file.exists</span>(wav_name)){</span>
<span id="cb2-103">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">file.remove</span>(wav_name)</span>
<span id="cb2-104">}</span></code></pre></div>
</details>
</div>
<p><audio controls=""> <source src="endless_canon.mp3" type="audio/wav"> </audio></p>
<p>It sounds like a probabilistic mess, but there are moments with some resemblance to Canon in D. The fluid synth piano sound helps with the cheese factor. Also, my code ignores note length, so everything sounds a bit choppy.</p>
</section>
<section id="blending-the-mess" class="level2">
<h2 class="anchored" data-anchor-id="blending-the-mess">Blending the mess</h2>
<p>The next example offers a blending parameter. I split the original into 2 beat sections. Then I loop through each 2 beat slice. For each slice I compute note in time probabilities and then generate a 2 beat probabilistic sequence. At the end, I have all of the original 2 beat sections, and another set of probabilistically generated ones. To construct the final tune, I blend them together in some proportion. In this case the proportion is 50/50.</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(midiblender)</span>
<span id="cb3-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#import midi</span></span>
<span id="cb3-3">mario <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">midi_to_object</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"canon.mid"</span>)</span>
<span id="cb3-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list2env</span>(mario, .GlobalEnv) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># send objects to global environment</span></span>
<span id="cb3-5">track_0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">copy_midi_df_track</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">midi_df =</span> midi_df,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">track_num =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb3-6"></span>
<span id="cb3-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># convert to a piano roll matrix</span></span>
<span id="cb3-8">all_midi <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">midi_df_to_matrix</span>(midi_df,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">track=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb3-9"></span>
<span id="cb3-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># reshape to desired interval</span></span>
<span id="cb3-11">music_matrix <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">reshape_piano_roll</span>(all_midi,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">96</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb3-12">probabilistic_matrix <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> music_matrix</span>
<span id="cb3-13"></span>
<span id="cb3-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># probabilistic sampling and blending</span></span>
<span id="cb3-15"></span>
<span id="cb3-16"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span>( i <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dim</span>(music_matrix)[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]){</span>
<span id="cb3-17"></span>
<span id="cb3-18">  conditional_vector <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> music_matrix[i,]</span>
<span id="cb3-19">  dot_products <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> conditional_vector <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%*%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t</span>(music_matrix)</span>
<span id="cb3-20">  positive_similarity <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">which</span>(dot_products <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb3-21">  </span>
<span id="cb3-22">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(positive_similarity)  <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>){</span>
<span id="cb3-23">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># sample some random stuff</span></span>
<span id="cb3-24">    positive_similarity <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dim</span>(music_matrix)[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>],<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">25</span>)</span>
<span id="cb3-25">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(i)</span>
<span id="cb3-26">  }</span>
<span id="cb3-27">  </span>
<span id="cb3-28">  </span>
<span id="cb3-29">  feature_probs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_feature_probs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">midi_matrix =</span> music_matrix[positive_similarity,])</span>
<span id="cb3-30">  </span>
<span id="cb3-31">  mean_note_density <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_mean_note_density</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">midi_matrix =</span> music_matrix[positive_similarity,])</span>
<span id="cb3-32">  </span>
<span id="cb3-33">  new_features <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">new_features_from_probs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">probs =</span> feature_probs,</span>
<span id="cb3-34">                                          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">density =</span> mean_note_density,</span>
<span id="cb3-35">                                          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">examples =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb3-36">  probabilistic_matrix[i,] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> new_features</span>
<span id="cb3-37">}</span>
<span id="cb3-38"></span>
<span id="cb3-39"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## blend</span></span>
<span id="cb3-40">blend_matrix <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> music_matrix</span>
<span id="cb3-41"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span>(i <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dim</span>(music_matrix)[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]){</span>
<span id="cb3-42">  sample_ids <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dim</span>(music_matrix)[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>])  </span>
<span id="cb3-43">  first_half <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(sample_ids)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb3-44">  blend_vector <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(sample_ids))</span>
<span id="cb3-45">  blend_vector[sample_ids[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>first_half]] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> music_matrix[i,sample_ids[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>first_half]]</span>
<span id="cb3-46">  blend_vector[sample_ids[(first_half<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(sample_ids)]] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> probabilistic_matrix[i,sample_ids[(first_half<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(sample_ids)]]</span>
<span id="cb3-47">  blend_matrix[i,] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> blend_vector</span>
<span id="cb3-48">}</span>
<span id="cb3-49"></span>
<span id="cb3-50"></span>
<span id="cb3-51"></span>
<span id="cb3-52">new_matrix <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">feature_vector_to_matrix</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vec =</span> blend_matrix,</span>
<span id="cb3-53">                                       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">num_notes =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">128</span>)</span>
<span id="cb3-54"></span>
<span id="cb3-55"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># transform back to midi</span></span>
<span id="cb3-56">midi_time_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix_to_midi_time</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">midi_matrix =</span> new_matrix,</span>
<span id="cb3-57">                                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">smallest_time_unit =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,</span>
<span id="cb3-58">                                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note_off_length =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>)</span>
<span id="cb3-59"></span>
<span id="cb3-60">meta_messages_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_midi_meta_df</span>(track_0)</span>
<span id="cb3-61"></span>
<span id="cb3-62">meta_messages_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set_midi_tempo_meta</span>(meta_messages_df,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">update_tempo =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000000</span>)</span>
<span id="cb3-63"></span>
<span id="cb3-64">split_meta_messages_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">split_meta_df</span>(meta_messages_df)</span>
<span id="cb3-65"></span>
<span id="cb3-66">new_midi_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix_to_midi_track</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">midi_time_df =</span> midi_time_df,</span>
<span id="cb3-67">                                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">split_meta_list =</span> split_meta_messages_df,</span>
<span id="cb3-68">                                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">channel =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb3-69">                                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">velocity =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>)</span>
<span id="cb3-70"></span>
<span id="cb3-71"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">#### bounce</span></span>
<span id="cb3-72"></span>
<span id="cb3-73"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># update miditapyr df</span></span>
<span id="cb3-74">miditapyr_object<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>midi_frame_unnested<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">update_unnested_mf</span>(new_midi_df)</span>
<span id="cb3-75"></span>
<span id="cb3-76"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#write midi file to disk</span></span>
<span id="cb3-77">miditapyr_object<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">write_file</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"endless_canon_2.mid"</span>)</span>
<span id="cb3-78"></span>
<span id="cb3-79"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">#########</span></span>
<span id="cb3-80"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># bounce to mp3 with fluid synth</span></span>
<span id="cb3-81"></span>
<span id="cb3-82">track_name <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"endless_canon_2"</span></span>
<span id="cb3-83"></span>
<span id="cb3-84">wav_name <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(track_name,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">".wav"</span>)</span>
<span id="cb3-85">midi_name <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(track_name,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">".mid"</span>)</span>
<span id="cb3-86">mp3_name <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(track_name,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">".mp3"</span>)</span>
<span id="cb3-87"></span>
<span id="cb3-88"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># synthesize midi file to wav with fluid synth</span></span>
<span id="cb3-89">system_command <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> glue<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">glue</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'fluidsynth -F {wav_name} ~/Library/Audio/Sounds/Banks/FluidR3_GM.sf2 {midi_name}'</span>)</span>
<span id="cb3-90"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">system</span>(system_command)</span>
<span id="cb3-91"></span>
<span id="cb3-92"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># convert wav to mp3</span></span>
<span id="cb3-93">av<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">av_audio_convert</span>(wav_name,mp3_name)</span>
<span id="cb3-94"></span>
<span id="cb3-95"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># clean up and delete wav</span></span>
<span id="cb3-96"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">file.exists</span>(wav_name)){</span>
<span id="cb3-97">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">file.remove</span>(wav_name)</span>
<span id="cb3-98">}</span></code></pre></div>
</details>
</div>
<p><audio controls=""> <source src="endless_canon_2.mp3" type="audio/wav"> </audio></p>
<p>Much more recognizable now, with 50% less probabilistic mess. Still sounds ridiculous. Nevertheless, I’m expecting some fun to start happening later, especially when running more interesting midi files through mr. modular synthesizer.</p>


</section>

 ]]></description>
  <category>midiblender</category>
  <category>generativemusic</category>
  <category>rstatsmusic</category>
  <category>midi</category>
  <category>rstats</category>
  <guid>https://homophony.quest/blog/40_2_7_24_midiblender_canon/</guid>
  <pubDate>Wed, 07 Feb 2024 05:00:00 GMT</pubDate>
  <media:content url="https://homophony.quest/blog/40_2_7_24_midiblender_canon/cover.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>WIP: Endless probabilistically generated mario music with midiblender</title>
  <dc:creator>Matt Crump</dc:creator>
  <link>https://homophony.quest/blog/39_2_7_24_midiblender_mario/</link>
  <description><![CDATA[ 




<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> diffusers <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> DiffusionPipeline</span>
<span id="cb1-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> transformers <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> set_seed</span>
<span id="cb1-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> PIL <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> Image</span>
<span id="cb1-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> torch</span>
<span id="cb1-5"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> random</span>
<span id="cb1-6"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> ssl</span>
<span id="cb1-7"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> os</span>
<span id="cb1-8">ssl._create_default_https_context <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ssl._create_unverified_context</span>
<span id="cb1-9"></span>
<span id="cb1-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#locate library</span></span>
<span id="cb1-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#model_id = "./stable-diffusion-v1-5"</span></span>
<span id="cb1-12">model_id <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dreamshaper-xl-turbo"</span></span>
<span id="cb1-13"></span>
<span id="cb1-14">pipeline <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> DiffusionPipeline.from_pretrained(</span>
<span id="cb1-15">    pretrained_model_name_or_path <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../../../../bigFiles/huggingface/dreamshaper-xl-turbo/"</span></span>
<span id="cb1-16">)</span>
<span id="cb1-17"></span>
<span id="cb1-18">pipeline <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pipeline.to(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mps"</span>)</span>
<span id="cb1-19"></span>
<span id="cb1-20"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Recommended if your computer has &lt; 64 GB of RAM</span></span>
<span id="cb1-21">pipeline.enable_attention_slicing(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"max"</span>)</span>
<span id="cb1-22"></span>
<span id="cb1-23">prompt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blender on white background. blender blending musical notes. cartoon. 80s retro."</span></span>
<span id="cb1-24"></span>
<span id="cb1-25"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> s <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>):</span>
<span id="cb1-26">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> n <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>]:</span>
<span id="cb1-27">    seed <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> s<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span></span>
<span id="cb1-28">    num_steps <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> n<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb1-29">    set_seed(seed)</span>
<span id="cb1-30">    </span>
<span id="cb1-31">    image <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pipeline(prompt,height <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1024</span>,width <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1024</span>,num_images_per_prompt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,num_inference_steps<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>num_steps)</span>
<span id="cb1-32">    </span>
<span id="cb1-33">    image_name <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"images/synth_</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">_</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">.jpeg"</span></span>
<span id="cb1-34">    </span>
<span id="cb1-35">    image_save <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> image.images[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].save(image_name.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">format</span>(seed,num_steps))</span></code></pre></div>
</details>
</div>
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><img src="https://homophony.quest/blog/39_2_7_24_midiblender_mario/cover.jpg" class="img-fluid quarto-figure quarto-figure-left figure-img" style="width:50.0%"></p>
</figure>
</div>

<div class="no-row-height column-margin column-container"><div class="">
<p>The current logo for my experimental r package</p>
</div></div><p>Another quick test post, but I am very excited about this one.</p>
<p>In past posts I’ve been doing things like importing midi files to R, such as the overworld music from the NES version of super mario brothers, and then <a href="https://homophony.quest/blog/33_2_1_24_rand_mario/">randomizing the notes</a>, or <a href="https://homophony.quest/blog/35_2_3_24_matrix_midi/">generating new sequences based off of probabilities computed from the music</a>.</p>
<p>Some of the ideas are <a href="https://homophony.quest/blog/37_2_5_24_matrix_analysis/">minimally explained here</a>, and in particular I had a goal of sampling new sequences based on <a href="https://homophony.quest/blog/37_2_5_24_matrix_analysis/#conditionalized-sampling-on-starting-notes">conditionalized starting conditions</a>. But, I didn’t have the code base in proper order to crunch those sequences.</p>
<p>So, yesterday I started on {midiblender}, an un-released R package, that now has the necessary code to accomplish my goal. You see, the previous ways of mangling mario were fun and interesting, and I approve of them. But, they got pretty stochastic sounding.</p>
<p>I don’t have time right now to really explain what I’m trying to do in detail, but it is basically this:</p>
<ol type="1">
<li>create a corpus (matrix) of feature vectors representing the note and time information for some temporal interval from the mario midi file. I’ve set it to 2 beats.</li>
<li>Pick a starting vector, such as the first chord in mario</li>
<li>filter the matrix for rows that have some similarity to the starting vector.</li>
<li>Calculate a probability vector for the notes and times from the filtered matrix.</li>
<li>Generate a new feature vector from the probabilities.</li>
<li>I have this set up in pairs, so I take the generated feature vector for the second beat, and use it as the next starting vector.</li>
<li>repeat to generate as many beats worth as you want.</li>
</ol>
<p>The result should still be fairly probabilistic sounding, but more mario sequency sounding than before.</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(midiblender)</span>
<span id="cb2-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#import midi</span></span>
<span id="cb2-3">mario <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">midi_to_object</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"all_overworld.mid"</span>)</span>
<span id="cb2-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list2env</span>(mario, .GlobalEnv) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># send objects to global environment</span></span>
<span id="cb2-5">track_0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">copy_midi_df_track</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">midi_df =</span> midi_df,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">track_num =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb2-6"></span>
<span id="cb2-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># convert to a piano roll matrix</span></span>
<span id="cb2-8">all_midi <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">midi_df_to_matrix</span>(midi_df,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">track=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb2-9"></span>
<span id="cb2-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># reshape to desired interval</span></span>
<span id="cb2-11">music_matrix <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">reshape_piano_roll</span>(all_midi,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">48</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb2-12"></span>
<span id="cb2-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># probabilistic sampling</span></span>
<span id="cb2-14"></span>
<span id="cb2-15"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># create conditional vector</span></span>
<span id="cb2-16">conditional_vector <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dim</span>(music_matrix)[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>])</span>
<span id="cb2-17">conditional_vector[(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">66</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">76</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> </span>
<span id="cb2-18">dot_products <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> conditional_vector <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%*%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t</span>(music_matrix)</span>
<span id="cb2-19">positive_similarity <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">which</span>(dot_products <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb2-20"></span>
<span id="cb2-21"></span>
<span id="cb2-22">feature_probs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_feature_probs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">midi_matrix =</span> music_matrix[positive_similarity,])</span>
<span id="cb2-23"></span>
<span id="cb2-24">mean_note_density <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_mean_note_density</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">midi_matrix =</span> music_matrix[positive_similarity,])</span>
<span id="cb2-25"></span>
<span id="cb2-26">new_features <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">new_features_from_probs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">probs =</span> feature_probs,</span>
<span id="cb2-27">                                        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">density =</span> mean_note_density,</span>
<span id="cb2-28">                                        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">examples =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb2-29"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># loop</span></span>
<span id="cb2-30">new_feature_vectors <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> new_features</span>
<span id="cb2-31"></span>
<span id="cb2-32"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span>(i <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">200</span>) {</span>
<span id="cb2-33">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># put second half into conditional vector</span></span>
<span id="cb2-34">  conditional_vector <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(new_features[((<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(new_features)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(new_features)],</span>
<span id="cb2-35">                          <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(new_features)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>))</span>
<span id="cb2-36">  dot_products <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> conditional_vector <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%*%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t</span>(music_matrix)</span>
<span id="cb2-37">  positive_similarity <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">which</span>(dot_products <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb2-38">  </span>
<span id="cb2-39">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(positive_similarity) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>){</span>
<span id="cb2-40">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># sample some random stuff</span></span>
<span id="cb2-41">    positive_similarity <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dim</span>(music_matrix)[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>],<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">25</span>)</span>
<span id="cb2-42">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(i)</span>
<span id="cb2-43">  }</span>
<span id="cb2-44">  </span>
<span id="cb2-45">  </span>
<span id="cb2-46">  feature_probs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span></span>
<span id="cb2-47">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_feature_probs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">midi_matrix =</span> music_matrix[positive_similarity, ])</span>
<span id="cb2-48">  </span>
<span id="cb2-49">  mean_note_density <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span></span>
<span id="cb2-50">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_mean_note_density</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">midi_matrix =</span> music_matrix[positive_similarity, ])</span>
<span id="cb2-51">  </span>
<span id="cb2-52">  new_features <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">new_features_from_probs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">probs =</span> feature_probs,</span>
<span id="cb2-53">                                          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">density =</span> mean_note_density,</span>
<span id="cb2-54">                                          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">examples =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb2-55">  new_feature_vectors <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbind</span>(new_feature_vectors,new_features)</span>
<span id="cb2-56">}</span>
<span id="cb2-57"></span>
<span id="cb2-58">new_matrix <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">feature_vector_to_matrix</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vec =</span> new_feature_vectors,</span>
<span id="cb2-59">                                       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">num_notes =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">128</span>)</span>
<span id="cb2-60"></span>
<span id="cb2-61"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># transform back to midi</span></span>
<span id="cb2-62">midi_time_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix_to_midi_time</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">midi_matrix =</span> new_matrix,</span>
<span id="cb2-63">                                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">smallest_time_unit =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,</span>
<span id="cb2-64">                                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">note_off_length =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>)</span>
<span id="cb2-65"></span>
<span id="cb2-66">meta_messages_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_midi_meta_df</span>(track_0)</span>
<span id="cb2-67"></span>
<span id="cb2-68">meta_messages_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set_midi_tempo_meta</span>(meta_messages_df,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">update_tempo =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">600000</span>)</span>
<span id="cb2-69"></span>
<span id="cb2-70">split_meta_messages_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">split_meta_df</span>(meta_messages_df)</span>
<span id="cb2-71"></span>
<span id="cb2-72">new_midi_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix_to_midi_track</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">midi_time_df =</span> midi_time_df,</span>
<span id="cb2-73">                                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">split_meta_list =</span> split_meta_messages_df,</span>
<span id="cb2-74">                                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">channel =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb2-75">                                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">velocity =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">64</span>)</span>
<span id="cb2-76"></span>
<span id="cb2-77"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">#### bounce</span></span>
<span id="cb2-78"></span>
<span id="cb2-79"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># update miditapyr df</span></span>
<span id="cb2-80">miditapyr_object<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>midi_frame_unnested<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">update_unnested_mf</span>(new_midi_df)</span>
<span id="cb2-81"></span>
<span id="cb2-82"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#write midi file to disk</span></span>
<span id="cb2-83">miditapyr_object<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">write_file</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"endless_mario_1.mid"</span>)</span>
<span id="cb2-84"></span>
<span id="cb2-85"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">#########</span></span>
<span id="cb2-86"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># bounce to mp3 with fluid synth</span></span>
<span id="cb2-87"></span>
<span id="cb2-88">track_name <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"endless_mario_1"</span></span>
<span id="cb2-89"></span>
<span id="cb2-90">wav_name <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(track_name,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">".wav"</span>)</span>
<span id="cb2-91">midi_name <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(track_name,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">".mid"</span>)</span>
<span id="cb2-92">mp3_name <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(track_name,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">".mp3"</span>)</span>
<span id="cb2-93"></span>
<span id="cb2-94"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># synthesize midi file to wav with fluid synth</span></span>
<span id="cb2-95">system_command <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> glue<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">glue</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'fluidsynth -F {wav_name} ~/Library/Audio/Sounds/Banks/nintendo_soundfont.sf2 {midi_name}'</span>)</span>
<span id="cb2-96"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">system</span>(system_command)</span>
<span id="cb2-97"></span>
<span id="cb2-98"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># convert wav to mp3</span></span>
<span id="cb2-99">av<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">av_audio_convert</span>(wav_name,mp3_name)</span>
<span id="cb2-100"></span>
<span id="cb2-101"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># clean up and delete wav</span></span>
<span id="cb2-102"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">file.exists</span>(wav_name)){</span>
<span id="cb2-103">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">file.remove</span>(wav_name)</span>
<span id="cb2-104">}</span></code></pre></div>
</details>
</div>
<p><audio controls=""> <source src="endless_mario_1.mp3" type="audio/wav"> </audio></p>
<p>It worked!</p>
<p>It’s slightly more musical than the other methods, and suggest lots of other fun to stuff to try.</p>
<p>I really wish I had this in a eurorack module.</p>



 ]]></description>
  <category>midiblender</category>
  <category>generativemusic</category>
  <category>rstatsmusic</category>
  <category>midi</category>
  <category>rstats</category>
  <guid>https://homophony.quest/blog/39_2_7_24_midiblender_mario/</guid>
  <pubDate>Wed, 07 Feb 2024 05:00:00 GMT</pubDate>
  <media:content url="https://homophony.quest/blog/39_2_7_24_midiblender_mario/cover.jpg" medium="image" type="image/jpeg"/>
</item>
</channel>
</rss>
